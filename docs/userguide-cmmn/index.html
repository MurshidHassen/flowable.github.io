<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>Flowable CMMN DOCS (v 6.4.1)</title>
<style>

/* normalize.css */

button,hr,input{overflow:visible}audio,canvas,progress,video{display:inline-block}progress,sub,sup{vertical-align:baseline}html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0} menu,article,aside,details,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{}button,select{text-transform:none}[type=submit], [type=reset],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}/*# sourceMappingURL=normalize.min.css.map */

/* tocbot 2.1.4 */

.toc{overflow-y:auto}.toc>ul{overflow:hidden;position:relative}.toc-list{margin:0;padding-left:10px}a.toc-link{color:currentColor;height:100%}.is-collapsible{max-height:1000px;overflow:hidden;transition:all 300ms ease-in-out}.is-collapsed{max-height:0}.is-position-fixed{position:fixed !important;top:0}.is-active-link{font-weight:700}.toc-link::before{background-color:#f9f9fb;content:' ';display:inline-block;height:inherit;left:8px;margin-top:-1px;position:absolute;width:2px}.is-active-link::before{background-color:#54BC4B}


/* Activiti Specific */

body {
  color: #494d55;
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

html, body {
  height: 100%;
  width: 100%;
  background: #f9f9f9;
  font-family: "Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;
  color: #484848
}

.page-wrapper {
  min-height: 100%;
  /* equal to footer height */
  margin-bottom: -50px;
}

.page-wrapper:after {
  content: "";
  display: block;
  height: 50px;
}

#header {
  position:fixed;
  top:0px;
  z-index:100000;
  width:100%;
}

#header > h1 {
    background: #a0cc47;
    color: #f9f9f9;
    border-bottom: 2px solid #042944;
    padding: 20px 0 20px 20px;
    font-size: 40px;
    font-weight: 800;
    line-height: 1.1;
    margin: 0;
}

#header > h1:before {
  background:url('images/logo.png');
  background-size: 337px 54px; background-repeat: no-repeat;
  width: 337px;
  height: 54px;
  display:inline-block;
  content:'';
  margin-right: 30px;
}

#author {
  margin-left: 25%;
  font-size: 40px;
}

#content {
  margin: 129px 0 0 27%;
  padding: 10px 40px 0 20px;
  padding-right: 40px;
  line-height: 1.7;
  width: 65%;
  overflow-x: auto;
}

h2, h3, h4, h5, h6 {
  color: #00345a;
}

h2 {
  font-size: 26px;
  margin-top: 0;
  margin-bottom: 20px;
  font-weight: bold;
  padding-bottom: 10px;
  border-bottom: 1px solid #d7d7d7;
}

h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 0;
  font-weight: bold;
  padding-bottom: 10px;
  /*border-bottom: 1px solid #d7d7d7;*/
}

h4 {
    font-size: 16px;
    font-weight: bold;
}

h5 {
    font-size: 14px;
    font-weight: bold;
}

h6, h7 {
    font-size: 14px;
    font-weight: bold;
    margin-top: 0;
    margin-bottom: 0;
}

.sect1, .sect2 {
  margin-bottom: 20px;
}

.clear
{
  clear: both;
}

.note, .listingblock, .literalblock{
  padding-left: 8px;
  padding-right: 8px;
  margin-bottom: 14px;
  background-color: #f7f7f9;
  border: 1px solid #e1e1e8;
  border-radius: 4px;
  color: #808080;
}

table.tableblock {
  width: 100%;
  max-width: 100%;
  margin-bottom: 20px;
  background-color: transparent;
  border-spacing: 0;
  border-collapse: collapse;
  border: 1px solid #ddd;
  table-layout: fixed;
}

table.tableblock>caption+thead>tr:first-child>td, table.tableblock>caption+thead>tr:first-child>th, table.tableblock>colgroup+thead>tr:first-child>td, table.tableblock>colgroup+thead>tr:first-child>th, table.tableblock>thead:first-child>tr:first-child>td, table.tableblock>thead:first-child>tr:first-child>th {
    border-top: 0;
}

table.tableblock > thead > tr > th {
    border-bottom-color: #8bd6d8;
}

table.tableblock>thead>tr>th {
    vertical-align: bottom;
    border-bottom: 1px solid #ddd;
}

table.tableblock>tbody>tr>td, table.tableblock>tbody>tr>th, table.tableblock>tfoot>tr>td, table.tableblock>tfoot>tr>th, table.tableblock>thead>tr>td, table.tableblock>thead>tr>th {
    padding: 8px;
    line-height: 1.42857143;
    vertical-align: top;
    border-top: 1px solid #ddd;
}

th {
    text-align: left;
}

table.tableblock > tbody > tr:nth-of-type(odd) {
    background-color: #f5f5f5;
}

table.tableblock > tbody > tr:nth-of-type(odd) {
    background-color: #f9f9f9;
}

td > p {
  margin:0;
}

td.content {
  white-space: normal;
}

pre, td, th {
   white-space: pre-wrap;
   white-space: -moz-pre-wrap;
   white-space: -pre-wrap;
   white-space: -o-pre-wrap;
   word-wrap: break-word;
}

img {
  max-width: 100%;
}

a {
  color: #007387;
}

a:hover {
  color: #004c59;
}

#toc-parent {
  width: 25%;
  float: left;
  height: 100%;
  overflow-y: auto;
  position: fixed;
  padding: 10px;
  border-right: 1px solid #ccc;
}

#generated-toc {
    width: 100%;
    height: 100%;
    font-size: 16px;
}

.toc-link {
  text-decoration: none;
}

.toc-list {
  margin: 0 20px 0 10px;
}

.toc-list-item {
  padding: 4px 0 4px 0;
}


div.sect5  p {
    margin-top: 0;
    margin-bottom: 0;
}

div.sect5  code {
    font-family: "Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/* Pygments CSS disabled. Pygments is not available. */
</style>
<script type="text/javascript">

/*
 * Tocbot.min.js version 2.1.4
 */

 !function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([/*!*************************!*\
   !*** ./src/js/index.js ***!
   \*************************/
 function(e,t,n){var o,i,r;(function(l){!function(n,l){i=[],o=l(n),r="function"==typeof o?o.apply(t,i):o,!(void 0!==r&&(e.exports=r))}("undefined"!=typeof l?l:this.window||this.global,function(e){"use strict";function t(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var o in n)h.call(n,o)&&(e[o]=n[o])}return e}function o(e,t,n){t||(t=250);var o,i;return function(){var r=n||this,l=+new Date,s=arguments;o&&l<o+t?(clearTimeout(i),i=setTimeout(function(){o=l,e.apply(r,s)},t)):(o=l,e.apply(r,s))}}var i,r,l,s=n(/*! smooth-scroll */1),c=n(/*! ./default-options.js */2),a={},u={},d=n(/*! ./build-html.js */3),f=n(/*! ./parse-content.js */4),m=(e.document,document.body,!!e.document.querySelector&&!!e.addEventListener),h=Object.prototype.hasOwnProperty;return u.destroy=function(){try{document.querySelector(a.tocSelector).innerHTML=""}catch(e){console.warn("Element not found: "+a.tocSelector)}document.removeEventListener("scroll",this._scrollListener,!1),document.removeEventListener("resize",this._scrollListener,!1),i&&document.removeEventListener("click",this._clickListener,!1),s&&s.destroy()},u.init=function(e){if(m&&(a=t(c,e||{}),this.options=a,this.state={},i=d(a),r=f(a),this._buildHtml=i,this._parseContent=r,u.destroy(),l=r.selectHeadings(a.contentSelector,a.headingSelector),null!==l)){var n=r.nestHeadingsArray(l),h=n.nest;return i.render(a.tocSelector,h),this._scrollListener=o(function(){i.updateToc(l)},a.throttleTimeout),this._scrollListener(),document.addEventListener("scroll",this._scrollListener,!1),document.addEventListener("resize",this._scrollListener,!1),this._clickListener=o(function(e){i.disableTocAnimation(e),i.updateToc(l)},a.throttleTimeout),document.addEventListener("click",this._clickListener,!1),s&&(this.smoothScroll=s.init(t(a.smoothScrollOptions,{callback:i.enableTocAnimation}))),this}},u.refresh=function(e){u.destroy(),u.init(e||this.options)},e.tocbot=u,u})}).call(t,function(){return this}())},/*!******************************************************!*\
   !*** ./~/smooth-scroll/dist/js/smooth-scroll.min.js ***!
   \******************************************************/
 function(e,t,n){var o,i,r;(function(n){/*! smooth-scroll v10.0.1 | (c) 2016 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/smooth-scroll */
 !function(n,l){i=[],o=l(n),r="function"==typeof o?o.apply(t,i):o,!(void 0!==r&&(e.exports=r))}("undefined"!=typeof n?n:this.window||this.global,function(e){"use strict";var t,n,o,i,r,l,s,c={},a="querySelector"in document&&"addEventListener"in e,u={selector:"[data-scroll]",selectorHeader:null,speed:500,easing:"easeInOutCubic",offset:0,callback:function(){}},d=function(){var e={},t=!1,n=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],n++);for(var i=function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t&&"[object Object]"===Object.prototype.toString.call(n[o])?e[o]=d(!0,e[o],n[o]):e[o]=n[o])};o>n;n++){var r=arguments[n];i(r)}return e},f=function(e){return Math.max(e.scrollHeight,e.offsetHeight,e.clientHeight)},m=function(e,t){var n,o,i=t.charAt(0),r="classList"in document.documentElement;for("["===i&&(t=t.substr(1,t.length-2),n=t.split("="),n.length>1&&(o=!0,n[1]=n[1].replace(/"/g,"").replace(/'/g,"")));e&&e!==document&&1===e.nodeType;e=e.parentNode){if("."===i)if(r){if(e.classList.contains(t.substr(1)))return e}else if(new RegExp("(^|\\s)"+t.substr(1)+"(\\s|$)").test(e.className))return e;if("#"===i&&e.id===t.substr(1))return e;if("["===i&&e.hasAttribute(n[0])){if(!o)return e;if(e.getAttribute(n[0])===n[1])return e}if(e.tagName.toLowerCase()===t)return e}return null},h=function(e){"#"===e.charAt(0)&&(e=e.substr(1));for(var t,n=String(e),o=n.length,i=-1,r="",l=n.charCodeAt(0);++i<o;){if(t=n.charCodeAt(i),0===t)throw new InvalidCharacterError("Invalid character: the input contains U+0000.");r+=t>=1&&31>=t||127==t||0===i&&t>=48&&57>=t||1===i&&t>=48&&57>=t&&45===l?"\\"+t.toString(16)+" ":t>=128||45===t||95===t||t>=48&&57>=t||t>=65&&90>=t||t>=97&&122>=t?n.charAt(i):"\\"+n.charAt(i)}return"#"+r},p=function(e,t){var n;return"easeInQuad"===e&&(n=t*t),"easeOutQuad"===e&&(n=t*(2-t)),"easeInOutQuad"===e&&(n=.5>t?2*t*t:-1+(4-2*t)*t),"easeInCubic"===e&&(n=t*t*t),"easeOutCubic"===e&&(n=--t*t*t+1),"easeInOutCubic"===e&&(n=.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1),"easeInQuart"===e&&(n=t*t*t*t),"easeOutQuart"===e&&(n=1- --t*t*t*t),"easeInOutQuart"===e&&(n=.5>t?8*t*t*t*t:1-8*--t*t*t*t),"easeInQuint"===e&&(n=t*t*t*t*t),"easeOutQuint"===e&&(n=1+--t*t*t*t*t),"easeInOutQuint"===e&&(n=.5>t?16*t*t*t*t*t:1+16*--t*t*t*t*t),n||t},v=function(e,t,n){var o=0;if(e.offsetParent)do o+=e.offsetTop,e=e.offsetParent;while(e);return o=Math.max(o-t-n,0),Math.min(o,b()-g())},g=function(){return Math.max(document.documentElement.clientHeight,e.innerHeight||0)},b=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},C=function(e){return e&&"object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(e):{}},S=function(e){return e?f(e)+e.offsetTop:0},y=function(t,n,o){o||(t.focus(),document.activeElement.id!==t.id&&(t.setAttribute("tabindex","-1"),t.focus(),t.style.outline="none"),e.scrollTo(0,n))};c.animateScroll=function(n,o,l){var c=C(o?o.getAttribute("data-options"):null),a=d(t||u,l||{},c),f="[object Number]"===Object.prototype.toString.call(n),m=f||!n.tagName?null:n;if(f||m){var h=e.pageYOffset;a.selectorHeader&&!i&&(i=document.querySelector(a.selectorHeader)),r||(r=S(i));var g,x,N=f?n:v(m,r,parseInt(a.offset,10)),L=N-h,O=b(),E=0,A=function(t,i,r){var l=e.pageYOffset;(t==i||l==i||e.innerHeight+l>=O)&&(clearInterval(r),y(n,i,f),a.callback(n,o))},H=function(){E+=16,g=E/parseInt(a.speed,10),g=g>1?1:g,x=h+L*p(a.easing,g),e.scrollTo(0,Math.floor(x)),A(x,N,s)},T=function(){clearInterval(s),s=setInterval(H,16)};0===e.pageYOffset&&e.scrollTo(0,0),T()}};var x=function(t){e.location.hash,n&&(n.id=n.getAttribute("data-scroll-id"),c.animateScroll(n,o),n=null,o=null)},N=function(i){if(0===i.button&&!i.metaKey&&!i.ctrlKey&&(o=m(i.target,t.selector),o&&"a"===o.tagName.toLowerCase()&&o.hostname===e.location.hostname&&o.pathname===e.location.pathname&&/#/.test(o.href))){var r=h(o.hash);if("#"===r){i.preventDefault(),n=document.body;var l=n.id?n.id:"smooth-scroll-top";return n.setAttribute("data-scroll-id",l),n.id="",void(e.location.hash.substring(1)===l?x():e.location.hash=l)}n=document.querySelector(r),n&&(n.setAttribute("data-scroll-id",n.id),n.id="",o.hash===e.location.hash&&(i.preventDefault(),x()))}},L=function(e){l||(l=setTimeout(function(){l=null,r=S(i)},66))};return c.destroy=function(){t&&(document.removeEventListener("click",N,!1),e.removeEventListener("resize",L,!1),t=null,n=null,o=null,i=null,r=null,l=null,s=null)},c.init=function(n){a&&(c.destroy(),t=d(u,n||{}),i=t.selectorHeader?document.querySelector(t.selectorHeader):null,r=S(i),document.addEventListener("click",N,!1),e.addEventListener("hashchange",x,!1),i&&e.addEventListener("resize",L,!1))},c})}).call(t,function(){return this}())},/*!***********************************!*\
   !*** ./src/js/default-options.js ***!
   \***********************************/
 function(e,t){e.exports={tocSelector:".js-toc",contentSelector:".js-toc-content",headingSelector:"h1, h2, h3",ignoreSelector:".js-toc-ignore",linkClass:"toc-link",extraLinkClasses:"",activeLinkClass:"is-active-link",listClass:"toc-list",extraListClasses:"",isCollapsedClass:"is-collapsed",collapsibleClass:"is-collapsible",listItemClass:"toc-list-item",collapseDepth:0,smoothScrollOptions:{easing:"easeInOutCubic",offset:0,speed:300,updateURL:!0},headingsOffset:0,throttleTimeout:50,positionFixedSelector:null,positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto",includeHtml:!1}},/*!******************************!*\
   !*** ./src/js/build-html.js ***!
   \******************************/
 function(e,t){e.exports=function(e){function t(e,n){var r=n.appendChild(o(e));if(e.children.length){var l=i(e.isCollapsed);e.children.forEach(function(e){t(e,l)}),r.appendChild(l)}}function n(e,n){var o=!1,r=i(o);n.forEach(function(e){t(e,r)});var l=document.querySelector(e);if(null!==l)return l.firstChild&&l.removeChild(l.firstChild),l.appendChild(r)}function o(t){var n=document.createElement("li"),o=document.createElement("a");return e.listItemClass&&n.setAttribute("class",e.listItemClass),e.includeHtml&&t.childNodes.length?u.call(t.childNodes,function(e){o.appendChild(e.cloneNode(!0))}):o.textContent=t.textContent,o.setAttribute("data-scroll",""),o.setAttribute("href","#"+t.id),o.setAttribute("class",e.linkClass+h+"node-name--"+t.nodeName+h+e.extraLinkClasses),n.appendChild(o),n}function i(t){var n=document.createElement("ul"),o=e.listClass+h+e.extraListClasses;return t&&(o+=h+e.collapsibleClass,o+=h+e.isCollapsedClass),n.setAttribute("class",o),n}function r(){var t=document.documentElement.scrollTop||f.scrollTop,n=document.querySelector(e.positionFixedSelector);"auto"===e.fixedSidebarOffset&&(e.fixedSidebarOffset=document.querySelector(e.tocSelector).offsetTop),t>e.fixedSidebarOffset?n.className.indexOf(e.positionFixedClass)===-1&&(n.className+=h+e.positionFixedClass):n.className=n.className.split(h+e.positionFixedClass).join("")}function l(t){var n=document.documentElement.scrollTop||f.scrollTop;e.positionFixedSelector&&r();var o,i=t;if(m&&null!==document.querySelector(e.tocSelector)&&i.length>0){d.call(i,function(t,r){if(t.offsetTop>n+e.headingsOffset){var l=0===r?r:r-1;return o=i[l],!0}if(r===i.length-1)return o=i[i.length-1],!0});var l=document.querySelector(e.tocSelector).querySelectorAll("."+e.linkClass);u.call(l,function(t){t.className=t.className.split(h+e.activeLinkClass).join("")});var c=document.querySelector(e.tocSelector).querySelector("."+e.linkClass+".node-name--"+o.nodeName+'[href="#'+o.id+'"]');c.className+=h+e.activeLinkClass;var a=document.querySelector(e.tocSelector).querySelectorAll("."+e.listClass+"."+e.collapsibleClass);u.call(a,function(t){var n=h+e.isCollapsedClass;t.className.indexOf(n)===-1&&(t.className+=h+e.isCollapsedClass)}),c.nextSibling&&(c.nextSibling.className=c.nextSibling.className.split(h+e.isCollapsedClass).join("")),s(c.parentNode.parentNode)}}function s(t){return t.className.indexOf(e.collapsibleClass)!==-1?(t.className=t.className.split(h+e.isCollapsedClass).join(""),s(t.parentNode.parentNode)):t}function c(t){var n=t.target||t.srcElement;n.className.indexOf(e.linkClass)!==-1&&(m=!1)}function a(){m=!0}var u=[].forEach,d=[].some,f=document.body,m=!0,h=" ";return{enableTocAnimation:a,disableTocAnimation:c,render:n,updateToc:l}}},/*!*********************************!*\
   !*** ./src/js/parse-content.js ***!
   \*********************************/
 function(e,t){e.exports=function(e){function t(e){return e[e.length-1]}function n(e){return+e.nodeName.split("H").join("")}function o(t){var o={id:t.id,children:[],nodeName:t.nodeName,headingLevel:n(t),textContent:t.textContent.trim()};return e.includeHtml&&(o.childNodes=t.childNodes),o}function i(i,r){for(var l=o(i),s=n(i),c=r,a=t(c),u=a?a.headingLevel:0,d=s-u;d>0;)a=t(c),a&&void 0!==a.children&&(c=a.children),d--;return s>=e.collapseDepth&&(l.isCollapsed=!0),c.push(l),c}function r(t,n){var o=n;e.ignoreSelector&&(o=n.split(",").map(function(t){return t.trim()+":not("+e.ignoreSelector+")"}));try{return document.querySelector(t).querySelectorAll(o)}catch(i){return console.warn("Element not found: "+t),null}}function l(e){return s.call(e,function(e,t){var n=o(t);return i(n,e.nest),e},{nest:[]})}var s=[].reduce;return{nestHeadingsArray:l,selectHeadings:r}}}]);
 //# sourceMappingURL=tocbot.min.js.map

</script>

<script type="text/javascript">

  var generateToc = function() {
    var readyState = document.readyState;
    if (readyState === 'interactive' || readyState == 'complete') {

      var headerSize = 140;

      var tocParentNode = document.createElement("div");
      tocParentNode.setAttribute("id", "toc-parent");

      var generatedTocNode = document.createElement("div");
      generatedTocNode.setAttribute("id", "generated-toc");
      tocParentNode.appendChild(generatedTocNode);

      var contentNode = document.getElementById("content");
      contentNode.parentNode.insertBefore(tocParentNode, contentNode);

      var clearNode = document.createElement("div");
      clearNode.setAttribute("class", "clear");
      contentNode.parentNode.appendChild(clearNode);

      tocbot.init({
        tocSelector: '#generated-toc',
        contentSelector: '#content',
        headingSelector: 'h2, h3, h4, h5',
        headingsOffset: headerSize,
        smoothScrollOptions: {
          easing: 'easeInOutCubic',
          offset: headerSize,
          speed: 300, // animation duration.
          updateURL: true
        },
        collapseDepth: 0
      });

    } else {
      window.setTimeout(function(){
        generateToc();
      }, 50);
    }

  }
  generateToc();

</script>
</head>
<body class="book">
<div id="header">
<h1>Flowable CMMN DOCS (v 6.4.1)</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="license">1.1. License</h3>
<div class="paragraph">
<p>Flowable is distributed under <a href="http://www.apache.org/licenses/LICENSE-2.0.html">the Apache V2 license</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="download">1.2. Download</h3>
<div class="paragraph">
<p><a href="http://www.flowable.org/downloads.html"><a href="http://www.flowable.org/downloads.html" class="bare">http://www.flowable.org/downloads.html</a></a></p>
</div>
</div>
<div class="sect2">
<h3 id="sources">1.3. Sources</h3>
<div class="paragraph">
<p>The distribution contains most of the sources as JAR files. The source code of Flowable can be found on <a href="https://github.com/flowable/flowable-engine"><a href="https://github.com/flowable/flowable-engine" class="bare">https://github.com/flowable/flowable-engine</a></a></p>
</div>
</div>
<div class="sect2">
<h3 id="experimental">1.4. Experimental Features</h3>
<div class="paragraph">
<p>Sections marked with <strong>[EXPERIMENTAL]</strong> should not be considered stable.</p>
</div>
<div class="paragraph">
<p>All classes that have <code>.impl.</code> in the package name are internal implementation classes and cannot be considered stable or guaranteed in any way.  However, if the User Guide mentions any classes as configuration values, they are supported and can be considered stable.</p>
</div>
</div>
<div class="sect2">
<h3 id="required.software">1.5. Required software</h3>
<div class="paragraph">
<p>Flowable runs on a JDK higher than or equal to version 8. Go to <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle Java SE downloads</a> and click on button "Download JDK".  There are installation instructions on that page as well. To verify that your installation was successful, run <code>java -version</code> on the command line.  That should print the installed version of your JDK.</p>
</div>
</div>
<div class="sect2">
<h3 id="reporting.problems">1.6. Reporting problems</h3>
<div class="paragraph">
<p>Questions and comments can be discussed on the on <a href="https://forum.flowable.org">the Flowable forum</a>. Issues can be created in <a href="https://github.com/flowable/flowable-engine/issues">our Github issue tracker</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="internal">1.7. Internal implementation classes</h3>
<div class="paragraph">
<p>In the JAR file, all classes in packages that have <code>.impl.</code> in them are implementation classes and should be considered internal. No stability guarantees are given on classes or interfaces that are in implementation classes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">2. Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configuration">2.1. Creating a CmmnEngine</h3>
<div class="paragraph">
<p>The Flowable CMMN engine is configured through an XML file called <code>flowable.cmmn.cfg.xml</code>. Note that this is <strong>not</strong> applicable if you&#8217;re using <a href="#springintegration">the Spring style of building a process engine</a>.</p>
</div>
<div class="paragraph">
<p>The easiest way to obtain a <code>CmmnEngine</code> is to use the <code>org.flowable.cmmn.engine.CmmnEngineConfiguration</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">CmmnEngine cmmnEngine = CmmnEngineConfiguration.createStandaloneCmmnEngineConfiguration();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will look for a <code>flowable.cmmn.cfg.xml</code> file on the classpath and construct an engine based on the configuration in that file. The following snippet shows an example configuration.  The following sections will give a detailed overview of the configuration properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;

  &lt;bean id="cmmnEngineConfiguration" class="org.flowable.cmmn.engine.CmmnEngineConfiguration"&gt;

    &lt;property name="jdbcUrl" value="jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000" /&gt;
    &lt;property name="jdbcDriver" value="org.h2.Driver" /&gt;
    &lt;property name="jdbcUsername" value="sa" /&gt;
    &lt;property name="jdbcPassword" value="" /&gt;

    &lt;property name="databaseSchemaUpdate" value="true" /&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the configuration XML is in fact a Spring configuration. <strong>This does not mean that Flowable can only be used in a Spring environment!</strong> We are simply leveraging the parsing and dependency injection capabilities of Spring internally for building up the engine.</p>
</div>
<div class="paragraph">
<p>The CmmnEngineConfiguration object can also be created programmatically using the configuration file. It is also possible to use a different bean id (for example, see line 3).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">CmmnEngineConfiguration.
  createCmmnEngineConfigurationFromResourceDefault();
  createCmmnEngineConfigurationFromResource(String resource);
  createCmmnEngineConfigurationFromResource(String resource, String beanName);
  createCmmnEngineConfigurationFromInputStream(InputStream inputStream);
  createCmmnEngineConfigurationFromInputStream(InputStream inputStream, String beanName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible not to use a configuration file, and create a configuration based on
defaults (see <a href="#configurationClasses">the different supported classes</a> for more information).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">CmmnEngineConfiguration.createStandaloneCmmnEngineConfiguration();
CmmnEngineConfiguration.createStandaloneInMemCmmnEngineConfiguration();</code></pre>
</div>
</div>
<div class="paragraph">
<p>All these <code>CmmnEngineConfiguration.createXXX()</code> methods return a <code>CmmnEngineConfiguration</code> that can be tweaked further if needed. After calling the <code>buildCmmnEngine()</code> operation, a <code>CmmnEngine</code> is created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">CmmnEngine cmmnEngine = CmmnEngineConfiguration.createStandaloneInMemCmmnEngineConfiguration()
  .setDatabaseSchemaUpdate(CmmnEngineConfiguration.DB_SCHEMA_UPDATE_TRUE)
  .setJdbcUrl("jdbc:h2:mem:my-own-db;DB_CLOSE_DELAY=1000")
  .buildCmmnEngine();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configurationRoot">2.2. CmmnEngineConfiguration bean</h3>
<div class="paragraph">
<p>The <code>flowable.cmmn.cfg.xml</code> must contain a bean that has the id <code>'cmmnEngineConfiguration'</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"> &lt;bean id="cmmnEngineConfiguration" class="org.flowable.cmmn.engine.CmmnEngineConfiguration"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This bean is then used to construct the <code>CmmnEngine</code>. There are multiple classes available that can be used to define the <code>cmmnEngineConfiguration</code>. These classes represent different environments, and set defaults accordingly. It&#8217;s best practice to select the class that best matches your environment, to minimize the number of properties needed to configure the engine. The following classes are currently available: <a id="configurationClasses"></a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.flowable.cmmn.engine.impl.cfg.StandaloneInMemCmmnEngineConfiguration</strong>: this is a convenience class for unit testing purposes. Flowable will take care of all transactions. An H2 in-memory database is used by default. The database will be created and dropped when the engine boots and shuts down. When using this, no additional configuration is probably needed.</p>
</li>
<li>
<p><strong>org.flowable.cmmn.spring.SpringCmmnEngineConfiguration</strong>: To be used when the CMMN engine is used in a Spring environment.  See <a href="#springintegration">the Spring integration section</a> for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="databaseConfiguration">2.3. Database configuration</h3>
<div class="paragraph">
<p>There are two ways to configure the database that the Flowable CMMN engine will use. The first option is to define the JDBC properties of the database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcUrl</strong>: JDBC URL of the database.</p>
</li>
<li>
<p><strong>jdbcDriver</strong>: implementation of the driver for the specific database type.</p>
</li>
<li>
<p><strong>jdbcUsername</strong>: username to connect to the database.</p>
</li>
<li>
<p><strong>jdbcPassword</strong>: password to connect to the database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The data source that is constructed based on the provided JDBC properties will have the default <a href="http://www.mybatis.org/">MyBatis</a> connection pool settings. The following attributes can optionally be set to tweak that connection pool (taken from the MyBatis documentation):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcMaxActiveConnections</strong>: The number of active connections that the connection pool at maximum at any time can contain. Default is 10.</p>
</li>
<li>
<p><strong>jdbcMaxIdleConnections</strong>: The number of idle connections that the connection pool at maximum at any time can contain.</p>
</li>
<li>
<p><strong>jdbcMaxCheckoutTime</strong>: The amount of time in milliseconds a connection can be <em>checked out</em> from the connection pool before it is forcefully returned. Default is 20000 (20 seconds).</p>
</li>
<li>
<p><strong>jdbcMaxWaitTime</strong>: This is a low level setting that gives the pool a chance to print a log status and re-attempt the acquisition of a connection in the case that it is taking unusually long (to avoid failing silently forever if the pool is misconfigured) Default is 20000 (20 seconds).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example database configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;property name="jdbcUrl" value="jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000" /&gt;
&lt;property name="jdbcDriver" value="org.h2.Driver" /&gt;
&lt;property name="jdbcUsername" value="sa" /&gt;
&lt;property name="jdbcPassword" value="" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our benchmarks have shown that the MyBatis connection pool is not the most efficient or resilient when dealing with a lot of concurrent requests. As such, it is advised to us a <code>javax.sql.DataSource</code> implementation and inject it into the process engine configuration (For example HikariCP, Tomcat JDBC Connection Pool, etc.):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource" &gt;
  &lt;property name="driverClassName" value="com.mysql.jdbc.Driver" /&gt;
  &lt;property name="url" value="jdbc:mysql://localhost:3306/flowable" /&gt;
  &lt;property name="username" value="flowable" /&gt;
  &lt;property name="password" value="flowable" /&gt;
  &lt;property name="defaultAutoCommit" value="false" /&gt;
&lt;/bean&gt;

&lt;bean id="cmmnEngineConfiguration" class="org.flowable.cmmn.engine.CmmnEngineConfiguration"&gt;

  &lt;property name="dataSource" ref="dataSource" /&gt;
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that Flowable does not ship with a library that allows you to define such a data source. So you need to make sure that the libraries are on your classpath.</p>
</div>
<div class="paragraph">
<p>The following properties can be set, regardless of whether you are using the JDBC or data source approach:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>databaseType</strong>: it&#8217;s normally not necessary to specify this property, as it is automatically detected from the database connection metadata. Should only be specified when automatic detection fails. Possible values: {h2, mysql, oracle, postgres, mssql, db2}. This setting will determine which create/drop scripts and queries will be used. See <a href="#supporteddatabases">the <em>supported databases</em> section</a> for an overview of which types are supported.</p>
</li>
<li>
<p><strong>databaseSchemaUpdate</strong>: sets the strategy to handle the database schema on process engine boot and shutdown.</p>
<div class="ulist">
<ul>
<li>
<p><code>false</code> (default): Checks the version of the DB schema against the library when the process engine is being created and throws an exception if the versions don&#8217;t match.</p>
</li>
<li>
<p><code>true</code>: Upon building the process engine, a check is performed and an update of the schema is performed if it is necessary. If the schema doesn&#8217;t exist, it is created.</p>
</li>
<li>
<p><code>create-drop</code>: Creates the schema when the process engine is being created and drops the schema when the process engine is being closed.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jndiDatasourceConfig">2.4. JNDI Datasource Configuration</h3>
<div class="paragraph">
<p>By default, the database configuration for Flowable is contained within the db.properties files in the WEB-INF/classes of each web application. This isn&#8217;t always ideal because it
requires users to either modify the db.properties in the Flowable source and recompile the WAR file, or explode the WAR and modify the db.properties on every deployment.</p>
</div>
<div class="paragraph">
<p>By using JNDI (Java Naming and Directory Interface) to obtain the database connection, the connection is fully managed by the Servlet Container and the configuration can be managed outside the WAR deployment. This also allows more control over the connection parameters than what is provided by the db.properties file.</p>
</div>
<div class="sect3">
<h4 id="jndi_configuration">2.4.1. Configuration</h4>
<div class="paragraph">
<p>Configuration of the JNDI data source will differ depending on what servlet container application you are using. The instructions below will work for Tomcat, but for other container applications, please refer to the documentation for your container app.</p>
</div>
<div class="paragraph">
<p>If using Tomcat, the JNDI resource is configured within $CATALINA_BASE/conf/[enginename]/[hostname]/[warname].xml (for the Flowable UI this will usually be $CATALINA_BASE/conf/Catalina/localhost/flowable-app.xml). The default context is copied from the Flowable WAR file when the application is first deployed, so if it already exists, you will need to replace it. To change the JNDI resource so that the application connects to MySQL instead of H2, for example, change the file to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
    &lt;Context antiJARLocking="true" path="/flowable-app"&gt;
        &lt;Resource auth="Container"
            name="jdbc/flowableDB"
            type="javax.sql.DataSource"
            description="JDBC DataSource"
            url="jdbc:mysql://localhost:3306/flowable"
            driverClassName="com.mysql.jdbc.Driver"
            username="sa"
            password=""
            defaultAutoCommit="false"
            initialSize="5"
            maxWait="5000"
            maxActive="120"
            maxIdle="5"/&gt;
        &lt;/Context&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jndi_properties">2.4.2. JNDI properties</h4>
<div class="paragraph">
<p>To configure a JNDI data source, use following properties in the properties file for the Flowable UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring.datasource.jndi-name=: the JNDI name of the data source.</p>
</li>
<li>
<p>datasource.jndi.resourceRef: Set whether the lookup occurs in a J2EE container, for example, the prefix "java:comp/env/" needs to be added if the JNDI name doesn&#8217;t already contain it. Default is "true".</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="supporteddatabases">2.5. Supported databases</h3>
<div class="paragraph">
<p>Listed below are the types (case sensitive!) that Flowable uses to refer to databases.</p>
</div>
<table id="databaseTypes" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flowable database type</th>
<th class="tableblock halign-left valign-top">Example JDBC URL</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:h2:tcp://localhost/flowable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default configured database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mysql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:mysql://localhost:3306/flowable?autoReconnect=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested using mysql-connector-java database driver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:oracle:thin:@localhost:1521:xe</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgres</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:postgresql://localhost:5432/flowable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">db2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:db2://localhost:50000/flowable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mssql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:sqlserver://localhost:1433;databaseName=flowable (jdbc.driver=com.microsoft.sqlserver.jdbc.SQLServerDriver) <em>OR</em> jdbc:jtds:sqlserver://localhost:1433/flowable (jdbc.driver=net.sourceforge.jtds.jdbc.Driver)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested using Microsoft JDBC Driver 4.0 (sqljdbc4.jar) and JTDS Driver</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="creatingDatabaseTable">2.6. Creating the database tables</h3>
<div class="paragraph">
<p>The easiest way to create the database tables for your database is to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the flowable-cmmn-engine JARs to your classpath</p>
</li>
<li>
<p>Add a suitable database driver</p>
</li>
<li>
<p>Add a Flowable configuration file (<em>flowable.cmmn.cfg.xml</em>) to your classpath, pointing to your database (see <a href="#databaseConfiguration">database configuration section</a>)</p>
</li>
<li>
<p>Execute the main method of the <em>DbSchemaCreate</em> class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, often only database administrators can execute DDL statements on a database. On a production system, this is also the wisest of choices. The SQL DDL statements can be found on the Flowable downloads page or inside the Flowable distribution folder, in the <code>database</code> subdirectory. The scripts are also in the engine JAR (<em>flowable-cmmn-engine-x.jar</em>), in the package <em>org/flowable/cmmn/db/create</em> . The SQL files are of the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre>flowable.{db}.cmmn.create.sql</pre>
</div>
</div>
<div class="paragraph">
<p>Where <em>db</em> is any of the <a href="#supporteddatabases">supported databases</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="database.tables.explained">2.7. Database table names explained</h3>
<div class="paragraph">
<p>The database names of the Flowable CMMN Engine all start with <strong>ACT_CMMN_</strong>. The second part is a two-character identification of the use case of the table. This use case will also roughly match the service API.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ACT_CMMN_</strong>*: Tables without an additional prefix contain <em>static</em> information such as case definitions and case resources (images, rules, etc.).</p>
</li>
<li>
<p><strong>ACT_CMMN_RU_</strong>*: <em>RU</em> stands for <code>runtime</code>. These are the runtime tables that contain the runtime data of case instances, plan items, and so on. Flowable only stores the runtime data during case instance execution and removes the records when a case instance ends. This keeps the runtime tables small and fast.</p>
</li>
<li>
<p><strong>ACT_CMMN_HI_</strong>*: <em>HI</em> stands for <code>history</code>. These are the tables that contain historic data, such as past case instances, plan items, and so on.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="databaseUpgrade">2.8. Database upgrade</h3>
<div class="paragraph">
<p>Make sure you make a backup of your database (using your database backup capabilities) before you run an upgrade.</p>
</div>
<div class="paragraph">
<p>By default, a version check will be performed each time a process engine is created. This typically happens once at boot time of your application or of the Flowable webapps. If the Flowable library notices a difference between the library version and the version of the Flowable database tables, then an exception is thrown.</p>
</div>
<div class="paragraph">
<p>To upgrade, you have to start by putting the following configuration property in your flowable.cmmn.cfg.xml configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;beans &gt;

  &lt;bean id="cmmnEngineConfiguration"
      class="org.flowable.cmmn.engine.CmmnEngineConfiguration"&gt;
    &lt;!-- ... --&gt;
    &lt;property name="databaseSchemaUpdate" value="true" /&gt;
    &lt;!-- ... --&gt;
  &lt;/bean&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Also, include a suitable database driver for your database to the classpath.</strong> Upgrade the Flowable libraries in your application. Or start up a new version of Flowable and point it to a database that contains data from an older version.  With <code>databaseSchemaUpdate</code> set to <code>true</code>, Flowable will automatically upgrade the DB schema to the newest version the first time when it notices that libraries and DB schema are out of sync.</p>
</div>
<div class="paragraph">
<p><strong>As an alternative, you can also run the upgrade DDL statements.</strong> It&#8217;s also possible to run the upgrade database scripts available on the Flowable downloads page.</p>
</div>
</div>
<div class="sect2">
<h3 id="historyConfiguration">2.9. History configuration</h3>
<div class="paragraph">
<p>Customizing the configuration of history storage is optional. This allows you to tweak settings that influence the <a href="#history">history capabilities</a> of the engine. See <a href="#historyConfig">history configuration</a> for more details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;property name="history" value="audit" /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exposingConfigurationBeans">2.10. Exposing configuration beans in expressions and scripts</h3>
<div class="paragraph">
<p>By default, all beans that you specify in the <code>flowable.cmmn.cfg.xml</code> configuration or in your own Spring configuration file are available to expressions and scripts. If you want to limit the visibility of beans in your configuration file, you can configure a property called <code>beans</code> in your process engine configuration. The beans property in <code>CmmnEngineConfiguration</code> is a map. When you specify that property, only beans specified in that map will be visible to expressions and scripts.  The exposed beans will be exposed with the names as you specify in the map.</p>
</div>
</div>
<div class="sect2">
<h3 id="caseDefinitionCacheConfiguration">2.11. Deployment cache configuration</h3>
<div class="paragraph">
<p>All case definitions are cached (after they&#8217;re parsed) to avoid hitting the database every time a case definition is needed and because case definition data doesn&#8217;t change. By default, there is no limit on this cache. To limit the case definition cache, add following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;property name="caseDefinitionCacheLimit" value="10" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting this property will swap the default hashmap cache with a LRU cache that has the provided hard limit. Of course, the <em>best</em> value for this property depends on the total amount of case definitions stored and the number of case definitions actually used at runtime by all the runtime case instances.</p>
</div>
<div class="paragraph">
<p>You can also inject your own cache implementation. This must be a bean that implements the org.flowable.engine.common.impl.persistence.deploy.DeploymentCache interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;property name="caseDefinitionCache"&gt;
  &lt;bean class="org.flowable.MyCache" /&gt;
&lt;/property&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="loggingConfiguration">2.12. Logging</h3>
<div class="paragraph">
<p>All logging (flowable, spring, mybatis, &#8230;&#8203;) is routed through SLF4J and allows for selecting the logging-implementation of your choice.</p>
</div>
<div class="paragraph">
<p><strong>By default no SFL4J-binding JAR is present in the flowable-cmmn-engine dependencies, this should be added in your project in order to use the logging framework of your choice.</strong> If no implementation JAR is added, SLF4J will use a NOP-logger, not logging anything at all, other than a warning that nothing will be logged. For more info on these bindings <a href="http://www.slf4j.org/codes.html#StaticLoggerBinder"><a href="http://www.slf4j.org/codes.html#StaticLoggerBinder" class="bare">http://www.slf4j.org/codes.html#StaticLoggerBinder</a></a>.</p>
</div>
<div class="paragraph">
<p>With Maven, add for example a dependency like this (here using log4j), note that you still need to add a version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
  &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The flowable-ui and flowable-rest webapps are configured to use Log4j-binding. Log4j is also used when running the tests for all the flowable-* modules.</p>
</div>
<div class="paragraph">
<p><strong>Important note when using a container with commons-logging in the classpath:</strong> In order to route the spring-logging through SLF4J, a bridge is used (see <a href="http://www.slf4j.org/legacy.html#jclOverSLF4J"><a href="http://www.slf4j.org/legacy.html#jclOverSLF4J" class="bare">http://www.slf4j.org/legacy.html#jclOverSLF4J</a></a>). If your container provides a commons-logging implementation, please follow directions on this page: <a href="http://www.slf4j.org/codes.html#release"><a href="http://www.slf4j.org/codes.html#release" class="bare">http://www.slf4j.org/codes.html#release</a></a> to ensure stability.</p>
</div>
<div class="paragraph">
<p>Example when using Maven (version omitted):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
  &lt;artifactId&gt;jcl-over-slf4j&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapterApi">3. The Flowable CMMN API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="apiEngine">3.1. The Process CMMN Engine API and services</h3>
<div class="paragraph">
<p>The engine API is the most common way of interacting with Flowable. The main starting point is the <code>CmmnEngine</code>, which can be created in several ways as described in the  <a href="#configuration">configuration section</a>. From the CmmnEngine, you can obtain the various services that contain the case/CMMN methods. CmmnEngine and the services objects are thread safe, so you can keep a reference to one of those for a whole server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">CmmnEngine cmmnEngine = CmmnEngineConfiguration.createStandaloneCmmnEngineConfiguration();

CmmnRuntimeService runtimeService = cmmnEngine.getCmmnRuntimeService();
CmmnRepositoryService repositoryService = cmmnEngine.getCmmnRepositoryService();
CmmnTaskService taskService = cmmnEngine.getCmmnTaskService();
CmmnManagementService managementService = cmmnEngine.getCmmnManagementService();
CmmnHistoryService historyService = cmmnEngine.getCmmnHistoryService();</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CmmnEngineConfiguration.createStandaloneCmmnEngineConfiguration()</code> will initialize and build a CMMN engine and afterwards always return the CMMN engine.</p>
</div>
<div class="paragraph">
<p>The CmmnEngineConfiguration class will scan for all <code>flowable.cmmn.cfg.xml</code> and <code>flowable-cmmn-context.xml</code> files. For all <code>flowable.cmmn.cfg.xml</code> files, the CMMN engine will be built in the typical Flowable way: <code>CmmnEngineConfiguration.createCmmnEngineConfigurationFromInputStream(inputStream).buildCmmnEngine()</code>. For all <code>flowable-cmmn-context.xml</code> files, the CMMN engine will be built in the Spring way: first the Spring application context is created and then the CMMN engine is obtained from that application context.</p>
</div>
<div class="paragraph">
<p>All services are stateless. This means that you can easily run Flowable on multiple nodes in a cluster, each going to the same database, without having to worry about which machine actually executed previous calls. Any call to any service is idempotent regardless of where it is executed.</p>
</div>
<div class="paragraph">
<p>The <strong>CmmnRepositoryService</strong> is probably the first service needed when working with the Flowable CMMN engine. This service offers operations for managing and manipulating <code>deployments</code> and <code>case definitions</code>. Without going into much detail here, a case definition is a Java counterpart of the CMMN 1.1 case. It is a representation of the structure and behavior of each of the steps of a case. A <code>deployment</code> is the unit of packaging within the Flowable CMMN engine. A deployment can contain multiple CMMN 1.1 XML files and any other resource. The choice of what is included in one deployment is up to the developer. It can range from a single process CMMN 1.1 XML file to a whole package of cases and relevant resources (for example, the deployment <em>hr-cases</em> could contain everything related to HR cases). The <code>CmmnRepositoryService</code> can <code>deploy</code> such packages. Deploying a deployment means it is uploaded to the engine, where all cases are inspected and parsed before being stored in the database. From that point on, the deployment is known to the system and any process included in the deployment can now be started.</p>
</div>
<div class="paragraph">
<p>Furthermore, this service allows you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Query on deployments and case definitions known to the engine.</p>
</li>
<li>
<p>Retrieve various resources, such as files contained within the deployment or case diagrams that were auto-generated by the engine.</p>
</li>
<li>
<p>Retrieve a POJO version of the case definition, which can be used to introspect the case using Java rather than XML.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While the <code>CmmnRepositoryService</code> is mostly about static information (data that doesn&#8217;t change, or at least not a lot), the <strong>CmmnRuntimeService</strong> is quite the opposite. It deals with starting new case instances of case definitions. As said above, a <code>case definition</code> defines the structure and behavior of the different steps in a case. A case instance is one execution of such a case definition. For each case definition there typically are many instances running at the same time. The <code>CmmnRuntimeService</code> also is the service which is used to retrieve and store <code>case variables</code>. This is data that is specific to the given case instance and can be used by various constructs in the case (for example, a plan transition condition often uses process variables to determine which path is chosen to continue the case). The <code>CmmnRuntimeservice</code> also allows you to query on case instances and plan items. Plan items are a representation of the enabled plan items of CMMN 1.1. Lastly, the <code>CmmnRuntimeService</code> is used whenever a case instance is waiting for an external trigger and the case needs to be continued. A case instance can have various <code>wait states</code> and this service contains various operations to <em>signal</em> to the instance that the external trigger is received and the case instance can be continued.</p>
</div>
<div class="paragraph">
<p>Tasks that need to be performed by human users of the system are core to a CMMN engine such as Flowable. Everything around tasks is grouped in the <strong>CmmnTaskService</strong>, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Querying tasks assigned to users or groups</p>
</li>
<li>
<p>Creating new <em>standalone</em> tasks. These are tasks that are not related to a process instances.</p>
</li>
<li>
<p>Manipulating to which user a task is assigned or which users are in some way involved with the task.</p>
</li>
<li>
<p>Claiming and completing a task. Claiming means that someone decided to be the assignee for the task, meaning that this user will complete the task. Completing means <em>doing the work of the tasks</em>. Typically this is filling in a form of sorts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>CmmnHistoryService</strong> exposes all historical data gathered by the Flowable CMMN engine. When executing cases, a lot of data can be kept by the engine (this is configurable), such as case instance start times, who did which tasks, how long it took to complete the tasks, which path was followed in each case instance, and so on. This service exposes mainly query  capabilities to access this data.</p>
</div>
<div class="paragraph">
<p>The <strong>CmmnManagementService</strong> gives access to low-level information about the database tables, allows to query for the different types of jobs and to execute them.</p>
</div>
<div class="paragraph">
<p>For more detailed information on the service operations and the engine API, see <a href="http://www.flowable.org/docs/javadocs/index.html">the javadocs</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exception_strategy">3.2. Exception strategy</h3>
<div class="paragraph">
<p>The base exception in Flowable is the <code>org.flowable.engine.common.api.FlowableException</code>, an unchecked exception. This exception can be thrown at all times by the API, but <em>expected</em> exceptions that happen in specific methods are documented in <a href="http://www.flowable.org/docs/javadocs/index.html"> the javadocs</a>. For example, an extract from <code>CmmnTaskService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">/**
 * Called when the task is successfully executed.
 * @param taskId the id of the task to complete, cannot be null.
 * @throws FlowableObjectNotFoundException when no task exists with the given id.
 */
 void complete(String taskId);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, when an id is passed for which no task exists, an exception will be thrown. Also, since the javadoc <strong>explicitly states that taskId cannot be null, an <code>FlowableIllegalArgumentException</code> will be thrown when <code>null</code> is passed</strong>.</p>
</div>
<div class="paragraph">
<p>Even though we want to avoid a big exception hierarchy, the following subclasses are thrown in specific cases. All other errors that occur during process-execution or API-invocation that don&#8217;t fit into the possible exceptions below, are thrown as regular <code>FlowableExceptions</code>s.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FlowableWrongDbException</code>: Thrown when the Flowable engine discovers a mismatch between the database schema version and the engine version.</p>
</li>
<li>
<p><code>FlowableOptimisticLockingException</code>: Thrown when an optimistic locking occurs in the data store caused by concurrent access of the same data entry.</p>
</li>
<li>
<p><code>FlowableClassLoadingException</code>: Thrown when a class requested to load was not found or when an error occurred while loading it (e.g. JavaDelegates, TaskListeners, &#8230;&#8203;).</p>
</li>
<li>
<p><code>FlowableObjectNotFoundException</code>: Thrown when an object that is requested or actioned does not exist.</p>
</li>
<li>
<p><code>FlowableIllegalArgumentException</code>: An exception indicating that an illegal argument has been supplied in a Flowable API-call, an illegal value was configured in the engine&#8217;s configuration or an illegal value has been supplied or an illegal value is used in a process-definition.</p>
</li>
<li>
<p><code>FlowableTaskAlreadyClaimedException</code>: Thrown when a task is already claimed, when the <code>taskService.claim(&#8230;&#8203;)</code> is called.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="queryAPI">3.3. Query API</h3>
<div class="paragraph">
<p>There are two ways of querying data from the engine: the query API and native queries. The Query API allows you to program completely typesafe queries with a fluent API. You can add various conditions to your queries (all of which are applied together as a logical AND) and precisely one ordering. The following code shows an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">List&lt;Task&gt; tasks = taskService.createTaskQuery()
    .taskAssignee("kermit")
    .orderByDueDate().asc()
    .list();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiVariables">3.4. Variables</h3>
<div class="paragraph">
<p>Every case instance needs and uses data to execute the steps it&#8217;s made up of. In Flowable, this data is called <em>variables</em>, which are stored in the database. Variables can be used in expressions (for example, in the condition of a sentry), in Java service tasks when calling external services (for example to provide the input or store the result of the service call), and so on.</p>
</div>
<div class="paragraph">
<p>A case instance can have variables (called <em>case variables</em>), but also <em>plan item instances</em> and human tasks can have variables. A case instance can have any number of variables. Each variable is stored in a row in the <em>ACT_RU_VARIABLE</em> database table.</p>
</div>
<div class="paragraph">
<p>The <em>createCaseInstanceBuilder</em> method has optional methods to provide the variables when the case instance is created and started through the <em>CmmnRuntimeService</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">CaseInstance caseInstance = runtimeService.createCaseInstanceBuilder().variable("var1", "test").start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables can be added during case execution. For example, (<em>CmmnRuntimeService</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">void setVariables(String caseInstanceId, Map&lt;String, ? extends Object&gt; variables);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables can also be retrieved, as shown below. Note that similar methods exist on the <em>CmmnTaskService</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Map&lt;String, Object&gt; getVariables(String caseInstanceId);
Object getVariable(String caseInstanceId, String variableName);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables are often used in Java service tasks, expressions, scripts, and so on.</p>
</div>
</div>
<div class="sect2">
<h3 id="apiTransientVariables">3.5. Transient variables</h3>
<div class="paragraph">
<p>Transient variables are variables that behave like regular variables, but are not persisted. Typically, transient variables are used for advanced use cases.  When in doubt, use a regular case variable.</p>
</div>
<div class="paragraph">
<p>The following applies for transient variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is no history stored at all for transient variables.</p>
</li>
<li>
<p>Like <em>regular</em> variables, transient variables are put on the <em>highest parent</em> when set. This means that when setting a variable on an plan item, the transient variable is actually stored on the case instance execution. Like regular variables, a <em>local</em> variant of the method exists if the variable is set on the specific plan item or task.</p>
</li>
<li>
<p>A transient variable can only be accessed before the next <em>wait state</em> in the case definition. After that, they are gone. Here, the wait state means the point in the case instance where it is persisted to the data store.</p>
</li>
<li>
<p>Transient variables can only be set by the <em>setTransientVariable(name, value)</em>, but transient variables are also returned when calling <em>getVariable(name)</em> (a <em>getTransientVariable(name)</em> also exists, that only checks the transient variables). The reason for this is to make the writing of expressions easy and existing logic using variables works for both types.</p>
</li>
<li>
<p>A transient variable <em>shadows</em> a persistent variable with the same name. This means that when both a persistent and transient variable is set on a case instance and <em>getVariable("someVariable")</em> is called, the transient variable value will be returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can set and get transient variables in most places where regular variables are exposed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On <em>DelegatePlanItemInstance</em> in <em>PlanItemJavaDelegate</em> implementations</p>
</li>
<li>
<p>When starting a case instance through the runtime service</p>
</li>
<li>
<p>When completing a task</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The methods follow the naming convention of the regular case variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">CaseInstance caseInstance = runtimeService.createCaseInstanceBuilder().transientVariable("var1", "test").start();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiExpressions">3.6. Expressions</h3>
<div class="paragraph">
<p>Flowable uses UEL for expression-resolving. UEL stands for <em>Unified Expression Language</em> and is part of the EE6 specification (see <a href="http://docs.oracle.com/javaee/6/tutorial/doc/gjddd.html"> the EE6 specification</a> for detailed information).</p>
</div>
<div class="paragraph">
<p>Expressions can be used in, for example, Java Service tasks, and plan item transitions. Although there are two types of expressions, value-expression and method-expression, Flowable abstracts this so they can both be used where an <code>expression</code> is expected.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Value expression</strong>: resolves to a value. By default, all case variables are available to use. Also, all spring-beans (if using Spring) are available to use in expressions. Some examples:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${myVar}
${myBean.myProperty}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Method expression</strong>: invokes a method with or without parameters. <strong>When invoking a method without parameters, be sure to add empty parentheses after the method-name (as this distinguishes the expression from a value expression).</strong> The passed parameters can be literal values or expressions that are resolved themselves. Examples:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${printer.print()}
${myBean.addNewOrder('orderName')}
${myBean.doSomething(myVar, planItemInstance)}</pre>
</div>
</div>
<div class="paragraph">
<p>Note that these expressions support resolving primitives (including comparing them), beans, lists, arrays and maps.</p>
</div>
<div class="paragraph">
<p>On top of all process variables, there are a few default objects available that can be used in expressions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>caseInstance</code>: The <code>DelegateCaseInstance</code> holds additional information about the ongoing case instance.</p>
</li>
<li>
<p><code>planItemInstance</code>: The <code>DelegatePlanItemInstance</code> holds additional information about the current plan item.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cmmnExpressionsFunctions">3.7. Expression functions</h3>
<div class="paragraph">
<p>[Experimental] Expression functions have been added in version 6.4.0.</p>
</div>
<div class="paragraph">
<p>To make working with case variables easier, a set of out-of-the-box functions is available, under the <em>variables</em> namespace.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>variables:get(varName)</strong>: Retrieves the value of a variable. The main difference with writing the variable name directly in the expression is that using this function won&#8217;t throw an exception when the variable doesn&#8217;t exist. For example <em>${myVariable == "hello"}</em> would throw an exception if <em>myVariable</em> doesn&#8217;t exist, but <em>${var:get(myVariable) == <em>hello</em>}</em> will just work.</p>
</li>
<li>
<p><strong>variables:getOrDefault(varName, defaultValue)</strong>: similar to <em>get</em>, but with the option of providing a default value which is returned when the variable isn&#8217;t set or the value is <em>null</em>.</p>
</li>
<li>
<p><strong>variables:exists(varName)</strong>: Returns <em>true</em> if the variable has a non-null value.</p>
</li>
<li>
<p><strong>variables:isEmpty(varName)</strong> (alias <em>:empty</em>) : Checks if the variable value is not empty. Depending on the variable type, the behavior is the following:</p>
<div class="ulist">
<ul>
<li>
<p>For String variables, the variable is deemed empty if it&#8217;s the empty string.</p>
</li>
<li>
<p>For <code>java.util.Collection</code> variables, <em>true</em> is returned if the collection has no elements.</p>
</li>
<li>
<p>For <code>ArrayNode</code> variables, <em>true</em> is returned if there are no elements</p>
</li>
<li>
<p>In case the variable is <em>null</em>, <em>true</em> is always returned</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>variables:isNotEmpty(varName)</strong> (alias <em>:notEmpty</em>) : the reverse operation of <em>isEmpty</em>.</p>
</li>
<li>
<p><strong>variables:equals(varName, value)</strong> (alias <em>:eq</em>) : checks if a variable is equal to a given value. This is a shorthand function for an expression that would otherwise be written as <em>${execution.getVariable("varName") != null &amp;&amp; execution.getVariable("varName") == value}</em>.</p>
<div class="ulist">
<ul>
<li>
<p>If the variable value is null, false is returned (unless compared to null).</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>variables:notEquals(varName, value)</strong> (alias <em>:ne</em>) : the reverse comparison of <em>equals</em>.</p>
</li>
<li>
<p><strong>variables:contains(varName, value1, value2, &#8230;&#8203;)</strong>: checks if <strong>all</strong> values provided are contained within a variable. Depending on the variable type, the behavior is the following:</p>
<div class="ulist">
<ul>
<li>
<p>For String variables, the passed values are used as substrings that need to be part of the variable</p>
</li>
<li>
<p>For <code>java.util.Collection</code> variables, all the passed values need to be an element of the collection (regular <em>contains</em> semantics).</p>
</li>
<li>
<p>For <code>ArrayNode</code> variables: supports checking if the arraynode contains a JsonNode for the types that are supported as variable type</p>
</li>
<li>
<p>When the variable value is null, false is returned in all cases. When the variable value is not null, and the instance type is not one of the types above, false will be returned.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>variables:containsAny(varName, value1, value2, &#8230;&#8203;)</strong> : similar to the <em>contains</em> function, but <em>true</em> will be returned if <strong>any</strong> (and not all) the passed values is contained in the variable.</p>
</li>
<li>
<p>Comparator functions:</p>
<div class="ulist">
<ul>
<li>
<p><strong>variables:lowerThan(varName, value)</strong> (alias <em>:lessThan</em> or <em>:lt</em>) : shorthand for <em>${execution.getVariable("varName") != null &amp;&amp; execution.getVariable("varName") &lt; value}</em></p>
</li>
<li>
<p><strong>variables:lowerThanOrEquals(varName, value)</strong> (alias <em>:lessThanOrEquals</em> or <em>:lte</em>) : similar, but now for <em>&lt; =</em></p>
</li>
<li>
<p><strong>variables:greaterThan(varName, value)</strong> (alias <em>:gt</em>) : similar, but now for <em>&gt;</em></p>
</li>
<li>
<p><strong>variables:greaterThanOrEquals(varName, value)</strong> (alias <em>:gte</em>) : similar, but now for <em>&gt; =</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>variables</em> namespace is aliased to <em>vars</em> or <em>var</em>. So <em>variables:get(varName)</em> is equivalent to writing <em>vars:get(varName)</em> or <em>var:get(varName)</em>. Note that it&#8217;s not needed to put quotes around the variable name: <em>var:get(varName)</em> is equivalent to <em>var:get('varName')</em> or <em>var:get("varName")</em>.</p>
</div>
<div class="paragraph">
<p>Also note that in none of the functions above the <em>planItemInstance</em> or <em>caseInstance</em> needs to be passed into the function (as would be needed when not using a function). The engine will inject the appropriate variable scope when invoking the function. This also means that these functions can be used in exactly the same way when writing expression in BPMN process definitions.</p>
</div>
<div class="paragraph">
<p>The use of these variable functions is especially useful in CMMN, for example when it comes to writing the condition of an if-part of sentry. Take the following CMMN case definition:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.expression-functions.png" alt="cmmn.expression functions">
</div>
</div>
<div class="paragraph">
<p>Assume the sentry has an if-part besides the completion event. Right after a case instance is started, this if-part condition will be evaluated (as the stage becomes available). If the condition is of the form <em>${someVariable == someValue}</em>, this means the variable needs to be available when starting the case instance. In many cases, this is not possible or the variable comes later (e.g. from a form), which leads to a low-level <em>PropertyNotFoundException</em>. Taking the potential nullability in account, the correct expression would have to be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>${planItemInstance.getVariable('someVariable') != null &amp;&amp; planItemInstance.getVariable('someVariable') == someValue}</pre>
</div>
</div>
<div class="paragraph">
<p>Which is quite long. Using the functions above however, this can be simplified to</p>
</div>
<div class="listingblock">
<div class="content">
<pre>${var:eq(someVariable, someValue)}</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre>${var:get(someVariable) == someValue}</pre>
</div>
</div>
<div class="paragraph">
<p>The function implementations take in account the nullability of the variable (and not throw and exception in case the variable is null) and will handle the equality correctly.</p>
</div>
<div class="paragraph">
<p>Additionally, it&#8217;s possible to register custom functions that can be used in expressions. See the <code>org.flowable.common.engine.api.delegate.FlowableFunctionDelegate</code> interface for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="apiUnitTesting">3.8. Unit testing</h3>
<div class="paragraph">
<p>Cases are an integral part of software projects and they should be tested in the same way normal application logic is tested: with unit tests.
Since Flowable is an embeddable Java engine, writing unit tests for business cases is as simple as writing regular unit tests.</p>
</div>
<div class="paragraph">
<p>Flowable supports JUnit versions 4 and 5 styles of unit testing.</p>
</div>
<div class="paragraph">
<p>In the JUnit 5 style one needs to use the <code>org.flowable.cmmn.engine.test.FlowableCmmnTest</code> annotation or register the <code>org.flowable.cmmn.engine.test.FlowableCmmnExtension</code> manually.
The <code>FlowableCmmnTest</code> annotation is just a meta annotation and the does the registration of the <code>FlowableCmmnExtension</code> (i.e. it does <code>@ExtendWith(FlowableCmmnExtension.class)</code>).
This will make the CmmnEngine and the services available as parameters into the test and lifecycle methods (<code>@BeforeAll</code>, <code>@BeforeEach</code>, <code>@AfterEach</code>, <code>@AfterAll</code>).
Before each test the cmmnEngine will be initialized by default with the <code>flowable.cmmn.cfg.xml</code> resource on the classpath.
In order to specify a different configuration file the <code>org.flowable.cmmn.engine.test.CmmnConfigurationResource</code> annotation needs to be used (see second example).
Cmmn engines are cached statically over multiple unit tests when the configuration resource is the same.</p>
</div>
<div class="paragraph">
<p>By using <code>FlowableCmmnExtension</code>, you can annotate test methods with <code>org.flowable.cmmn.engine.test.CmmnDeployment</code>.
When a test method is annotated with <code>@CmmnDeployment</code>, before each test the cmmn files defined in <code>CmmnDeployment#resources</code> will be deployed.
In case there are no resources defined, a resource file of the form <code>testClassName.testMethod.cmmn</code> in the same package as the test class, will be deployed.
At the end of the test, the deployment will be deleted, including all related case instances, tasks, and so on.
See the <code>CmmnDeployment</code> class for more information.</p>
</div>
<div class="paragraph">
<p>Taking all that in account, a JUnit 5 test looks as follows:</p>
</div>
<div class="listingblock">
<div class="title">Junit 5 test with default resource</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@FlowableCmmnTest
class MyTest {

  private CmmnEngine cmmnEngine;
  private CmmnRuntimeService cmmnRuntimeService;
  private CmmnTaskService cmmnTaskService;

  @BeforeEach
  void setUp(CmmnEngine cmmnEngine) {
    this.cmmnEngine = cmmnEngine;
    this.cmmnRuntimeService = cmmnEngine.getCmmnRuntimeService();
    this.cmmnTaskService = cmmnEngine.getTaskRuntimeService();
  }

  @Test
  @CmmnDeployment
  void testSingleHumanTask() {
    CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()
                    .caseDefinitionKey("myCase")
                    .start();
	assertNotNull(caseInstance);

    Task task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();
    assertEquals("Task 1", task.getName());
    assertEquals("JohnDoe", task.getAssignee());

    cmmnTaskService.complete(task.getId());
    assertEquals(0, cmmnRuntimeService.createCaseInstanceQuery().count());
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>With JUnit 5 you can also inject the id of the deployment (with +org.flowable.cmmn.engine.test.CmmnDeploymentId+_) into your test and lifecycle methods.</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Junit 5 test with custom resource</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@FlowableCmmnTest
@CmmnConfigurationResource("flowable.custom.cmmn.cfg.xml")
class MyTest {

  private CmmnEngine cmmnEngine;
  private CmmnRuntimeService cmmnRuntimeService;
  private CmmnTaskService cmmnTaskService;

  @BeforeEach
  void setUp(CmmnEngine cmmnEngine) {
    this.cmmnEngine = cmmnEngine;
    this.cmmnRuntimeService = cmmnEngine.getCmmnRuntimeService();
    this.cmmnTaskService = cmmnEngine.getTaskRuntimeService();
  }
  @Test
  @CmmnDeployment
  void testSingleHumanTask() {
    CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()
                    .caseDefinitionKey("myCase")
                    .start();
	assertNotNull(caseInstance);

    Task task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();
    assertEquals("Task 1", task.getName());
    assertEquals("JohnDoe", task.getAssignee());

    cmmnTaskService.complete(task.getId());
    assertEquals(0, cmmnRuntimeService.createCaseInstanceQuery().count());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the JUnit 4 style, the <em>org.flowable.cmmn.engine.test.FlowableCmmnTestCase</em> is available as parent class. It uses a configuration file <em>flowable.cmmn.cfg.xml</em> by default or uses a standard CmmnEngine using an H2 in-memory database if such file is missing.
Behind the scenes, a CmmnTestRunner is used to initialise the CMMN engine. Note in the example below how the <em>@CmmnDeployment</em> annotation is used to automatically deploy the case definition (it will look for a .cmmn file in the same folder as the test class and expects the file to be named &lt;Test class name&gt;.&lt;test method name&gt;.cmmn.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class MyTest extends FlowableCmmnTestCase {

  @Test
  @CmmnDeployment
  public void testSingleHumanTask() {
    CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()
                    .caseDefinitionKey("myCase")
                    .start();
	assertNotNull(caseInstance);

    Task task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();
    assertEquals("Task 1", task.getName());
    assertEquals("JohnDoe", task.getAssignee());

    cmmnTaskService.complete(task.getId());
    assertEquals(0, cmmnRuntimeService.createCaseInstanceQuery().count());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, the <em>FlowableCmmnRule</em> is available and allows to set a custom configuration:</p>
</div>
<div class="listingblock">
<div class="title">JUnit 4 test with a Rule</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@Rule
public FlowableCmmnRule cmmnRule = new FlowableCmmnRule("org/flowable/custom.cfg.xml")

@Test
@CmmnDeployment
public void testSomething() {
    // ...
    assertThat((String) cmmnRule.getCmmnRuntimeService().getVariable(caseInstance.getId(), "test"), containsString("John"));
    // ...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="springintegration">4. Spring integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While you can definitely use Flowable without Spring, we&#8217;ve provided some very nice integration features that are explained in this chapter.</p>
</div>
<div class="sect2">
<h3 id="_cmmnenginefactorybean">4.1. CmmnEngineFactoryBean</h3>
<div class="paragraph">
<p>The <code>CmmnEngine</code> can be configured as a regular Spring bean. The starting point of the integration is the class <code>org.flowable.cmmn.spring.CmmnEngineFactoryBean</code>. That bean takes a CMMN engine configuration and creates the CMMN engine.  This means that the creation and configuration of properties for Spring is the same as documented in the <a href="#configuration">configuration section</a>. For Spring integration, the configuration and engine beans will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;bean id="cmmnEngineConfiguration" class="org.flowable.cmmn.spring.SpringCmmnEngineConfiguration"&gt;
    ...
&lt;/bean&gt;

&lt;bean id="cmmnEngine" class="org.flowable.cmmn.spring.CmmnEngineFactoryBean"&gt;
  &lt;property name="cmmnEngineConfiguration" ref="cmmnEngineConfiguration" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>cmmnEngineConfiguration</code> bean now uses the <code>org.flowable.cmmn.spring.SpringCmmnEngineConfiguration</code> class.</p>
</div>
</div>
<div class="sect2">
<h3 id="_default_spring_configuration">4.2. Default Spring configuration</h3>
<div class="paragraph">
<p>The section shown below contains the dataSource, transactionManager, cmmnEngine and the Flowable engine services.</p>
</div>
<div class="paragraph">
<p>When passing the DataSource to the <code>SpringCmmnEngineConfiguration</code> (using property "dataSource"), Flowable uses a <code>org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy</code> internally, which wraps the passed DataSource. This is done to make sure the SQL connections retrieved from the DataSource and the Spring transactions play well together. This implies that it&#8217;s no longer necessary to proxy the dataSource yourself in Spring configuration, although it&#8217;s still possible to pass a <code>TransactionAwareDataSourceProxy</code> into the <code>SpringCmmnEngineConfiguration</code>. In this case, no additional wrapping will occur.</p>
</div>
<div class="paragraph">
<p><strong>Make sure when declaring a <code>TransactionAwareDataSourceProxy</code> in Spring configuration yourself that you don&#8217;t use it for resources that are already aware of Spring transactions (e.g. DataSourceTransactionManager need the un-proxied dataSource).</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                             http://www.springframework.org/schema/beans/spring-beans.xsd
                           http://www.springframework.org/schema/context
                             http://www.springframework.org/schema/context/spring-context-2.5.xsd
                           http://www.springframework.org/schema/tx
                             http://www.springframework.org/schema/tx/spring-tx-3.0.xsd"&gt;

  &lt;bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource"&gt;
    &lt;property name="driverClass" value="org.h2.Driver" /&gt;
    &lt;property name="url" value="jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000" /&gt;
    &lt;property name="username" value="sa" /&gt;
    &lt;property name="password" value="" /&gt;
  &lt;/bean&gt;

  &lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
    &lt;property name="dataSource" ref="dataSource" /&gt;
  &lt;/bean&gt;

  &lt;bean id="cmmnEngineConfiguration" class="org.flowable.cmmn.spring.SpringCmmnEngineConfiguration"&gt;
    &lt;property name="dataSource" ref="dataSource" /&gt;
    &lt;property name="transactionManager" ref="transactionManager" /&gt;
    &lt;property name="databaseSchemaUpdate" value="true" /&gt;
  &lt;/bean&gt;

  &lt;bean id="cmmnEngine" class="org.flowable.cmmn.spring.CmmnEngineFactoryBean"&gt;
    &lt;property name="cmmnEngineConfiguration" ref="cmmnEngineConfiguration" /&gt;
  &lt;/bean&gt;

  &lt;bean id="cmmnRepositoryService" factory-bean="cmmnEngine" factory-method="getCmmnRepositoryService" /&gt;
  &lt;bean id="cmmnRuntimeService" factory-bean="cmmnEngine" factory-method="getCmmnRuntimeService" /&gt;
  &lt;bean id="cmmnTaskService" factory-bean="cmmnEngine" factory-method="getCmmnTaskService" /&gt;
  &lt;bean id="cmmnHistoryService" factory-bean="cmmnEngine" factory-method="getCmmnHistoryService" /&gt;
  &lt;bean id="cmmnManagementService" factory-bean="cmmnEngine" factory-method="getCmmnManagementService" /&gt;

...</code></pre>
</div>
</div>
<div class="paragraph">
<p>First, the application context is created using any of the ways supported by Spring. In this example, you could use a classpath XML resource to configure our Spring application context:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext(
	"org/flowable/cmmn/examples/spring/SpringIntegrationTest-context.xml");</code></pre>
</div>
</div>
<div class="paragraph">
<p>or, as it&#8217;s a test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@ContextConfiguration(
  "classpath:org/flowable/cmmn/spring/test/SpringIntegrationTest-context.xml")</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="springExpressions">4.3. Expressions</h3>
<div class="paragraph">
<p>When using the CmmnEngineFactoryBean, all expressions in the CMMN processes will also <em>see</em> all the Spring beans, by default. It&#8217;s possible to limit the beans (even none) you want to expose in expressions using a map that you can configure.  The example below exposes a single bean (printer), available to use under the key "printer".  <strong>To have NO beans exposed at all, just pass an empty list as <em>beans</em> property on the SpringCmmnEngineConfiguration. When no <em>beans</em> property is set, all Spring beans in the context will be available.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;bean id="cmmnEngineConfiguration" class="org.flowable.cmmn.spring.SpringCmmnEngineConfiguration"&gt;
  ...
  &lt;property name="beans"&gt;
    &lt;map&gt;
      &lt;entry key="printer" value-ref="printer" /&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;

&lt;bean id="printer" class="org.flowable.cmmn.examples.spring.Printer" /&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the exposed beans can be used in expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">...
	&lt;case id="myCase"&gt;
        &lt;casePlanModel id="myPlanModel" name="My CasePlanModel"&gt;

            &lt;planItem id="planItem1" name="Task One" definitionRef="serviceTask" /&gt;
            &lt;planItem id="planItem2" name="The Case" definitionRef="task"&gt;
                &lt;entryCriterion sentryRef="sentry1" /&gt;
            &lt;/planItem&gt;

            &lt;sentry id="sentry1"&gt;
                &lt;planItemOnPart sourceRef="planItem1"&gt;
                    &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
                &lt;/planItemOnPart&gt;
            &lt;/sentry&gt;

            &lt;task id="serviceTask" flowable:type="java" flowable:expression="${printer.printMessage(var1)}" flowable:resultVariableName="customResponse" /&gt;
            &lt;task id="task" name="The Task" isBlocking="true" /&gt;

        &lt;/casePlanModel&gt;
    &lt;/case&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>Printer</code> looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class Printer {

  public void printMessage(String var) {
    System.out.println("hello " + var);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the Spring bean configuration (also shown above) looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;beans&gt;
  ...

  &lt;bean id="printer" class="org.flowable.cmmn.examples.spring.Printer" /&gt;

&lt;/beans&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_automatic_resource_deployment">4.4. Automatic resource deployment</h3>
<div class="paragraph">
<p>Spring integration also has a special feature for deploying resources.  In the CMMN engine configuration, you can specify a set of resources. When the CMMN engine is created, all those resources will be scanned and deployed.  There is filtering in place that prevents duplicate deployments.  Only when the resources have actually changed will new deployments be deployed to the Flowable DB. This makes sense in a lot of use cases, where the Spring container is rebooted frequently (for example, testing).</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;bean id="cmmnEngineConfiguration" class="org.flowable.cmmn.spring.SpringCmmnEngineConfiguration"&gt;
  ...
  &lt;property name="deploymentResources"
    value="classpath*:/org/flowable/cmmn/spring/test/autodeployment/autodeploy.*.cmmn" /&gt;
&lt;/bean&gt;

&lt;bean id="cmmnEngine" class="org.flowable.cmmn.spring.CmmnEngineFactoryBean"&gt;
  &lt;property name="cmmnEngineConfiguration" ref="cmmnEngineConfiguration" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the configuration above will group all of the resources matching the filter into a single deployment to the Flowable engine. The duplicate filtering to prevent re-deployment of unchanged resources applies to the whole deployment. In some cases, this may not be what you want. For instance, if you deploy a set of process resources this way and only a single case definition in those resources has changed, the deployment as a whole will be considered new and all of the case definitions in that deployment will be re-deployed, resulting in new  versions of each of the case definitions, even though only one was actually changed.</p>
</div>
<div class="paragraph">
<p>To be able to customize the way deployments are determined, you can specify an additional property in the <code>SpringCmmnEngineConfiguration</code>, <code>deploymentMode</code>. This property defines the way deployments will be determined from the set of resources that match the filter. There are 3 values that are supported by default for this property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>default</code>: Group all resources into a single deployment and apply duplicate filtering to that deployment. This is the default value and it will be used if you don&#8217;t specify a value.</p>
</li>
<li>
<p><code>single-resource</code>: Create a separate deployment for each individual resource and apply duplicate filtering to that deployment. This is the value you would use to have each process definition be deployed separately and only create a new case definition version if it has changed.</p>
</li>
<li>
<p><code>resource-parent-folder</code>: Create a separate deployment for resources that share the same parent folder and apply duplicate filtering to that deployment. This value can be used to create separate deployments for most resources, but still be able to group some by placing them in a shared folder. Here&#8217;s an example of how to specify the <code>single-resource</code> configuration for <code>deploymentMode</code>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;bean id="cmmnEngineConfiguration"
    class="org.flowable.cmmn.spring.SpringCmmnEngineConfiguration"&gt;
  ...
  &lt;property name="deploymentResources" value="classpath*:/flowable/*.cmmn" /&gt;
  &lt;property name="deploymentMode" value="single-resource" /&gt;
&lt;/bean&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to using the values listed above for <code>deploymentMode</code>, you may require customized behavior towards determining deployments. If so, you can create a subclass of <code>SpringCmmnEngineConfiguration</code> and override the <code>getAutoDeploymentStrategy(String deploymentMode)</code> method.  This method determines which deployment strategy is used for a certain value of the <code>deploymentMode</code> configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="springUnitTest">4.5. Unit testing</h3>
<div class="paragraph">
<p>When integrating with Spring, business cases can be tested very easily using the standard standard <a href="#apiUnitTesting">Flowable testing facilities</a>.
The following examples show how a case definition is tested in typical Spring-based JUnit 4 and 5 test:</p>
</div>
<div class="listingblock">
<div class="title">JUnit 5 test</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">@ExtendWith(FlowableCmmnSpringExtension.class)
@ExtendWith(SpringExtension.class)
@ContextConfiguration(classes = CmmnSpringJunitJupiterTest.TestConfiguration.class)
class MyBusinessCaseTest {

  @Autowired
  private CmmnRepositoryService cmmnRepositoryService;

  @Autowired
  private CmmnRuntimeService cmmnRuntimeService;

  @Test
  @CmmnDeployment
  public void simpleCaseTest() {
    CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()
    		.caseDefinitionKey("simpleCase")
            .variable("var1", "John Doe")
            .start();

	Assertions.assertNotNull(caseInstance);
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">JUnit 4 test</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class MyBusinessCaseTest {

  @Rule
  public FlowableCmmnRule cmmnRule = new FlowableCmmnRule("org/flowable/spring/test/el/SpringBeanTest-context.xml");

  @Test
  public void simpleCaseTest() {
    cmmnRule.getCmmnRepositoryService().createDeployment().addClasspathResource("org/flowable/spring/test/el/springExpression.cmmn").deploy();
    CmmnRuntimeService cmmnRuntimeService = cmmnRule.getCmmnRuntimeService();
    CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()
    		.caseDefinitionKey("myCase")
            .variable("var1", "John Doe")
            .start();

	Assert.assertNotNull(caseInstance);
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chDeployment">5. Deployment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_external_resources">5.1. External resources</h3>
<div class="paragraph">
<p>Case definitions live in the Flowable database. These case definitions can reference delegation classes when using Service Tasks or Spring beans from the Flowable configuration file. These classes and the Spring configuration file have to be available to all CMMN engines that may execute the case definitions.</p>
</div>
<div class="sect3">
<h4 id="_java_classes">5.1.1. Java classes</h4>
<div class="paragraph">
<p>All custom classes that are used in your case definition (for example, PlanItemJavaDelegates used in Service Tasks) should be present on the engine&#8217;s classpath when an instance of the case is started.</p>
</div>
<div class="paragraph">
<p>During deployment of a case definition however, those classes don&#8217;t have to be present on the classpath. This means that your delegation classes don&#8217;t have to be on the classpath when deploying a new case definition, for example.</p>
</div>
<div class="paragraph">
<p>When you are using the demo setup and you want to add your custom classes, you should add a JAR containing your classes to the flowable-task or flowable-rest webapp lib. Don&#8217;t forget to include the dependencies of your custom classes (if any) as well. Alternatively, you can include your dependencies in the libraries directory of your Tomcat installation, <code>${tomcat.home}/lib</code> (or similar place for other web containers).</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_spring_beans_from_a_case_instance">5.1.2. Using Spring beans from a case instance</h4>
<div class="paragraph">
<p>When expressions or scripts use Spring beans, those beans have to be available to the engine when executing the case definition. If you are building your own webapp and you configure your CMMN engine in your context as described in <a href="#springintegration">the spring integration section</a>, that is straightforward. But bear in mind that you also should update the Flowable task and rest webapps with that context if you use it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="versioningOfCaseDefinitions">5.2. Versioning of case definitions</h3>
<div class="paragraph">
<p>CMMN doesn&#8217;t have a notion of versioning.  That is actually good, because the executable CMMN file will probably live in a version control system repository (such as Subversion, Git or Mercurial) as part of your development project.  However, versions of case definitions are created in the engine as part of deployment. During deployment, Flowable will assign a version to the <code>CaseDefinition</code> before it is stored in the Flowable DB.</p>
</div>
<div class="paragraph">
<p>For each case definition in a deployment, the following steps are performed to initialize the properties <code>key</code>, <code>version</code>, <code>name</code> and <code>id</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The case definition <code>id</code> attribute in the XML file is used as the case definition <code>key</code> property.</p>
</li>
<li>
<p>The case definition <code>name</code> attribute in the XML file is used as the case definition <code>name</code> property. If the name attribute is not specified, then the id attribute is used as the name.</p>
</li>
<li>
<p>The first time a case with a particular key is deployed, version 1 is assigned.  For all subsequent deployments of case definitions with the same key, the version will be set 1 higher than the highest currently deployed version. The key property is used to distinguish case definitions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Take for example the following case</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;definitions id="myDefinitions" &gt;
  &lt;case id="myCase" name="My important case" &gt;
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>When deploying this case definition, the case definition in the database will look like this:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Suppose we now deploy an updated version of the same case (for example, changing some human tasks), but the <code>id</code> of the case definition remains the same. The case definition table will now contain the following entries:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">870</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the <code>runtimeService.createCaseInstanceBuilder().caseDefinitionKey("myCase").start()</code> is called, it will now use the case definition with version <code>2</code>, as this is the latest version of the case definition.</p>
</div>
<div class="paragraph">
<p>Should we create a second case, as defined below and deploy this to Flowable, a third row will be added to the table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;definitions id="myNewDefinitions" &gt;
  &lt;case id="myNewCase" name="My important case" &gt;
    ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The table will look like this:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">id</th>
<th class="tableblock halign-left valign-top">key</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">676</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">870</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1033</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">myNewCase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">My important case</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note how the key for the new case is different from our first case. Even though the name is the same (we should probably have changed that too), Flowable only considers the <code>id</code> attribute when distinguishing cases. The new case is therefore deployed with version 1.</p>
</div>
</div>
<div class="sect2">
<h3 id="deploymentCategory">5.3. Category</h3>
<div class="paragraph">
<p>Both deployments and case definitions have user-defined categories.  The case definition category is initialized with the value of the targetNamespace attribute in the CMMN XML: <code>&lt;definitions &#8230;&#8203; targetNamespace="yourCategory" &#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>The deployment category can also be specified in the API like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">repositoryService
    .createDeployment()
    .category("yourCategory")
    ...
    .deploy();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cmmn_1_1">6. CMMN 1.1</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_cmmn">6.1. What is CMMN?</h3>
<div class="paragraph">
<p>The Case Management Model and Notation (CMMN) is a standard notation and formal specification by the <a href="http://www.omg.org/spec/CMMN/">Object Management Group</a> for representing case models.</p>
</div>
<div class="paragraph">
<p>Flowable contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A CMMN 1.1 modeler to create CMMN 1.1 case models</p>
</li>
<li>
<p>A Java engine that can import and execute CMMN 1.1 case models</p>
</li>
<li>
<p>A demonstration UI that executes the case models, allowing users to see and complete human tasks (and their forms)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_basic_concepts_and_terminology">6.2. Basic concepts and terminology</h3>
<div class="paragraph">
<p>The following figure shows a simple CMMN 1.1 diagram:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn-basic-concepts.png" alt="cmmn basic concepts">
</div>
</div>
<div class="paragraph">
<p>A <strong>case model</strong> is always visualized as some sort of <em>folder</em> that contains all the case elements. Every case model contains a <strong>plan model</strong> onto which items will be <em>planned</em>.</p>
</div>
<div class="paragraph">
<p>The elements of a plan model are called <strong>plan items</strong>. Each <em>plan item</em> has a <strong>plan item definition</strong> that gives its type and possible configuration options at runtime. For example, in the figure above, there are three <strong>human task</strong> plan items and one <strong>milestone</strong>. Other examples of plan items are <em>process tasks, case tasks and stages</em>.</p>
</div>
<div class="paragraph">
<p>After having deployed a case model to the Flowable CMMN engine, it&#8217;s possible to start <strong>case instances</strong> based on this case model. The plan items defined in the case model similarly have <strong>plan item instance</strong> runtime representations that are exposed by, and can be queried using, the Flowable API. Plan item instances have a state lifecycle that is defined in the CMMN 1.1 specification and is core to how the engine works. Please check out section 8.4.2 of the CMMN 1.1 specification for all the details.</p>
</div>
<div class="paragraph">
<p>Plan items can have <em>sentries</em>: a plan item is said to have <em>entry criteria</em> when a sentry "guards" its activation. These criteria specify conditions that must be satisfied to <em>trigger the sentry</em>. For example, in the figure above, the "Milestone One" plan item is <em>available</em> after a case instance is started, but it is <em>activated</em> (in CMMN 1.1 specification terminology: it moves from the <em>available</em> state to the <em>active</em> state) when both human task A and B are completed. Note that sentries can have complex expression in their <em>if part</em>, which are not visualized, allowing for much more complex functionality. Also note that there can be multiple sentries, although only one needs to be satisfied to trigger a state transition.</p>
</div>
<div class="paragraph">
<p>Plan items and the plan model can also have sentries with <em>exit criteria</em>, which specify conditions that trigger an <em>exit</em> from that particular plan item. In the figure above, the whole plan model is exited (as are all the child elements that are active at that moment), when human task C completes.</p>
</div>
<div class="paragraph">
<p>CMMN 1.1 defines a standard XML format in an XSD that is part of the specification. For information, the example in the figure above is represented in XML as shown below.</p>
</div>
<div class="paragraph">
<p>Some observations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The four plan items above are in the XML and they reference their definition with a <em>definitionRef</em>. The actual definitions are at the bottom of the <em>casePlanModel</em> element</p>
</li>
<li>
<p>The plan items have criteria (entry or exit) that reference a <em>sentry</em> (not the other way around)</p>
</li>
<li>
<p>The XML also contains information on how the diagram is visualized (x and y coordinates, widths and heights, and so on), which are omitted below. These elements are important when exchanging case models with other CMMN 1.1 modeling tools to preserve the correct visual representation</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions xmlns="http://www.omg.org/spec/CMMN/20151109/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:flowable="http://flowable.org/cmmn"
             xmlns:cmmndi="http://www.omg.org/spec/CMMN/20151109/CMMNDI"
             xmlns:dc="http://www.omg.org/spec/CMMN/20151109/DC"
             xmlns:di="http://www.omg.org/spec/CMMN/20151109/DI"
             targetNamespace="http://www.flowable.org/casedef"&gt;
  &lt;case id="simpleExample" name="Simple Example"&gt;
    &lt;casePlanModel id="casePlanModel" name="My Case"&gt;
      &lt;planItem id="planItem1" name="Human task A"
            definitionRef="sid-88199E7C-7655-439C-810B-8849FC52D3EB"&gt;&lt;/planItem&gt;
      &lt;planItem id="planItem2" name="Milestone One"
            definitionRef="sid-8BF8A774-A8A7-4F1A-95CF-1E0D61EE5A47"&gt;
        &lt;entryCriterion id="sid-62CC4A6D-B29B-4129-93EA-460253C45CDF"
            sentryRef="sentry1"&gt;&lt;/entryCriterion&gt;
      &lt;/planItem&gt;
      &lt;planItem id="planItem3" name="Human task B"
            definitionRef="sid-A1FB8733-0DBC-4B38-9830-CBC4D0C4B802"&gt;&lt;/planItem&gt;
      &lt;planItem id="planItem4" name="Human task C"
            definitionRef="sid-D3970AFC-7391-4BA7-95BA-51C64D2F41E9"&gt;&lt;/planItem&gt;
      &lt;sentry id="sentry1"&gt;
        &lt;planItemOnPart id="sentryOnPart1" sourceRef="planItem1"&gt;
          &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
        &lt;/planItemOnPart&gt;
        &lt;planItemOnPart id="sentryOnPart2" sourceRef="planItem3"&gt;
          &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
        &lt;/planItemOnPart&gt;
      &lt;/sentry&gt;
      &lt;sentry id="sentry2"&gt;
        &lt;planItemOnPart id="sentryOnPart3" sourceRef="planItem4"&gt;
          &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
        &lt;/planItemOnPart&gt;
      &lt;/sentry&gt;
      &lt;humanTask id="sid-88199E7C-7655-439C-810B-8849FC52D3EB"
        name="Human task A"&gt;&lt;/humanTask&gt;
      &lt;milestone id="sid-8BF8A774-A8A7-4F1A-95CF-1E0D61EE5A47"
        name="Milestone One"&gt;&lt;/milestone&gt;
      &lt;humanTask id="sid-A1FB8733-0DBC-4B38-9830-CBC4D0C4B802"
        name="Human task B"&gt;&lt;/humanTask&gt;
      &lt;humanTask id="sid-D3970AFC-7391-4BA7-95BA-51C64D2F41E9"
        name="Human task C"&gt;&lt;/humanTask&gt;
      &lt;exitCriterion id="sid-422626DB-9B40-49D8-955E-641AB96A5BFA"
        sentryRef="sentry2"&gt;&lt;/exitCriterion&gt;
    &lt;/casePlanModel&gt;
  &lt;/case&gt;
  &lt;cmmndi:CMMNDI&gt;
    &lt;cmmndi:CMMNDiagram id="CMMNDiagram_simpleExample"&gt;
        ...
    &lt;/cmmndi:CMMNDiagram&gt;
  &lt;/cmmndi:CMMNDI&gt;
&lt;/definitions&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_programmatic_example">6.3. Programmatic example</h3>
<div class="paragraph">
<p>In this section we&#8217;re going to build a simple case model and execute it programmatically through the Java APIs of the Flowable CMMN engine in a simple command line example.</p>
</div>
<div class="paragraph">
<p>The case model we&#8217;ll build is a simplified <em>employee onboarding</em> case with two stages: a phase before and phase after the potential employee has started. In the first stage, someone from the HR department will complete the tasks, while in the second stage it is the employee completing them. Also, at any point in time, the potential employee can reject the job and stop the whole case instance.</p>
</div>
<div class="paragraph">
<p>Note that only stages and human tasks are used. In a real case model, there will most likely other plan item types too, such as milestones, nested stages, automated tasks, and so on.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.programmatic.example.png" alt="cmmn.programmatic.example">
</div>
</div>
<div class="paragraph">
<p>The XML for this case model is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions xmlns="http://www.omg.org/spec/CMMN/20151109/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:flowable="http://flowable.org/cmmn"
             xmlns:cmmndi="http://www.omg.org/spec/CMMN/20151109/CMMNDI"
             xmlns:dc="http://www.omg.org/spec/CMMN/20151109/DC"
             xmlns:di="http://www.omg.org/spec/CMMN/20151109/DI"
             targetNamespace="http://www.flowable.org/casedef"&gt;
  &lt;case id="employeeOnboarding" name="Simple Example"&gt;
    &lt;casePlanModel id="casePlanModel" name="My Case"&gt;
      &lt;planItem id="planItem5" name="Prior to starting"
            definitionRef="sid-025D29E8-BA9B-403D-A684-8C5B52185642"&gt;&lt;/planItem&gt;
      &lt;planItem id="planItem8" name="After starting"
            definitionRef="sid-8459EF32-4F4C-4E9B-A6E9-87FDC2299044"&gt;
        &lt;entryCriterion id="sid-50B5F12D-FE75-4D05-9148-86574EE6C073"
            sentryRef="sentry2"&gt;&lt;/entryCriterion&gt;
      &lt;/planItem&gt;
      &lt;planItem id="planItem9" name="Reject job"
            definitionRef="sid-134E885A-3D58-417E-81E2-66A3E12334F9"&gt;&lt;/planItem&gt;
      &lt;sentry id="sentry2"&gt;
        &lt;planItemOnPart id="sentryOnPart4" sourceRef="planItem5"&gt;
          &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
        &lt;/planItemOnPart&gt;
      &lt;/sentry&gt;
      &lt;sentry id="sentry3"&gt;
        &lt;planItemOnPart id="sentryOnPart5" sourceRef="planItem9"&gt;
          &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
        &lt;/planItemOnPart&gt;
      &lt;/sentry&gt;
      &lt;stage id="sid-025D29E8-BA9B-403D-A684-8C5B52185642" name="Prior to starting"&gt;
        &lt;planItem id="planItem1" name="Create email address"
                definitionRef="sid-EA434DDD-E1BE-4AC1-8520-B19ACE8782D2"&gt;&lt;/planItem&gt;
        &lt;planItem id="planItem2" name="Allocate office"
                definitionRef="sid-505BA223-131A-4EF0-ABAD-485AEB0F2C96"&gt;&lt;/planItem&gt;
        &lt;planItem id="planItem3" name="Send joining letter to candidate"
                definitionRef="sid-D28DBAD5-0F5F-45F4-8553-3381199AC45F"&gt;
          &lt;entryCriterion id="sid-4D88C79D-8E31-4246-9541-A4F6A5720AC8"
            sentryRef="sentry1"&gt;&lt;/entryCriterion&gt;
        &lt;/planItem&gt;
        &lt;planItem id="planItem4" name="Agree start date"
                definitionRef="sid-97A72C46-C0AD-477F-86DD-85EF643BB97D"&gt;&lt;/planItem&gt;
        &lt;sentry id="sentry1"&gt;
          &lt;planItemOnPart id="sentryOnPart1" sourceRef="planItem1"&gt;
            &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
          &lt;/planItemOnPart&gt;
          &lt;planItemOnPart id="sentryOnPart2" sourceRef="planItem2"&gt;
            &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
          &lt;/planItemOnPart&gt;
          &lt;planItemOnPart id="sentryOnPart3" sourceRef="planItem4"&gt;
            &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
          &lt;/planItemOnPart&gt;
        &lt;/sentry&gt;
        &lt;humanTask id="sid-EA434DDD-E1BE-4AC1-8520-B19ACE8782D2"
            name="Create email address"
            flowable:candidateGroups="hr"&gt;&lt;/humanTask&gt;
        &lt;humanTask id="sid-505BA223-131A-4EF0-ABAD-485AEB0F2C96"
            name="Allocate office"
            flowable:candidateGroups="hr"&gt;&lt;/humanTask&gt;
        &lt;humanTask id="sid-D28DBAD5-0F5F-45F4-8553-3381199AC45F"
            name="Send joining letter to candidate"
            flowable:candidateGroups="hr"&gt;&lt;/humanTask&gt;
        &lt;humanTask id="sid-97A72C46-C0AD-477F-86DD-85EF643BB97D"
            name="Agree start date"
            flowable:candidateGroups="hr"&gt;&lt;/humanTask&gt;
      &lt;/stage&gt;
      &lt;stage id="sid-8459EF32-4F4C-4E9B-A6E9-87FDC2299044"
        name="After starting"&gt;
        &lt;planItem id="planItem6" name="New starter training"
                definitionRef="sid-DF7B9582-11A6-40B4-B7E5-EC7AC6029387"&gt;&lt;/planItem&gt;
        &lt;planItem id="planItem7" name="Fill in paperwork"
                definitionRef="sid-7BF2B421-7FA0-479D-A8BD-C22EBD09F599"&gt;&lt;/planItem&gt;
        &lt;humanTask id="sid-DF7B9582-11A6-40B4-B7E5-EC7AC6029387"
            name="New starter training"
            flowable:assignee="${potentialEmployee}"&gt;&lt;/humanTask&gt;
        &lt;humanTask id="sid-7BF2B421-7FA0-479D-A8BD-C22EBD09F599"
            name="Fill in paperwork"
            flowable:assignee="${potentialEmployee}"&gt;&lt;/humanTask&gt;
      &lt;/stage&gt;
      &lt;humanTask id="sid-134E885A-3D58-417E-81E2-66A3E12334F9" name="Reject job"
        flowable:assignee="${potentialEmployee}"&gt;&lt;/humanTask&gt;
      &lt;exitCriterion id="sid-18277F30-E146-4B3E-B3C9-3F1E187EC7A8"
        sentryRef="sentry3"&gt;&lt;/exitCriterion&gt;
    &lt;/casePlanModel&gt;
  &lt;/case&gt;
&lt;/definitions&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>First of all, create a new project and add the <em>flowable-cmmn-engine</em> dependency (here shown for Maven). The H2 dependency is also added, as H2 will be used as embedded database later on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.flowable&lt;/groupId&gt;
    &lt;artifactId&gt;flowable-cmmn-engine&lt;/artifactId&gt;
    &lt;version&gt;${flowable.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.h2database&lt;/groupId&gt;
    &lt;artifactId&gt;h2&lt;/artifactId&gt;
    &lt;version&gt;${h2.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Flowable CMMN API is designed to be consistent with the other Flowable APIs and concepts. As such, people that know the BPMN or DMN APIs will have no problem finding their way around. As with the other engines, the first line of code is creating a CmmnEngine. Here, the default in-memory configuration is used, which uses H2 as the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class Main {
  public static void main(String[] args) {
    CmmnEngine cmmnEngine
        = new StandaloneInMemCmmnEngineConfiguration().buildCmmnEngine();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <em>CmmnEngineConfiguration</em> exposes many configuration options for tweaking various settings of the CMMN engine.</p>
</div>
<div class="paragraph">
<p>Put the XML from above in a file, for example <em>my-case.cmmn</em> (or .cmmn.xml). For Maven, it should be placed in the <em>src/main/resources</em> folder.</p>
</div>
<div class="paragraph">
<p>To make the engine aware of the case model, it first needs to be <em>deployed</em>. This is done through the <em>CmmnRepositoryService</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">CmmnRepositoryService cmmnRepositoryService = cmmnEngine.getCmmnRepositoryService();
CmmnDeployment cmmnDeployment = cmmnRepositoryService.createDeployment()
    .addClasspathResource("my-case.cmmn")
    .deploy();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Deploying the XML will return a <strong>CmmnDeployment</strong>. A deployment can contain many case models and artifacts. The specific case model definition above is stored as a <strong>CaseDefinition</strong>. This can be verified by doing a <em>CaseDefinitionQuery</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">List&lt;CaseDefinition&gt; caseDefinitions = cmmnRepositoryService.createCaseDefinitionQuery().list();
System.out.println("Found " + caseDefinitions.size() + " case definitions");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Having a <strong>CaseDefinition</strong> in the engine, it&#8217;s now possible to start a <strong>CaseInstance</strong> for this case model definition. Either the result from the query is used and passed into the following snippet of code, or the <em>key</em> of the case definition is used directly (as done below).</p>
</div>
<div class="paragraph">
<p>Note that we&#8217;re also passing data, an identifier to the <em>potentialEmployee</em> as a variable when starting the <strong>CaseInstance</strong>. This variable will later be used in the human tasks to assign the task to the correct person (see the <em>assignee="${potentialEmployee}"</em> attribute on <em>human tasks</em>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">CmmnRuntimeService cmmnRuntimeService = cmmnEngine.getCmmnRuntimeService();
CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()
    .caseDefinitionKey("employeeOnboarding")
    .variable("potentialEmployee", "johnDoe")
    .start();</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the <strong>CaseInstance</strong> is started, the engine will determine which of the plan items of the model should be activated:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first stage has no entry criteria, so it&#8217;s activated</p>
</li>
<li>
<p>The child human tasks of the first stage have no entry criteria, so three of them are expected to be active</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The plan items are represented at runtime by <strong>PlanItemInstances</strong> and can be queried through the <em>CmmnRuntimeService</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">List&lt;PlanItemInstance&gt; planItemInstances = cmmnRuntimeService.createPlanItemInstanceQuery()
    .caseInstanceId(caseInstance.getId())
    .orderByName().asc()
    .list();

for (PlanItemInstance planItemInstance : planItemInstances) {
    System.out.println(planItemInstance.getName());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>which prints out</p>
</div>
<div class="listingblock">
<div class="content">
<pre>After starting
Agree start date
Allocate office
Create email address
Prior to starting
Reject job
Send joining letter to candidate</pre>
</div>
</div>
<div class="paragraph">
<p>Some things might be unexpected here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The stages are <em>also</em> plan items and thus have a representation as <strong>PlanItemInstance</strong>. Note that that child plan item instances will have the stage as parent when calling <em>.getStageInstanceId()</em>.</p>
</li>
<li>
<p>The <em>Send joining letter to candidate</em> is returned in the result. The reason is that, in accordance with the CMMN 1.1 specification, this plan item instance is in the <em>available</em> state, but not yet in the <em>active</em> state.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Indeed, when the code above is changed to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">for (PlanItemInstance planItemInstance : planItemInstances) {
    System.out.println(planItemInstance.getName()
        + ", state=" + planItemInstance.getState()
        + ", parent stage=" + planItemInstance.getStageInstanceId());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output now becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>After starting, state=available, parent stage=null
Agree start date, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Allocate office, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Create email address, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Prior to starting, state=active, parent stage=null
Reject job, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Send joining letter to candidate, state=available, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122</pre>
</div>
</div>
<div class="paragraph">
<p>To only show the active plan item instances, the query can be adapted by adding <em>planItemInstanceStateActive()</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"> List&lt;PlanItemInstance&gt; planItemInstances = cmmnRuntimeService.createPlanItemInstanceQuery()
    .caseInstanceId(caseInstance.getId())
    .planItemInstanceStateActive()
    .orderByName().asc()
    .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output is now</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Agree start date
Allocate office
Create email address
Prior to starting
Reject job</pre>
</div>
</div>
<div class="paragraph">
<p>Of course, the <strong>PlanItemInstance</strong> is the low level representation, but each plan item also has a <em>plan item definition</em> that defines what type it is. In this case, we only have <em>human tasks</em>. It is possible to interact with the <em>CaseInstance</em> via its <em>plan item instances</em>, for example by triggering them programmatically (for example, <em>CmmnRuntimeService.triggerPlanItemInstance(String planItemInstanceId)</em>). However, most likely the interaction will happen through the results of the actual plan item definition: here, the human tasks.</p>
</div>
<div class="paragraph">
<p>Querying for tasks is done in the exact same way as for the BPMN engine (in fact, the task service is a shared component and tasks created in BPMN or CMMN can be queried through both engines):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">CmmnTaskService cmmnTaskService = cmmnEngine.getCmmnTaskService();
List&lt;Task&gt; hrTasks = cmmnTaskService.createTaskQuery()
    .taskCandidateGroup("hr")
    .caseInstanceId(caseInstance.getId())
    .orderByTaskName().asc()
    .list();
for (Task task : hrTasks) {
    System.out.println("Task for HR : " + task.getName());
}

List&lt;Task&gt; employeeTasks = cmmnTaskService.createTaskQuery()
    .taskAssignee("johndoe")
    .orderByTaskName().asc()
    .list();
for (Task task : employeeTasks) {
    System.out.println("Task for employee: " + task);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Task for HR : Agree start date
Task for HR : Allocate office
Task for HR : Create email address

Task for employee: Reject job</pre>
</div>
</div>
<div class="paragraph">
<p>When the three tasks of HR are completed, the <em>Send joining letter to candidate</em> task should be available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">for (Task task : hrTasks) {
    cmmnTaskService.complete(task.getId());
}

hrTasks = cmmnTaskService.createTaskQuery()
    .taskCandidateGroup("hr")
    .caseInstanceId(caseInstance.getId())
    .orderByTaskName().asc()
    .list();

for (Task task : hrTasks) {
    System.out.println("Task for HR : " + task.getName());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And indeed, the expected task is now created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Task for HR : Send joining letter to candidate</pre>
</div>
</div>
<div class="paragraph">
<p>Completing this task will now move the case instance into the second stage, as the sentry for the first stage is satisfied. The <em>Reject job</em> tasks is automatically completed by the system and the two tasks for the employee are created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">Task for employee: Fill in paperwork
Task for employee: New starter training
Task for employee: Reject job</code></pre>
</div>
</div>
<div class="paragraph">
<p>Completing all the tasks will end the case instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>List&lt;Task&gt; tasks = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).listPage(0, 1);
while (!tasks.isEmpty()) {
    cmmnTaskService.complete(tasks.get(0).getId());
    tasks = cmmnTaskService.createTaskQuery()
        .caseInstanceId(caseInstance.getId())
        .listPage(0, 1);
}</pre>
</div>
</div>
<div class="paragraph">
<p>While executing case instances, the engine also stores historic information, which can be queried via a query API:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">CmmnHistoryService cmmnHistoryService = cmmnEngine.getCmmnHistoryService();
HistoricCaseInstance historicCaseInstance = cmmnHistoryService.createHistoricCaseInstanceQuery()
    .caseInstanceId(caseInstance.getId())
    .singleResult();

System.out.println("Case instance execution took "
    + (historicCaseInstance.getEndTime().getTime() - historicCaseInstance.getStartTime().getTime()) + " ms");

List&lt;HistoricTaskInstance&gt; historicTaskInstances = cmmnHistoryService.createHistoricTaskInstanceQuery()
    .caseInstanceId(caseInstance.getId())
    .orderByTaskCreateTime().asc()
    .list();

for (HistoricTaskInstance historicTaskInstance : historicTaskInstances) {
    System.out.println("Task completed: " + historicTaskInstance.getName());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which outputs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Case instance execution took 149 ms
Task completed: Reject job
Task completed: Agree start date
Task completed: Allocate office
Task completed: Create email address
Task completed: Send joining letter to candidate
Task completed: New starter training
Task completed: Fill in paperwork</pre>
</div>
</div>
<div class="paragraph">
<p>Historic data related to the case execution is collected for special constructs, such as Tasks (as seen above), milestones, cases, variables and plan items in general.
This data is persisted at the same time as the runtime data, but it is not deleted when case instances end.
Access to the historic data is provided as query APIs by the <em>CmmnHistoryService</em></p>
</div>
<div class="paragraph">
<p>Of course, this is but a small part of the available APIs and constructs available in the Flowable CMMN Engine. Please check the other sections for more detailed information</p>
</div>
</div>
<div class="sect2">
<h3 id="_cmmn_1_1_constructs">6.4. CMMN 1.1 Constructs</h3>
<div class="paragraph">
<p>This chapter covers the CMMN 1.1 constructs supported by Flowable, as well as extensions to the CMMN 1.1 standard.</p>
</div>
<div class="paragraph">
<p>The following constructs, with the exception of sentries and item control, as for the CMMN specification are considered plan items.
Historic data of their instances execution can be queried through the <em>CmmnHistoryService</em> using <em>org.flowable.cmmn.api.history.HistoricPlanItemInstanceQuery</em>.</p>
</div>
<div class="sect3">
<h4 id="_stage">6.4.1. Stage</h4>
<div class="paragraph">
<p>A stage is used to group plan items together. It is typically used to define "phases" in a case instance.</p>
</div>
<div class="paragraph">
<p>A stage is a plan item itself, and thus can have entry and exit criteria. Plan items contained within a stage are only available when the parent stage moves to the <em>active</em> state. Stages can be nested in other stages.</p>
</div>
<div class="paragraph">
<p>A stage is visualized as a rectangle with angled corners:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.stage.png" alt="cmmn.stage">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_task">6.4.2. Task</h4>
<div class="paragraph">
<p>A "manual" task, meaning the task will happen external to the engine.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: expression that will be resolved at runtime as the name of the manual task</p>
</li>
<li>
<p><strong>blocking</strong>: a boolean value determining whether the task blocks</p>
</li>
<li>
<p><strong>blockingExpression</strong>: an expression that evaluates to a boolean indicating whether the tasks blocks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a task is non-blocking, the engine will simply complete it automatically when executing it. If a task is blocking, a <em>PlanItemInstance</em> for this task will remain in the <em>active</em> state until it is programmatically triggered by the <em>CmmnRuntimeService.triggerPlanItemInstance(String planItemInstanceId)</em> method.</p>
</div>
<div class="paragraph">
<p>A task is visualized as a rounded rectangle:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.task.png" alt="cmmn.task">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_human_task">6.4.3. Human task</h4>
<div class="paragraph">
<p>A human task is used to model work that needs to be done by a human, typically through a form. When the engine arrives at a human task, a new entry is created in the task list of any users or groups assigned to that task.</p>
</div>
<div class="paragraph">
<p>A human task is a plan item, which means that beyond a human task entry also a <em>PlanItemInstance</em> is created and it can be queried via the <em>PlanItemInstanceQuery</em>.</p>
</div>
<div class="paragraph">
<p>Human tasks can be queried through the <em>org.flowable.task.api.TaskQuery</em> API. Historic task data can be queried through the <em>org.flowable.task.api.history.HistoricTaskInstanceQuery</em>.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: expression that will be resolved at runtime as the name of the human task</p>
</li>
<li>
<p><strong>blocking</strong>: a boolean value determining whether the task blocks</p>
</li>
<li>
<p><strong>blockingExpression</strong>: an expression that evaluates to a boolean indicating whether the tasks blocks</p>
</li>
<li>
<p><strong>assignee</strong> : an expression (can be a static text value) that is used to determine to whom the human task is assigned</p>
</li>
<li>
<p><strong>owner</strong> : an expression (can be a static text value) that is used to determine who is the owner of the human task</p>
</li>
<li>
<p><strong>candidateUsers</strong> : an expression (can be a static text value) that resolves to a comma-separated list of Strings that is used to determine which users are candidate for this human task</p>
</li>
<li>
<p><strong>candidateGroups</strong> : an expression (can be a static text value) that resolves to a comma-separated list of Strings that is used to determine to which groups the task is assigned</p>
</li>
<li>
<p><strong>form key</strong>: an expression that determines a key when using forms. Can be retrieved via the API afterwards</p>
</li>
<li>
<p><strong>Due date</strong> an expression that resolves to java.util.Date or a ISO-8601 date string</p>
</li>
<li>
<p><strong>Priority</strong>: an expression that resolves to an integer. Can be used in the TaskQuery API to filter tasks</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A human task is visualized as a rounded rectangle with a user icon in the top left corner:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.humantask.png" alt="cmmn.humantask">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_java_service_task">6.4.4. Java Service task</h4>
<div class="paragraph">
<p>A service task is used to execute custom logic.</p>
</div>
<div class="paragraph">
<p>Custom logic is placed in a class that implements the <em>org.flowable.cmmn.api.delegate.PlanItemJavaDelegate</em> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">public class MyJavaDelegate implements PlanItemJavaDelegate {

    public void execute(DelegatePlanItemInstance planItemInstance) {
        String value = (String) planItemInstance.getVariable("someVariable");
        ...
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For lower-level implementations that cannot be covered by using the <em>PlanItemJavaDelegate</em> approach, the <em>CmmnActivityBehavior</em> can be used (similar to <em>JavaDelegate</em> vs <em>ActivityBehavior</em> in the BPMN engine).</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: name of the service task</p>
</li>
<li>
<p><strong>class</strong>: the Java class implementing the custom logic</p>
</li>
<li>
<p><strong>class fields</strong>: parameters to pass when calling the custom logic</p>
</li>
<li>
<p><strong>Delegate expression</strong>: an expression that resolves to a class implementing the <em>PlanItemJavaDelegate</em> interface</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A service task is visualized as a rounded rectangle with a cog icon in the top left corner:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.servicetask.png" alt="cmmn.servicetask">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_decision_task">6.4.5. Decision task</h4>
<div class="paragraph">
<p>A <em>Decision task</em> calls out to a DMN decision table and stores the resulting variable in the case instance.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Decision table reference</strong>: the referenced DMN decision table that needs to be invoked.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is also possible to throw an error when no rule is hit during the evaluation of the DMN decision table by setting the <em><em>Throw error if no rules were hit</em></em> property.</p>
</div>
<div class="paragraph">
<p>A decision task is visualized as a <em>task</em> with a table icon in the top left corner:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.decisiontask.png" alt="cmmn.decisiontask">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_http_task">6.4.6. Http Task</h4>
<div class="paragraph">
<p>The Http task is an out-of-the-box implementation of a <em>service task</em>. It is used when a REST service needs to be called over HTTP.</p>
</div>
<div class="paragraph">
<p>The Http task has various options to customize the request and response. See the BPMN http task documentation for details on all the configuration options.</p>
</div>
<div class="paragraph">
<p>A http task is visualized as a <em>task</em> with a rocket icon in the top left corner:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.httptask.png" alt="cmmn.httptask">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_script_task">6.4.7. Script Task</h4>
<div class="paragraph">
<p>A task of type "script", similar to its equivalent in BPMN, the Script Task executes a script when the plan item instance becomes active.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: task attribute to indicate the name of the task</p>
</li>
<li>
<p><strong>type</strong>: task attribute whose value must be "script" to indicate the type of task</p>
</li>
<li>
<p><strong>scriptFormat</strong>: extended attribute that indicate the language of the script (for example, javascript, groovy)</p>
</li>
<li>
<p><strong>script</strong>: the script to execute, defined as a string in a field element named "script"</p>
</li>
<li>
<p><strong>autoStoreVariables</strong>: optional task attribute flag (default: false) that indicates whether or not variables defined in the script will be stored in the Plan Item Instance context (see note below)</p>
</li>
<li>
<p><strong>resultVariableName</strong>: optional task attribute that when present will store a variable with the specified name in the Plan Item instance context with the script evaluation result (see note below)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A script task is visualized as a <em>task</em> with a script icon in the top left corner:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.scripttask.png" alt="cmmn.scripttask">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;planItem id="scriptPlanItem" name="Script Plan Item" definitionRef="myScriptTask" /&gt;
&lt;task name="My Script Task Item" flowable:type="script" flowable:scriptFormat="JavaScript"&gt;
    &lt;documentation&gt;Optional documentation&lt;/documentation&gt;
    &lt;extensionElements&gt;
        &lt;flowable:field name="script"&gt;
            &lt;string&gt;
                sum = 0;
                for ( i in inputArray ) {
                    sum += i;
                }
            &lt;/string&gt;
        &lt;/flowable:field&gt;
    &lt;/extensionElements&gt;
&lt;/task&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong>: The value of the <strong>scriptFormat</strong> attribute must be a name that is compatible with the <a href="http://jcp.org/en/jsr/detail?id=223">JSR-223</a> (scripting for the Java platform). By default, JavaScript is included in every JDK and as such doesn&#8217;t need any additional JAR files. If you want to use another (JSR-223 compatible) scripting engine, it is sufficient to add the corresponding JAR to the classpath and use the appropriate name. For example, the Flowable unit tests often use Groovy because the syntax is similar to that of Java.</p>
</div>
<div class="paragraph">
<p>Do note that the Groovy scripting engine is bundled with the groovy-jsr223 JAR. As such, one must add the following dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
    &lt;artifactId&gt;groovy-jsr223&lt;/artifactId&gt;
    &lt;version&gt;2.x.x&lt;version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>All case variables that are accessible through the PlanItem instance that arrives in the script task can be used within the script. In the example below, the script variable <em>'inputArray'</em> is in fact a case variable (an array of integers).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;flowable:field name="script"&gt;
    &lt;string&gt;
    sum = 0
    for ( i in inputArray ) {
      sum += i
    }
    &lt;/string&gt;
&lt;/flowable:field&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong>: It&#8217;s also possible to set plan item instance variables in a script, simply by calling <em>planItemInstance.setVariable("variableName", variableValue)</em>. By default, no variables are stored automatically. It&#8217;s possible to automatically store any variable defined in the script (for example, <em>sum</em> in the example above) by setting the property <code>autoStoreVariables</code> on the <code>scriptTask</code> to <code>true</code>. However, <strong>the best practice is not to do this and use an explicit planItemInstance.setVariable() call</strong>, as with some recent versions of the JDK, auto storing of variables does not work for some scripting languages. See <a href="http://www.jorambarrez.be/blog/2013/03/25/bug-on-jdk-1-7-0_17-when-using-scripttask-in-activiti/">this link</a> for more details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;task name="Script Task" flowable:type="script" flowable:scriptFormat="groovy" flowable:autoStoreVariables="false"&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default for this parameter is <code>false</code>, meaning that if the parameter is omitted from the script task definition, all the declared variables will only exist during the duration of the script.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example of how to set a variable in a script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;flowable:field name="script"&gt;
    &lt;string&gt;
    def scriptVar = "test123"
    planItemInstance.setVariable("myVar", scriptVar)
    &lt;/string&gt;
&lt;/flowable:field&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following names are reserved and <strong>cannot be used</strong> as variable names: <strong>out, out:print, lang:import, context, elcontext</strong>.</p>
</div>
<div class="paragraph">
<p><strong>Note</strong> The return value of a script task can be assigned to an already existing or new plan item instance variable by specifying its name as a literal value for the <em>'flowable:resultVariable'</em> attribute of a script task definition. Any existing value for a specific plan item instance variable will be overwritten by the result value of the script execution. When a result variable name is not specified, the script result value gets ignored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml">&lt;task name="Script Task" flowable:type="script" flowable:scriptFormat="groovy" flowable:resultVariable="myVar"&gt;
    &lt;flowable:field name="script"&gt;
        &lt;string&gt;#{echo}&lt;/string&gt;
    &lt;/flowable:field&gt;
&lt;/task&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the result of the script execution (the value of the resolved expression <em>'#{echo}'</em>) is set to the process variable named <em>'myVar'</em> after the script completes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_milestone">6.4.8. Milestone</h4>
<div class="paragraph">
<p>A milestone is used to mark arriving at a certain point in the case instance. At runtime, they are represented as <strong>MilestoneInstances</strong> and they can be queried through the <strong>MilestoneInstanceQuery</strong> via the <em>CmmnRuntimeService</em>. There is also a historical counterpart via the <em>CmmnHistoryService</em>.</p>
</div>
<div class="paragraph">
<p>A milestone is a plan item, which means that as well as a milestone entry, a <em>PlanItemInstance</em> is created also, which can be queried via the <em>PlanItemInstanceQuery</em>.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: an expression or static text that determines the name of the milestone</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A milestone is visualized as a rounded rectangle (more rounded than a task):</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.milestone.png" alt="cmmn.milestone">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_case_task">6.4.9. Case task</h4>
<div class="paragraph">
<p>A case task is used to start a child case within the context of another case. The <em>CaseInstanceQuery</em> has <em>parent</em> options to find these cases.</p>
</div>
<div class="paragraph">
<p>When the case task is blocking, the <em>PlanItemInstance</em> will be <em>active</em> until the child case has completely finished. If the case task is non-blocking, the child case is started and the plan item instance automatically completes. When the child case instance ends there is no impact on the parent case.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: an expression or static text that determines the name</p>
</li>
<li>
<p><strong>blocking</strong>: a boolean value determining whether the task blocks</p>
</li>
<li>
<p><strong>blockingExpression</strong>: an expression that evaluates to a boolean indicating whether the tasks blocks</p>
</li>
<li>
<p><strong>Case reference</strong>: the key of the case definition that is used to start the child case instance. Can be an expression</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A case task is visualized as a rounded rectangle with a case icon in the top left corner:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.casetask.png" alt="cmmn.casetask">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_process_task">6.4.10. Process task</h4>
<div class="paragraph">
<p>A process task is used to start a process instance within the context of a case.</p>
</div>
<div class="paragraph">
<p>When the process task is blocking, the <em>PlanItemInstance</em> will be <em>active</em> until the process instance has completely finished. If the process task is non-blocking, the process instance is started and the plan item instance automatically completes. When the process instance ends there is no impact on the parent case.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>name</strong>: an expression or static text that determines the name</p>
</li>
<li>
<p><strong>blocking</strong>: a boolean value determining whether the task blocks</p>
</li>
<li>
<p><strong>blockingExpression</strong>: an expression that evaluates to a boolean indicating whether the tasks blocks</p>
</li>
<li>
<p><strong>Process reference</strong>: the key of the process definition that is used to start the process instance. Can be an expression</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A process task is visualized as a rounded rectangle with an arrow icon in the top left corner:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.processtask.png" alt="cmmn.processtask">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_criteria">6.4.11. Criteria</h4>
<div class="sect4">
<h5 id="_entry_criterion_entry_sentry">Entry criterion (entry sentry)</h5>
<div class="paragraph">
<p>Entry criteria form a sentry for a given plan item instance. They consist of two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more parts that depend on other plan items: these define dependencies on state transitions of other plan items. For example, one human task can depend on the state transition <em>complete</em> of three other human tasks to become active itself</p>
</li>
<li>
<p>One optional <em>if part</em> or <em>condition</em>: this is an expression that allows the definition of a complex condition</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A sentry is satisfied when all its criteria are resolved to <em>true</em>. When a criterion evaluates to true, this is stored and remembered for future evaluations. Note that entry criteria of all plan item instances in the <em>available</em> state are evaluated whenever something changes in the case instance.
Multiple sentries are possible on a plan item. However, when one is satisfied, the plan item moves from state <em>available</em> to <em>active</em>.</p>
</div>
<div class="paragraph">
<p>See <a href="#cmmn_sentry_evaluation">the section on sentry evaluation</a> for more information.</p>
</div>
<div class="paragraph">
<p>An entry criterion is visualized as a diamond shape (white color inside) on the border of a plan item:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.entrycriteria.png" alt="cmmn.entrycriteria">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_exit_criterion_exit_sentry">Exit criterion (exit sentry)</h5>
<div class="paragraph">
<p>Exit criteria form a sentry for a given plan item instance. They consist of two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more parts that depend on other plan items: these define dependencies on state transitions of other plan items. For example, one human task can depend on reaching a certain milestone to be automatically terminated</p>
</li>
<li>
<p>One optional <em>if part</em> or <em>condition</em>: this is an expression that allows a complex condition to be defined</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A sentry is satisfied when all its criteria are resolved to <em>true</em>. When a criterion evaluates to true, this is stored and remembered for future evaluations. Note that exit criteria of all plan item instances in the <em>active</em> state are evaluated whenever something changes in the case instance.
Multiple sentries are possible on a plan item. However, when one is satisfied, the plan item moves from state <em>active</em> to <em>exit</em>.</p>
</div>
<div class="paragraph">
<p>See <a href="#cmmn_sentry_evaluation">the section on sentry evaluation</a> for more information.</p>
</div>
<div class="paragraph">
<p>An exit criterion is visualized as a diamond shape (white color inside) on the border of a plan item:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.exitcriteria.png" alt="cmmn.exitcriteria">
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_event_listeners">6.4.12. Event Listeners</h4>
<div class="sect4">
<h5 id="_timer_event_listener">Timer Event Listener</h5>
<div class="paragraph">
<p>A timer event listener is used when the passing of time needs to be captured in a case model.</p>
</div>
<div class="paragraph">
<p>A timer event listener is not a task and has a simpler plan item lifecycle compared to a <em>task</em>: the timer will simply move from <em>available</em> to <em>completed</em> when the event (in this case, the time passing) occurs.</p>
</div>
<div class="paragraph">
<p>Properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Timer expression</strong>: an expression that defines when the timer should occur. The following options are possible:</p>
<div class="ulist">
<ul>
<li>
<p>An expression resolving to a java.util.Date or org.joda.time.DateTime instance (for example, _${someBean.calculateNextDate(someCaseInstanceVariable)})</p>
</li>
<li>
<p>An ISO8601 date</p>
</li>
<li>
<p>An ISO8601 duration String (for example, <em>PT5H</em>, indicating the timer should fire in 5 hours from instantiation)</p>
</li>
<li>
<p>AN ISO8601 repetition String (for example, R5/PT2H, indicating the timer should fire 5 times, each time waiting 2 hours)</p>
</li>
<li>
<p>A String containing a cron expression</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Start trigger plan item/event</strong>: reference to a plan item in the case model that triggers the start of the timer event listener</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that setting a <em>start trigger</em> for the timer event listener does not have a visual indicator in the case model, unlike entry/exit criteria on sentries.</p>
</div>
<div class="paragraph">
<p>A timer event listener is visualized as circle with a clock icon inside:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.timereventlistener.png" alt="cmmn.timereventlistener">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_user_event_listener">User Event Listener</h5>
<div class="paragraph">
<p>A user event listener can be used when needing to capture a user interaction that directly influences a case state,
instead of indirectly via impacting variables or information in the case.
A typical use case for a user event listener are buttons in a UI that a user can click to drive the state of the case instance.
When the event is triggered an <em>Occur</em> event is thrown to which sentries can listener to.
Like timer event listeners, it has a much simpler lifecycle that a <em>task</em>.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.usereventlistener.png" alt="cmmn.usereventlistener">
</div>
</div>
<div class="paragraph">
<p>User event listeners can be queried using the <em>org.flowable.cmmn.api.runtime.UserEventListenerInstanceQuery</em>. Such a query can be created by calling the <em>cmmnRuntimeService.createUserEventListenerInstanceQuery()</em> method. Note that a user event listener is also a plan item instance, which means it can also be queried through the <em>org.flowable.cmmn.api.runtime.PlanItemInstanceQuery</em> API.</p>
</div>
<div class="paragraph">
<p>A user event listener can be completed by calling the <em>cmmnRuntimeService.completeUserEventListenerInstance(id)</em> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="_automatic_removal_of_event_listeners">Automatic removal of event listeners</h5>
<div class="paragraph">
<p>The engine will automatically detect when event listeners (user or timer) are not useful anymore.
Take for example the following case definition:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.user-event-listener-removal-1.png" alt="cmmn.user event listener removal 1">
</div>
</div>
<div class="paragraph">
<p>Here, the <em>First stage</em> contains two human tasks (A and B) and it can be exited by a user when the <em>Stop first stage</em> user event is triggered.
However, when both taks A and B are completed, the stage will also complete. If now the user event listener would be triggered, there is nothing that listens to this event anymore.
The engine will detect this and terminate the user event automatically.</p>
</div>
<div class="paragraph">
<p>The same mechanism also works for event listeners that are referenced by entry sentries:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.user-event-listener-removal-2.png" alt="cmmn.user event listener removal 2">
</div>
</div>
<div class="paragraph">
<p>In this case, in the case that <em>EventListenerA</em> would be triggered, <em>EventListenerB</em> is terminated (as nothing is listening to its occurrence anymore).</p>
</div>
<div class="paragraph">
<p>Or, when timer and user event listeners are mixed, the one that is triggered first will also cause the removal of others (when they are not referenced somewhere else):</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.user-event-listener-removal-3.png" alt="cmmn.user event listener removal 3">
</div>
</div>
<div class="paragraph">
<p>Here, the timer will be removed in case the user event is triggered first (and vice versa).</p>
</div>
<div class="paragraph">
<p>The detection also takes in account plan items that have not yet been created. Take for example the following case definition:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.user-event-listener-removal-4.png" alt="cmmn.user event listener removal 4">
</div>
</div>
<div class="paragraph">
<p>Here, human task <em>C</em> is not yet created when a case instance is started for this case definition. The user event listener will not be removed as long that <em>C</em> has a parent stage that is in a non-terminal state, as this means that the event could still be listened to in the future.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_item_control_repetition_rule">6.4.13. Item control: Repetition Rule</h4>
<div class="paragraph">
<p>Plan items on the case model can have a <em>repetition rule</em>: an expression that can be used to indicate a certain plan item needs to be repeated.
When no expression is set, but the repetition is enabled (for example, the checkbox is checked in the Flowable Modeler) or the expression is empty, a <em>true</em> value is assumed by default.</p>
</div>
<div class="paragraph">
<p>An optional <em>repetition counter variable</em> can be set, which holds the index (one-based) of the instance. If not set, the default variable name is <em>repeitionCounter</em>.</p>
</div>
<div class="paragraph">
<p>If the plan item does not have any entry criteria, the repetition rule expression is evaluated when the plan item is completed or terminated. If the expression resolved to <em>true</em>, a new instance is created. For example, a human task with a repetition rule expression <em>${repetitionCounter &lt; 3}</em>, will create three sequential human tasks.</p>
</div>
<div class="paragraph">
<p>If the plan item has entry criteria, the behavior is different. The repetition rule is not evaluated on completion or termination, but when a sentry of the plan item is satisfied. If both the sentry is satisfied and the repetition rule evaluates to true, a new instance is created.</p>
</div>
<div class="paragraph">
<p>Take, for example, the following timer event listener followed by a human task. The sentry has one entry criterion for the <em>occur</em> event of the timer event listener. Note that enabling and setting the repetition rule on the task has a visual indicator at the bottom of the rectangle.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.repeatingtimereventlistener.png" alt="cmmn.repeatingtimereventlistener">
</div>
</div>
<div class="paragraph">
<p>If the timer event listener is repeating (for example, <em>R/PT1H</em>), the <em>occur</em> event will be fired every hour. When the repetition rule expression of the human task evaluates to true, a new human task instance will be created each hour.</p>
</div>
<div class="paragraph">
<p>Note that Flowable allows to have repeating user and generic event listeners. This is contrary to the CMMN specification (which disallows it), but we believe it is needed for having a more flexible way of using event listeners (for example to model a case where a user might multiple times trigger an action that leads to the creation of tasks).</p>
</div>
</div>
<div class="sect3">
<h4 id="_item_control_manual_activation_rule">6.4.14. Item control: Manual Activation Rule</h4>
<div class="paragraph">
<p>Plan items on the case model can have a <em>manual activation rule</em>: an expression that can be used to indicate a certain plan item needs to be <em>manually activated by an end-user</em>.
When no expression is set, but the manual activation is enabled (for example, the checkbox is checked in the Flowable Modeler) or the expression is empty, a <em>true</em> value is assumed by default.</p>
</div>
<div class="paragraph">
<p>Stages and all task types can be marked for manual activation. Visually, the task or stage will get a <em>play</em> icon (small triangle pointing to the right) to indicate an end-user will have to manually activate it:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.manual-activation.png" alt="cmmn.manual activation">
</div>
</div>
<div class="paragraph">
<p>Normally, when a sentry for a plan item is satisfied (or the plan item doesn&#8217;t have any sentries) the plan item instance is automatically moved to the <em>ACTIVE</em> state. When a manual activation is set though, and it evaluates to true, the plan item instance now becomes <em>ENABLED</em> instead of <em>ACTIVE</em>. As the name implies, the idea behind this is that end-users manually have to activate the plan item instance. A typical use case is showing a list of buttons of potential plan item instances that can currently be started by the end user.</p>
</div>
<div class="paragraph">
<p>To start an enabled plan item instance, the <em>startPlanItemInstance</em> method of the <em>CmmnRuntimeService</em> can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">List&lt;PlanItemInstance&gt; enabledPlanItemInstances = cmmnRuntimeService.createPlanItemInstanceQuery()
    .caseInstanceId(caseInstance.getId())
    .planItemInstanceStateEnabled()
    .list();

// ...

cmmnRuntimeService.startPlanItemInstance(planItemInstance.getId());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the behavior of a task is only executed when the plan item instance moves into the <em>ACTIVE</em> state. For example, for a human task, the user task will only be created after calling the <em>startPlanItemInstance</em> method.</p>
</div>
<div class="paragraph">
<p>Plan item instances that are enabled can be moved into the <em>DISABLED</em> state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">cmmnRuntimeService.disablePlanItemInstance(planItemInstance.getId());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Disabled plan item instances can be enabled again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java">cmmnRuntimeService.enablePlanItemInstance(planItemInstance.getId());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that with regards to determining stage or case instance termination, the <em>DISABLED</em> state is seen as a <em>terminal</em> state. This means that the case instance will terminate when only disabled plan item instances would remain.</p>
</div>
</div>
<div class="sect3">
<h4 id="_item_control_required_rule">6.4.15. Item control: Required Rule</h4>
<div class="paragraph">
<p>Plan items on the case model can have a <em>required rule</em>: an expression that can be used to indicate a certain plan item is <em>required by the enclosing stage (or plan model)</em>. This can be used to indicate which plan items of the case model are required to be executed and which are optional.</p>
</div>
<div class="paragraph">
<p>When no expression is set, but the required rule is enabled (for example, the checkbox is checked in the Flowable Modeler) or the expression is empty, a <em>true</em> value is assumed by default.</p>
</div>
<div class="paragraph">
<p>The <em>required rule</em> works in conjunction with the <em>autoComplete</em> attribute on the parent stage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <em>autoComplete</em> resolves to <em>false</em> for the stage, which is also the default when nothing is set, <strong>all</strong> child plan item instances must be in an end state (completed, terminated, and so on) for the stage plan item instance to be completed by the engine</p>
</li>
<li>
<p>If <em>autoComplete</em> resolves to <em>true</em> for the stage, all child plan item instances for <strong>which the required rule evaluates to true</strong> need to be in an end state. If there are also no other active child plan item instances, the stage completes automatically</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <em>stage plan item instance</em> has a <strong>completeable</strong> property that can be used to see whether or not the conditions for completion are satisfied.
Take, for example, the following simple stage and assume that the sentry for the <em>required task</em> evaluates to true and the other one to false. This means that the left plan item instance will be active while the right one will be in the <em>available</em> state.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.completeable-stage.png" alt="cmmn.completeable stage">
</div>
</div>
<div class="paragraph">
<p>Calling <em>cmmnRuntimeService.completeStagePlanItemInstance(String stagePlanItemInstanceId)</em> will not be possible for the stage (an exception will be thrown) as it has one active child plan item instance. When this user task on the left is completed, the <em>completeStagePlanItemInstance</em> can now be called, as no child plan item instances are currently active. However, by itself, the stage will not automatically complete as the right user task is in the available state.</p>
</div>
<div class="paragraph">
<p>If the previous stage is changed to be <strong>autoCompleteable</strong> (this is visualised by a black rectangle at the bottom of the stage) and the plan item on the left is changed to be required (this is visualised using an exclamation mark), the behavior will be different:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.completeable-stage02.png" alt="cmmn.completeable stage02">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If the left plan item instance is active (sentry is true) and the right is not (sentry is false). In this case, when the left user task is completed, the stage instance will auto complete as it has no active child plan item instances and all required plan item instances are in an end state</p>
</li>
<li>
<p>If both the left and right user tasks are active (sentries are true)</p>
<div class="ulist">
<ul>
<li>
<p>When the left user task is completed, the stage will not autocomplete as there is still a child plan item instance active</p>
</li>
<li>
<p>When the right user task is completed, the stage will not autocomplete as the required left child plan item instance is not in an end state</p>
</li>
</ul>
</div>
</li>
<li>
<p>If the left plan item instance is not active and the right is active. In this case, when the right user task is completed the stage will not autocomplete, as the required left user task is not in an end state. It will need to become active and be completed to complete the stage.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the manual activation rule works independently of the required rule. For example, given the following stage:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.completeable-stage03.png" alt="cmmn.completeable stage03">
</div>
</div>
<div class="paragraph">
<p>Here, user task D is required and user task B is manually activated.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If D is completed, the stage will automatically complete, as B is not required and it is not active</p>
</li>
<li>
<p>If B would be required too, it would need to be manually started (using <em>cmmnRuntimeService.startPlanItemInstance(String planItemInstanceId)</em>) before the stage would automatically complete, even if D would be completed before the manual start of B</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_item_control_completion_neutral_rule">6.4.16. Item control: Completion Neutral Rule</h4>
<div class="paragraph">
<p>Plan items on the case model can have a <em>completion neutral rule</em>: an expression that can be used to indicate a certain plan item is <em>neutral with regards to the completion of its parent stage (or plan model)</em>. This can be used to indicate which plan items of the case model are required to be executed and which are optional, as a more flexible alternative in some use cases to using the <em>required rule</em> and <em>autoComplete</em> .</p>
</div>
<div class="paragraph">
<p>Note that the <em>Completion Neutral Rule</em> is not a CMMN 1.1 Standard, but a Flowable-specific addition.</p>
</div>
<div class="paragraph">
<p>Following the specification, a stage with a plan item in state <strong>AVAILABLE</strong> does not complete unless its <em>autoComplete</em> attribute is set <em>true</em> and the plan item is not required. For example, a plan item that has an unsatisfied sentry remains in <strong>AVAILABLE</strong> until the sentry is satisfied. This means that the parent stage would not complete, unless the plan item is marked as <em>not required</em> and the stage is set to <em>autoComplete</em>. The downside is that once a stage is marked as to autoComplete, all child plan items need to have a configuration for the <em>required</em> rule, which is in some use cases tedious and lots of work.</p>
</div>
<div class="paragraph">
<p>The <em>Completion Neutral Rule</em>, contrary to the autoComplete-required mechanism, works from "bottom-up": a plan item can be marked individually to be <em>neutral wrt the completion of its parent</em> without having to mark any other plan item.</p>
</div>
<div class="paragraph">
<p>The <em>Required Rule</em> takes precedence when plan items with both rules both evaluate to <em>true</em>.</p>
</div>
<div class="paragraph">
<p>To summarize:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a plan item configured to be <em>"completion neutral"</em> will allow a stage to complete automatically if it&#8217;s in <strong>AVAILABLE</strong> state (e.g. waiting for an entry criterion sentry),meaning that such a plan item is neutral with respect to its parent stage completion evaluation.</p>
</li>
<li>
<p>a stage will remain <strong>ACTIVE</strong> on any of these conditions:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It has at least one plan item in <strong>ACTIVE</strong> state</p>
</li>
<li>
<p>It has at least one plan item with <em>requiredRule</em> in <strong>AVAILABLE</strong> or <strong>ENABLE</strong> state</p>
</li>
<li>
<p>It is not marked as <em>autoComplete</em> and has at least one plan item in <strong>ENABLED</strong> state (irrespective of its <em>requiredRule</em>)</p>
</li>
<li>
<p>It is not marked as  <em>autoComplete</em> and has at least one plan item in <strong>AVAILABLE</strong> state that is <strong>not</strong> <em>completionNeutral</em></p>
</li>
</ol>
</div>
</li>
<li>
<p>a stage will <strong>COMPLETE</strong> if:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It contains no plan items or all child plan items are in a <em>Terminal</em> or <em>Semi-terminal</em> state (CLOSED, COMPLETED, DISABLED, FAILED)</p>
</li>
<li>
<p>It is not marked as <em>autoComplete</em> and all remaining child plan items are in <strong>AVAILABLE</strong> state and are <em>completionNeutral</em> and not <em>required</em></p>
</li>
<li>
<p>It is <em>autoComplete</em> and all remaining plan items are <em>not required</em> in <strong>ENABLED</strong> or <strong>AVAILABLE</strong> state (regardless of its completion neutrality, as required rule gets precedence)</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cmmn_sentry_evaluation">6.5. Sentry evaluation</h3>
<div class="paragraph">
<p>Sentries play a big role in any case definition as they offer a powerful way of configuring in a declarative way when certain plan item instances activate or when they are automatically stopped.
As such, one of the most important parts of the Flowable CMMN engine core logic is to evaluate the sentries to see what state changes happen in a case instance.</p>
</div>
<div class="sect3">
<h4 id="_when_are_sentries_evaluated">6.5.1. When are sentries evaluated?</h4>
<div class="paragraph">
<p>Sentries are evaluated whenever state changes happen in the case instance or new events happen. Concretely this means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a case instance is started.</p>
</li>
<li>
<p>When a wait state plan item such as a human task is triggered to continue.</p>
</li>
<li>
<p>When variables related to the case instance change (added, updated or deleted).</p>
</li>
<li>
<p>When the state of a plan item instance is changed (e.g. terminated through RuntimeService, a manual plan item instance is started, etc.).</p>
</li>
<li>
<p>When manually triggered through the RuntimeService#evaluateCriteria method.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The engine will continue to plan new evaluations of all currently active sentries as long as changes keep happening.
For example, suppose the completion of a human task satisfies the exit sentry of another human task. The state change of the second human task will again schedule a new evaluation of all active sentries with this new information. When no changes have happened during the last evaluation, the engine deems the state stable and evaluation is stopped.</p>
</div>
</div>
<div class="sect3">
<h4 id="_concepts">6.5.2. Concepts</h4>
<div class="paragraph">
<p>Sentries consist of two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more <em>onParts</em> that reference lifecycle events from other plan items</p>
</li>
<li>
<p>Zero or one ifPart with a condition</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Take for example the following case definition:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.sentry-eval-01.png" alt="cmmn.sentry eval 01">
</div>
</div>
<div class="paragraph">
<p>Assume (not shown in the diagram here)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The entry sentry on task C listens to the <em>complete</em> event from task A and B.</p>
</li>
<li>
<p>The exit sentry listens to the <em>occur</em> event of the user event listener <em>'Stop  C'</em></p>
</li>
<li>
<p>The entry sentry has a condition expression set to <em>${var:eq(myVar, <em>hello world</em>)}</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this simple example, the <em>entry sentry</em> has two onParts and one ifPart. The <em>exit sentry</em> only has onPart.</p>
</div>
<div class="paragraph">
<p>When the case instance is started, human tasks A and B are created (as they have no entry sentry) and move immediately to state <em>active</em>. C is not <em>active</em>, but <em>available</em> as the sentry has not yet been satisfied. The user event listener <em>'Stop C'</em> is also <em>available</em> from the start and it can thus be triggered.</p>
</div>
<div class="paragraph">
<p>When both task A and B have been completed and the variable <em>myVar</em> is set to <em>'hello world'</em>, the entry sentry is satisfied and fires. The plan item instance behind C is moved to the <em>active</em> state and as a side-effect the human task C is created (it can now be queried through the <em>TaskService</em> for example).
When <em>'Stop C'</em> is triggered (through the <em>CmmnRuntimeService#completeUserEventListenerInstance</em> method, the exit sentry for C is satisfied and C is terminated.</p>
</div>
<div class="paragraph">
<p>If <em>'Stop C'</em> would be triggered before C moves to <em>active</em>, its plan item instance would be terminated and the entry sentry won&#8217;t be listening anymore to anything.</p>
</div>
</div>
<div class="sect3">
<h4 id="_default_behavior">6.5.3. Default behavior</h4>
<div class="paragraph">
<p>When the case instance is started</p>
</div>
<div class="listingblock">
<div class="content">
<pre>CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()
    .caseDefinitionKey("myCase")
    .start();</pre>
</div>
</div>
<div class="paragraph">
<p>the condition on the entry sentry is immediately evaluated, as a regular evaluation cycle happens on case instance start.</p>
</div>
<div class="paragraph">
<p>Note that, if an expression for the condition like <em>${myVar == <em>hello world</em>}</em> would be used this would not work. The engine would throw a <em>PropertyNotFound</em> exception as it doesn&#8217;t know the <em>myVar</em> variable.</p>
</div>
<div class="paragraph">
<p>To solve this:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>pass a variable value for <em>myVar</em> on case instance start</p>
</li>
<li>
<p>do a null check in the expression, like <em>${planItemInstance.getVariable(<em>myVar</em>) != null &amp;&amp; planItemInstance.getVariable(<em>myVar</em>) == <em>hello world</em>}</em></p>
</li>
<li>
<p>or (and probably easiest), check <a href="#cmmnExpressionsFunctions">expression functions</a> to use a function such as <em>${var:eq(myVar, <em>hello world</em>)}</em> which takes in account the fact the variable might not exist.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>The default evaluation logic has "memory", which means that when a part of a sentry is satisfied the engine will store and "remember" this in subsequent evaluations.</strong></p>
</div>
<div class="paragraph">
<p>This means that, from the moment a part (an onPart or ifPart of the sentry) is satisfied, that particular part is not evaluated anymore in next evaluations and it is deemed true.</p>
</div>
<div class="paragraph">
<p>In the example above, this is needed as task A will typically be completed at another point in time than task B. For example if task A is completed, the part of the sentry on task C that says "i&#8217;m listening to the complete event of task A" is now satisfied and this fact is remembered for the future. If now B completes, this is also stored. If now the <em>myVar</em> variable gets the right value, the ifPart also fires and the whole sentry fires and task C gets activated. Of course, it could also be that the variable value is satisfied first and the tasks after. The point is that it doesn&#8217;t matter as the engine will remember the parts that were satisfied in the past.</p>
</div>
<div class="paragraph">
<p>This behavior "with memory" is the default behavior of the engine and is covered by setting the <em>triggerMode</em> of a sentry to <strong>default</strong>. This is automatically set in the Flowable Modeler when adding a new plan item. When no value has been set (for example when importing a case model from another tool), the <em>triggerMode</em> is assumed to be <em>default</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_trigger_mode_onevent">6.5.4. Trigger mode "onEvent"</h4>
<div class="paragraph">
<p>The default behavior (see previous section) will remember which parts have been satisfied previously. This is the most used and safest approach (and also what is typically expected when reasoning about sentries).</p>
</div>
<div class="paragraph">
<p>There is an alternative mode of sentry triggering that is called <strong>"onEvent"</strong>. In this mode, the engine will have memory with regards to parts of the sentry and will <strong>not remember</strong> any part that was satisfied in the past. This is sometimes needed in advanced use cases. Take for example the following example:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.sentry-eval-02.png" alt="cmmn.sentry eval 02">
</div>
</div>
<div class="paragraph">
<p>Here, the case model has a stage with with three substages. All substage are repeating. Substage B and C have an entry sentry for the completion of stage B. Also (not visually shown), both sentries have a condition that depends on a variable.</p>
</div>
<div class="paragraph">
<p>In advanced use cases, it could be wanted or needed that that the sentry parts (and especially the ifPart containing the condition) are evaluated only <em>when the lifecycle event of the dependent plan item</em> happens. In this case, this is the <em>complete</em> event of <em>Stage A</em>. For these use cases, the <em>triggerMode</em> of the sentry can be set to <em>onEvent</em>. As the name imples, this means that the sentry evaluation only happens when a referenced event happens and no memory of past things are taken into account.</p>
</div>
<div class="paragraph">
<p>Concretely, in the example here, the condition of the entry sentries will be evaluated <strong>only</strong> when Stage A completed (and on no other moment). This is very different from the general evaluation rules. In this particular example, it does make managing the variables easier as the conditions are only evaluated on one precise moment and there needs to be no fear of some sentry part being fired due to a variable having a value at a certain point in time. Especially as in the example here all substages are repeating, this would be a lot of work to do. This is a powerful mechanism, but meant for advanced modelers that have an intrinsic knowledge of the case model and the semantics of this triggerMode.</p>
</div>
<div class="paragraph">
<p>Do note that the engine deems all events to happen simultaneously when it comes to evaluating sentries. Take the following case definition:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.sentry-eval-03.png" alt="cmmn.sentry eval 03">
</div>
</div>
<div class="paragraph">
<p>Assume that all sentries use the <em>triggerMode onEvent</em> setting. If task A is completed, this exits task B. Task C will now exit too. So, even though there are two distinct lifecycle events (A being completed and B being exited) and one might assume that <em>onEvent</em> literally means that there are two distinct evaluations happening where the memory of the other part of the exit sentry on task C is forgotten, the engine is smart enough to see that they are part of the same evaluation cycle and task C will be exited too.</p>
</div>
<div class="paragraph">
<p>Technically spoken: there is <em>some</em> memory for the <em>onEvent</em> sentry, more specifically for evaluations that happen during the same API call (or transaction, lower-level spoken).</p>
</div>
<div class="paragraph">
<p><strong>Important: onEvent is a powerful mechanism and should only be used when the semantics are well understood. It&#8217;s possible to create a case model that gets stuck due to not having the correct sentry configuration if the use case is not carefully examined.</strong></p>
</div>
<div class="paragraph">
<p>(For example, suppose a sentry has an onPart listening to the completion of a plan item and an ifPart with a condition. If the plan item completes - thus triggering the onPart - but a variable used in the condition is missing for some reason &#8230;&#8203; the ifPart would never fire and the case instance might get stuck in an unwanted state).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_architecture">7. Architecture</h2>
<div class="sectionbody">
<div id="architecture" class="paragraph">
<p>This chapter gives a short introduction to the internals of the CMMN engine from a high-level point of view. Of course, as the CMMN engine code is open source, the actual implementation details can be found by diving into the source code.</p>
</div>
<div class="paragraph">
<p>The CMMN engine, as shown in the diagram below, is one of the engines that is part of the Flowable engines eco-system and is designed in a similar way as the other engines. The CMMN engine builds upon CMMN specific services and the shared services: the task, variable, identity and job services, which are independent from the engines. On a lower level the entity- and datamanager layer takes care of the low-level persistence, equivalent to the other engines.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.architecture.png" alt="cmmn.architecture">
</div>
</div>
<div class="paragraph">
<p>By using the shared services, this also means that for example tasks from both the BPMN and the CMMN engine will end up together and can be queried and managed through the same API. Similarly for the async executor: timers and async jobs use the same logic and even can be managed by a central executor.</p>
</div>
<div class="paragraph">
<p>The shared services architecture has a second benefit. When the engines are used together, as is often the case, the engines will share resources where possible, database transactions will span calls over multiple engines operations, lookup caches are common and persistency is handled independently from the engines itself.</p>
</div>
<div class="paragraph">
<p>The CMMN engine is designed with the same principles as the other engines of the Flowable project. The diagram below gives a high-level overview of the different components involved when working with the CMMN Engine:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/cmmn.api-call-flow.png" alt="cmmn.api call flow">
</div>
</div>
<div class="paragraph">
<p>From a high level point of view:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <strong>CmmnEngine</strong> instance is created from a <strong>CmmnEngineConfiguration</strong>. The configuration instance can be created from a configuration file or programmatically.</p>
</li>
<li>
<p>The <em>CmmnEngine</em> gives access the Flowable CMMN API&#8217;s in the form of services: <strong>CmmnRepositoryService</strong>, <strong>CmmnRuntimeService</strong>, <strong>CmmnTaskService</strong>, <strong>CmmnHistoryService</strong>, <strong>CmmnManagementService</strong>. The naming of the services and their responsibilities is similar to the other engines.</p>
</li>
<li>
<p>Every API method is transformed into a <strong>Command</strong> instance. This <em>Command</em> instance is passed into the <strong>CommandExecutor</strong> which, amongst others, makes it pass a stack of <strong>CommandInterceptors</strong>. These interceptors have various responsibilities, including handling transactions.</p>
</li>
<li>
<p>Eventually, the <em>Command</em> typically (unless it&#8217;s a pure data modification <em>Command</em>) plans a <strong>CmmnOperation</strong> on the <strong>CmmnEngineAgenda</strong>.</p>
</li>
<li>
<p>Operations will be taken from the <em>CmmnEngineAgenda</em> until no more operations are left. Typically, an operation will plan new operations as part of its logic.</p>
</li>
<li>
<p>The logic in the operations will call out to lower-level services and/or entity managers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A big difference between the BPMN and the CMMN engine is that the BPMN engine is generally <em>local</em>: the engine looks at the current state, checks what is ahead in the process and continues (of course this is a simplification, there are plenty of operations where this doesn&#8217;t apply, but for making a distinction conceptually, it is correct). The CMMN engine works differently: in CMMN, data plays an important role and the change of data can trigger many things in various places in the case definition. For this reason, the <strong>EvaluateCriteriaOperation</strong> is planned and executed often whenever changes happen. The engine does optimize these evaluations when it detects duplicates or useless evaluations.</p>
</div>
<div class="paragraph">
<p>Core to the working of the CMMN engine is the concept of a <strong>Plan item instance</strong>, a representation of which <em>plan items</em> currently are <em>live</em> in the case and which state they have. Quite different from BPMN, CMMN defines a strict state lifecyle for the plan items. This is represented in the <em>CmmnRuntimeService</em> methods, the query API&#8217;s and the data fields part of the <strong>PlanItemInstance</strong> object.</p>
</div>
<div class="paragraph">
<p>The working of the agenda, the operations and how plan item instances are handled can be inspected by setting logging to debug for the agenda package. For example, when using log4j:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>log4j.logger.org.flowable.cmmn.engine.impl.agenda=DEBUG</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which leads to logging like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code>Planned [Init Plan Model] initializing plan model for case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122
Planned [Change PlanItem state] Task A (id: planItemTaskA), new state: [available] with transition [create]
Planned [Change PlanItem state] PlanItem Milestone One (id: planItemMileStoneOne), new state: [available] with transition [create]
Planned [Change PlanItem state] Task B (id: planItemTaskB), new state: [available] with transition [create]
Planned [Change PlanItem state] PlanItem Milestone Two (id: planItemMileStoneTwo), new state: [available] with transition [create]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'create' having fired for plan item planItemTaskA (Task A)
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'create' having fired for plan item planItemMileStoneOne (PlanItem Milestone One)
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'create' having fired for plan item planItemTaskB (Task B)
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'create' having fired for plan item planItemMileStoneTwo (PlanItem Milestone Two)
Planned [Activate PlanItem] Task A (planItemTaskA)
Planned [Change PlanItem state] Task A (id: planItemTaskA), new state: [active] with transition [start]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'start' having fired for plan item planItemTaskA (Task A)
Planned [Change PlanItem state] Task A (id: planItemTaskA), new state: [completed] with transition [complete]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'complete' having fired for plan item planItemTaskA (Task A)
Planned [Activate PlanItem] PlanItem Milestone One (planItemMileStoneOne)
Planned [Change PlanItem state] PlanItem Milestone One (id: planItemMileStoneOne), new state: [active] with transition [start]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'start' having fired for plan item planItemMileStoneOne (PlanItem Milestone One)
Planned [Change PlanItem state] PlanItem Milestone One (id: planItemMileStoneOne), new state: [completed] with transition [occur]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'occur' having fired for plan item planItemMileStoneOne (PlanItem Milestone One)
Planned [Activate PlanItem] Task B (planItemTaskB)
Planned [Change PlanItem state] Task B (id: planItemTaskB), new state: [active] with transition [start]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'start' having fired for plan item planItemTaskB (Task B)
Planned [Change PlanItem state] Task B (id: planItemTaskB), new state: [completed] with transition [complete]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'complete' having fired for plan item planItemTaskB (Task B)
Planned [Activate PlanItem] PlanItem Milestone Two (planItemMileStoneTwo)
Planned [Change PlanItem state] PlanItem Milestone Two (id: planItemMileStoneTwo), new state: [active] with transition [start]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'start' having fired for plan item planItemMileStoneTwo (PlanItem Milestone Two)
Planned [Change PlanItem state] PlanItem Milestone Two (id: planItemMileStoneTwo), new state: [completed] with transition [occur]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'occur' having fired for plan item planItemMileStoneTwo (PlanItem Milestone Two)
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122
No active plan items found for plan model, completing case instance
Planned [Complete case instance] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122</code></pre>
</div>
</div>
</div>
</div>
</div>
</body>
</html>