<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>Flowable CMMN DOCS (v 6.4.0)</title>
<style>

/* normalize.css */

button,hr,input{overflow:visible}audio,canvas,progress,video{display:inline-block}progress,sub,sup{vertical-align:baseline}html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0} menu,article,aside,details,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{}button,select{text-transform:none}[type=submit], [type=reset],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:ButtonText dotted 1px}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}[hidden],template{display:none}/*# sourceMappingURL=normalize.min.css.map */

/* tocbot 2.1.4 */

.toc{overflow-y:auto}.toc>ul{overflow:hidden;position:relative}.toc-list{margin:0;padding-left:10px}a.toc-link{color:currentColor;height:100%}.is-collapsible{max-height:1000px;overflow:hidden;transition:all 300ms ease-in-out}.is-collapsed{max-height:0}.is-position-fixed{position:fixed !important;top:0}.is-active-link{font-weight:700}.toc-link::before{background-color:#f9f9fb;content:' ';display:inline-block;height:inherit;left:8px;margin-top:-1px;position:absolute;width:2px}.is-active-link::before{background-color:#54BC4B}


/* Activiti Specific */

body {
  color: #494d55;
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

html, body {
  height: 100%;
  width: 100%;
  background: #f9f9f9;
  font-family: "Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;
  color: #484848
}

.page-wrapper {
  min-height: 100%;
  /* equal to footer height */
  margin-bottom: -50px;
}

.page-wrapper:after {
  content: "";
  display: block;
  height: 50px;
}

#header {
  position:fixed;
  top:0px;
  z-index:100000;
  width:100%;
}

#header > h1 {
    background: #a0cc47;
    color: #f9f9f9;
    border-bottom: 2px solid #042944;
    padding: 20px 0 20px 20px;
    font-size: 40px;
    font-weight: 800;
    line-height: 1.1;
    margin: 0;
}

#header > h1:before {
  background:url('images/logo.png');
  background-size: 337px 54px; background-repeat: no-repeat;
  width: 337px;
  height: 54px;
  display:inline-block;
  content:'';
  margin-right: 30px;
}

#author {
  margin-left: 25%;
  font-size: 40px;
}

#content {
  margin: 129px 0 0 27%;
  padding: 10px 40px 0 20px;
  padding-right: 40px;
  line-height: 1.7;
  width: 65%;
  overflow-x: auto;
}

h2, h3, h4, h5, h6 {
  color: #00345a;
}

h2 {
  font-size: 26px;
  margin-top: 0;
  margin-bottom: 20px;
  font-weight: bold;
  padding-bottom: 10px;
  border-bottom: 1px solid #d7d7d7;
}

h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 0;
  font-weight: bold;
  padding-bottom: 10px;
  /*border-bottom: 1px solid #d7d7d7;*/
}

h4 {
    font-size: 16px;
    font-weight: bold;
}

h5 {
    font-size: 14px;
    font-weight: bold;
}

h6, h7 {
    font-size: 14px;
    font-weight: bold;
    margin-top: 0;
    margin-bottom: 0;
}

.sect1, .sect2 {
  margin-bottom: 20px;
}

.clear
{
  clear: both;
}

.note, .listingblock, .literalblock{
  padding-left: 8px;
  padding-right: 8px;
  margin-bottom: 14px;
  background-color: #f7f7f9;
  border: 1px solid #e1e1e8;
  border-radius: 4px;
  color: #808080;
}

table.tableblock {
  width: 100%;
  max-width: 100%;
  margin-bottom: 20px;
  background-color: transparent;
  border-spacing: 0;
  border-collapse: collapse;
  border: 1px solid #ddd;
  table-layout: fixed;
}

table.tableblock>caption+thead>tr:first-child>td, table.tableblock>caption+thead>tr:first-child>th, table.tableblock>colgroup+thead>tr:first-child>td, table.tableblock>colgroup+thead>tr:first-child>th, table.tableblock>thead:first-child>tr:first-child>td, table.tableblock>thead:first-child>tr:first-child>th {
    border-top: 0;
}

table.tableblock > thead > tr > th {
    border-bottom-color: #8bd6d8;
}

table.tableblock>thead>tr>th {
    vertical-align: bottom;
    border-bottom: 1px solid #ddd;
}

table.tableblock>tbody>tr>td, table.tableblock>tbody>tr>th, table.tableblock>tfoot>tr>td, table.tableblock>tfoot>tr>th, table.tableblock>thead>tr>td, table.tableblock>thead>tr>th {
    padding: 8px;
    line-height: 1.42857143;
    vertical-align: top;
    border-top: 1px solid #ddd;
}

th {
    text-align: left;
}

table.tableblock > tbody > tr:nth-of-type(odd) {
    background-color: #f5f5f5;
}

table.tableblock > tbody > tr:nth-of-type(odd) {
    background-color: #f9f9f9;
}

td > p {
  margin:0;
}

td.content {
  white-space: normal;
}

pre, td, th {
   white-space: pre-wrap;
   white-space: -moz-pre-wrap;
   white-space: -pre-wrap;
   white-space: -o-pre-wrap;
   word-wrap: break-word;
}

img {
  max-width: 100%;
}

a {
  color: #007387;
}

a:hover {
  color: #004c59;
}

#toc-parent {
  width: 25%;
  float: left;
  height: 100%;
  overflow-y: auto;
  position: fixed;
  padding: 10px;
  border-right: 1px solid #ccc;
}

#generated-toc {
    width: 100%;
    height: 100%;
    font-size: 16px;
}

.toc-link {
  text-decoration: none;
}

.toc-list {
  margin: 0 20px 0 10px;
}

.toc-list-item {
  padding: 4px 0 4px 0;
}


div.sect5  p {
    margin-top: 0;
    margin-bottom: 0;
}

div.sect5  code {
    font-family: "Helvetica Neue",Helvetica,Roboto,Arial,sans-serif;
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
.listingblock .pygments .hll { background-color: #ffffcc }
.listingblock .pygments, .listingblock .pygments code { background: #f8f8f8; }
.listingblock .pygments .tok-c { color: #408080; font-style: italic } /* Comment */
.listingblock .pygments .tok-err { border: 1px solid #FF0000 } /* Error */
.listingblock .pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
.listingblock .pygments .tok-o { color: #666666 } /* Operator */
.listingblock .pygments .tok-ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.listingblock .pygments .tok-cm { color: #408080; font-style: italic } /* Comment.Multiline */
.listingblock .pygments .tok-cp { color: #BC7A00 } /* Comment.Preproc */
.listingblock .pygments .tok-cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.listingblock .pygments .tok-c1 { color: #408080; font-style: italic } /* Comment.Single */
.listingblock .pygments .tok-cs { color: #408080; font-style: italic } /* Comment.Special */
.listingblock .pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
.listingblock .pygments .tok-ge { font-style: italic } /* Generic.Emph */
.listingblock .pygments .tok-gr { color: #FF0000 } /* Generic.Error */
.listingblock .pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
.listingblock .pygments .tok-gi { color: #00A000 } /* Generic.Inserted */
.listingblock .pygments .tok-go { color: #888888 } /* Generic.Output */
.listingblock .pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.listingblock .pygments .tok-gs { font-weight: bold } /* Generic.Strong */
.listingblock .pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.listingblock .pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
.listingblock .pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.listingblock .pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.listingblock .pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.listingblock .pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
.listingblock .pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.listingblock .pygments .tok-kt { color: #B00040 } /* Keyword.Type */
.listingblock .pygments .tok-m { color: #666666 } /* Literal.Number */
.listingblock .pygments .tok-s { color: #BA2121 } /* Literal.String */
.listingblock .pygments .tok-na { color: #7D9029 } /* Name.Attribute */
.listingblock .pygments .tok-nb { color: #008000 } /* Name.Builtin */
.listingblock .pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
.listingblock .pygments .tok-no { color: #880000 } /* Name.Constant */
.listingblock .pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
.listingblock .pygments .tok-ni { color: #999999; font-weight: bold } /* Name.Entity */
.listingblock .pygments .tok-ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.listingblock .pygments .tok-nf { color: #0000FF } /* Name.Function */
.listingblock .pygments .tok-nl { color: #A0A000 } /* Name.Label */
.listingblock .pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.listingblock .pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
.listingblock .pygments .tok-nv { color: #19177C } /* Name.Variable */
.listingblock .pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.listingblock .pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
.listingblock .pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
.listingblock .pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
.listingblock .pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
.listingblock .pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
.listingblock .pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
.listingblock .pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
.listingblock .pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
.listingblock .pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
.listingblock .pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
.listingblock .pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.listingblock .pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
.listingblock .pygments .tok-se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.listingblock .pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
.listingblock .pygments .tok-si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.listingblock .pygments .tok-sx { color: #008000 } /* Literal.String.Other */
.listingblock .pygments .tok-sr { color: #BB6688 } /* Literal.String.Regex */
.listingblock .pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
.listingblock .pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
.listingblock .pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
.listingblock .pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
.listingblock .pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
.listingblock .pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
.listingblock .pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
.listingblock .pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
.listingblock .pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
<script type="text/javascript">

/*
 * Tocbot.min.js version 2.1.4
 */

 !function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([/*!*************************!*\
   !*** ./src/js/index.js ***!
   \*************************/
 function(e,t,n){var o,i,r;(function(l){!function(n,l){i=[],o=l(n),r="function"==typeof o?o.apply(t,i):o,!(void 0!==r&&(e.exports=r))}("undefined"!=typeof l?l:this.window||this.global,function(e){"use strict";function t(){for(var e={},t=0;t<arguments.length;t++){var n=arguments[t];for(var o in n)h.call(n,o)&&(e[o]=n[o])}return e}function o(e,t,n){t||(t=250);var o,i;return function(){var r=n||this,l=+new Date,s=arguments;o&&l<o+t?(clearTimeout(i),i=setTimeout(function(){o=l,e.apply(r,s)},t)):(o=l,e.apply(r,s))}}var i,r,l,s=n(/*! smooth-scroll */1),c=n(/*! ./default-options.js */2),a={},u={},d=n(/*! ./build-html.js */3),f=n(/*! ./parse-content.js */4),m=(e.document,document.body,!!e.document.querySelector&&!!e.addEventListener),h=Object.prototype.hasOwnProperty;return u.destroy=function(){try{document.querySelector(a.tocSelector).innerHTML=""}catch(e){console.warn("Element not found: "+a.tocSelector)}document.removeEventListener("scroll",this._scrollListener,!1),document.removeEventListener("resize",this._scrollListener,!1),i&&document.removeEventListener("click",this._clickListener,!1),s&&s.destroy()},u.init=function(e){if(m&&(a=t(c,e||{}),this.options=a,this.state={},i=d(a),r=f(a),this._buildHtml=i,this._parseContent=r,u.destroy(),l=r.selectHeadings(a.contentSelector,a.headingSelector),null!==l)){var n=r.nestHeadingsArray(l),h=n.nest;return i.render(a.tocSelector,h),this._scrollListener=o(function(){i.updateToc(l)},a.throttleTimeout),this._scrollListener(),document.addEventListener("scroll",this._scrollListener,!1),document.addEventListener("resize",this._scrollListener,!1),this._clickListener=o(function(e){i.disableTocAnimation(e),i.updateToc(l)},a.throttleTimeout),document.addEventListener("click",this._clickListener,!1),s&&(this.smoothScroll=s.init(t(a.smoothScrollOptions,{callback:i.enableTocAnimation}))),this}},u.refresh=function(e){u.destroy(),u.init(e||this.options)},e.tocbot=u,u})}).call(t,function(){return this}())},/*!******************************************************!*\
   !*** ./~/smooth-scroll/dist/js/smooth-scroll.min.js ***!
   \******************************************************/
 function(e,t,n){var o,i,r;(function(n){/*! smooth-scroll v10.0.1 | (c) 2016 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/smooth-scroll */
 !function(n,l){i=[],o=l(n),r="function"==typeof o?o.apply(t,i):o,!(void 0!==r&&(e.exports=r))}("undefined"!=typeof n?n:this.window||this.global,function(e){"use strict";var t,n,o,i,r,l,s,c={},a="querySelector"in document&&"addEventListener"in e,u={selector:"[data-scroll]",selectorHeader:null,speed:500,easing:"easeInOutCubic",offset:0,callback:function(){}},d=function(){var e={},t=!1,n=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],n++);for(var i=function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t&&"[object Object]"===Object.prototype.toString.call(n[o])?e[o]=d(!0,e[o],n[o]):e[o]=n[o])};o>n;n++){var r=arguments[n];i(r)}return e},f=function(e){return Math.max(e.scrollHeight,e.offsetHeight,e.clientHeight)},m=function(e,t){var n,o,i=t.charAt(0),r="classList"in document.documentElement;for("["===i&&(t=t.substr(1,t.length-2),n=t.split("="),n.length>1&&(o=!0,n[1]=n[1].replace(/"/g,"").replace(/'/g,"")));e&&e!==document&&1===e.nodeType;e=e.parentNode){if("."===i)if(r){if(e.classList.contains(t.substr(1)))return e}else if(new RegExp("(^|\\s)"+t.substr(1)+"(\\s|$)").test(e.className))return e;if("#"===i&&e.id===t.substr(1))return e;if("["===i&&e.hasAttribute(n[0])){if(!o)return e;if(e.getAttribute(n[0])===n[1])return e}if(e.tagName.toLowerCase()===t)return e}return null},h=function(e){"#"===e.charAt(0)&&(e=e.substr(1));for(var t,n=String(e),o=n.length,i=-1,r="",l=n.charCodeAt(0);++i<o;){if(t=n.charCodeAt(i),0===t)throw new InvalidCharacterError("Invalid character: the input contains U+0000.");r+=t>=1&&31>=t||127==t||0===i&&t>=48&&57>=t||1===i&&t>=48&&57>=t&&45===l?"\\"+t.toString(16)+" ":t>=128||45===t||95===t||t>=48&&57>=t||t>=65&&90>=t||t>=97&&122>=t?n.charAt(i):"\\"+n.charAt(i)}return"#"+r},p=function(e,t){var n;return"easeInQuad"===e&&(n=t*t),"easeOutQuad"===e&&(n=t*(2-t)),"easeInOutQuad"===e&&(n=.5>t?2*t*t:-1+(4-2*t)*t),"easeInCubic"===e&&(n=t*t*t),"easeOutCubic"===e&&(n=--t*t*t+1),"easeInOutCubic"===e&&(n=.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1),"easeInQuart"===e&&(n=t*t*t*t),"easeOutQuart"===e&&(n=1- --t*t*t*t),"easeInOutQuart"===e&&(n=.5>t?8*t*t*t*t:1-8*--t*t*t*t),"easeInQuint"===e&&(n=t*t*t*t*t),"easeOutQuint"===e&&(n=1+--t*t*t*t*t),"easeInOutQuint"===e&&(n=.5>t?16*t*t*t*t*t:1+16*--t*t*t*t*t),n||t},v=function(e,t,n){var o=0;if(e.offsetParent)do o+=e.offsetTop,e=e.offsetParent;while(e);return o=Math.max(o-t-n,0),Math.min(o,b()-g())},g=function(){return Math.max(document.documentElement.clientHeight,e.innerHeight||0)},b=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},C=function(e){return e&&"object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(e):{}},S=function(e){return e?f(e)+e.offsetTop:0},y=function(t,n,o){o||(t.focus(),document.activeElement.id!==t.id&&(t.setAttribute("tabindex","-1"),t.focus(),t.style.outline="none"),e.scrollTo(0,n))};c.animateScroll=function(n,o,l){var c=C(o?o.getAttribute("data-options"):null),a=d(t||u,l||{},c),f="[object Number]"===Object.prototype.toString.call(n),m=f||!n.tagName?null:n;if(f||m){var h=e.pageYOffset;a.selectorHeader&&!i&&(i=document.querySelector(a.selectorHeader)),r||(r=S(i));var g,x,N=f?n:v(m,r,parseInt(a.offset,10)),L=N-h,O=b(),E=0,A=function(t,i,r){var l=e.pageYOffset;(t==i||l==i||e.innerHeight+l>=O)&&(clearInterval(r),y(n,i,f),a.callback(n,o))},H=function(){E+=16,g=E/parseInt(a.speed,10),g=g>1?1:g,x=h+L*p(a.easing,g),e.scrollTo(0,Math.floor(x)),A(x,N,s)},T=function(){clearInterval(s),s=setInterval(H,16)};0===e.pageYOffset&&e.scrollTo(0,0),T()}};var x=function(t){e.location.hash,n&&(n.id=n.getAttribute("data-scroll-id"),c.animateScroll(n,o),n=null,o=null)},N=function(i){if(0===i.button&&!i.metaKey&&!i.ctrlKey&&(o=m(i.target,t.selector),o&&"a"===o.tagName.toLowerCase()&&o.hostname===e.location.hostname&&o.pathname===e.location.pathname&&/#/.test(o.href))){var r=h(o.hash);if("#"===r){i.preventDefault(),n=document.body;var l=n.id?n.id:"smooth-scroll-top";return n.setAttribute("data-scroll-id",l),n.id="",void(e.location.hash.substring(1)===l?x():e.location.hash=l)}n=document.querySelector(r),n&&(n.setAttribute("data-scroll-id",n.id),n.id="",o.hash===e.location.hash&&(i.preventDefault(),x()))}},L=function(e){l||(l=setTimeout(function(){l=null,r=S(i)},66))};return c.destroy=function(){t&&(document.removeEventListener("click",N,!1),e.removeEventListener("resize",L,!1),t=null,n=null,o=null,i=null,r=null,l=null,s=null)},c.init=function(n){a&&(c.destroy(),t=d(u,n||{}),i=t.selectorHeader?document.querySelector(t.selectorHeader):null,r=S(i),document.addEventListener("click",N,!1),e.addEventListener("hashchange",x,!1),i&&e.addEventListener("resize",L,!1))},c})}).call(t,function(){return this}())},/*!***********************************!*\
   !*** ./src/js/default-options.js ***!
   \***********************************/
 function(e,t){e.exports={tocSelector:".js-toc",contentSelector:".js-toc-content",headingSelector:"h1, h2, h3",ignoreSelector:".js-toc-ignore",linkClass:"toc-link",extraLinkClasses:"",activeLinkClass:"is-active-link",listClass:"toc-list",extraListClasses:"",isCollapsedClass:"is-collapsed",collapsibleClass:"is-collapsible",listItemClass:"toc-list-item",collapseDepth:0,smoothScrollOptions:{easing:"easeInOutCubic",offset:0,speed:300,updateURL:!0},headingsOffset:0,throttleTimeout:50,positionFixedSelector:null,positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto",includeHtml:!1}},/*!******************************!*\
   !*** ./src/js/build-html.js ***!
   \******************************/
 function(e,t){e.exports=function(e){function t(e,n){var r=n.appendChild(o(e));if(e.children.length){var l=i(e.isCollapsed);e.children.forEach(function(e){t(e,l)}),r.appendChild(l)}}function n(e,n){var o=!1,r=i(o);n.forEach(function(e){t(e,r)});var l=document.querySelector(e);if(null!==l)return l.firstChild&&l.removeChild(l.firstChild),l.appendChild(r)}function o(t){var n=document.createElement("li"),o=document.createElement("a");return e.listItemClass&&n.setAttribute("class",e.listItemClass),e.includeHtml&&t.childNodes.length?u.call(t.childNodes,function(e){o.appendChild(e.cloneNode(!0))}):o.textContent=t.textContent,o.setAttribute("data-scroll",""),o.setAttribute("href","#"+t.id),o.setAttribute("class",e.linkClass+h+"node-name--"+t.nodeName+h+e.extraLinkClasses),n.appendChild(o),n}function i(t){var n=document.createElement("ul"),o=e.listClass+h+e.extraListClasses;return t&&(o+=h+e.collapsibleClass,o+=h+e.isCollapsedClass),n.setAttribute("class",o),n}function r(){var t=document.documentElement.scrollTop||f.scrollTop,n=document.querySelector(e.positionFixedSelector);"auto"===e.fixedSidebarOffset&&(e.fixedSidebarOffset=document.querySelector(e.tocSelector).offsetTop),t>e.fixedSidebarOffset?n.className.indexOf(e.positionFixedClass)===-1&&(n.className+=h+e.positionFixedClass):n.className=n.className.split(h+e.positionFixedClass).join("")}function l(t){var n=document.documentElement.scrollTop||f.scrollTop;e.positionFixedSelector&&r();var o,i=t;if(m&&null!==document.querySelector(e.tocSelector)&&i.length>0){d.call(i,function(t,r){if(t.offsetTop>n+e.headingsOffset){var l=0===r?r:r-1;return o=i[l],!0}if(r===i.length-1)return o=i[i.length-1],!0});var l=document.querySelector(e.tocSelector).querySelectorAll("."+e.linkClass);u.call(l,function(t){t.className=t.className.split(h+e.activeLinkClass).join("")});var c=document.querySelector(e.tocSelector).querySelector("."+e.linkClass+".node-name--"+o.nodeName+'[href="#'+o.id+'"]');c.className+=h+e.activeLinkClass;var a=document.querySelector(e.tocSelector).querySelectorAll("."+e.listClass+"."+e.collapsibleClass);u.call(a,function(t){var n=h+e.isCollapsedClass;t.className.indexOf(n)===-1&&(t.className+=h+e.isCollapsedClass)}),c.nextSibling&&(c.nextSibling.className=c.nextSibling.className.split(h+e.isCollapsedClass).join("")),s(c.parentNode.parentNode)}}function s(t){return t.className.indexOf(e.collapsibleClass)!==-1?(t.className=t.className.split(h+e.isCollapsedClass).join(""),s(t.parentNode.parentNode)):t}function c(t){var n=t.target||t.srcElement;n.className.indexOf(e.linkClass)!==-1&&(m=!1)}function a(){m=!0}var u=[].forEach,d=[].some,f=document.body,m=!0,h=" ";return{enableTocAnimation:a,disableTocAnimation:c,render:n,updateToc:l}}},/*!*********************************!*\
   !*** ./src/js/parse-content.js ***!
   \*********************************/
 function(e,t){e.exports=function(e){function t(e){return e[e.length-1]}function n(e){return+e.nodeName.split("H").join("")}function o(t){var o={id:t.id,children:[],nodeName:t.nodeName,headingLevel:n(t),textContent:t.textContent.trim()};return e.includeHtml&&(o.childNodes=t.childNodes),o}function i(i,r){for(var l=o(i),s=n(i),c=r,a=t(c),u=a?a.headingLevel:0,d=s-u;d>0;)a=t(c),a&&void 0!==a.children&&(c=a.children),d--;return s>=e.collapseDepth&&(l.isCollapsed=!0),c.push(l),c}function r(t,n){var o=n;e.ignoreSelector&&(o=n.split(",").map(function(t){return t.trim()+":not("+e.ignoreSelector+")"}));try{return document.querySelector(t).querySelectorAll(o)}catch(i){return console.warn("Element not found: "+t),null}}function l(e){return s.call(e,function(e,t){var n=o(t);return i(n,e.nest),e},{nest:[]})}var s=[].reduce;return{nestHeadingsArray:l,selectHeadings:r}}}]);
 //# sourceMappingURL=tocbot.min.js.map

</script>

<script type="text/javascript">

  var generateToc = function() {
    var readyState = document.readyState;
    if (readyState === 'interactive' || readyState == 'complete') {

      var headerSize = 140;

      var tocParentNode = document.createElement("div");
      tocParentNode.setAttribute("id", "toc-parent");

      var generatedTocNode = document.createElement("div");
      generatedTocNode.setAttribute("id", "generated-toc");
      tocParentNode.appendChild(generatedTocNode);

      var contentNode = document.getElementById("content");
      contentNode.parentNode.insertBefore(tocParentNode, contentNode);

      var clearNode = document.createElement("div");
      clearNode.setAttribute("class", "clear");
      contentNode.parentNode.appendChild(clearNode);

      tocbot.init({
        tocSelector: '#generated-toc',
        contentSelector: '#content',
        headingSelector: 'h2, h3, h4, h5',
        headingsOffset: headerSize,
        smoothScrollOptions: {
          easing: 'easeInOutCubic',
          offset: headerSize,
          speed: 300, // animation duration.
          updateURL: true
        },
        collapseDepth: 0
      });

    } else {
      window.setTimeout(function(){
        generateToc();
      }, 50);
    }

  }
  generateToc();

</script>
</head>
<body class="book">
<div id="header">
<h1>Flowable CMMN DOCS (v 6.4.0)</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="license">1.1. License</h3>
<div class="paragraph">
<p>Flowable is distributed under <a href="http://www.apache.org/licenses/LICENSE-2.0.html">the Apache V2 license</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="download">1.2. Download</h3>
<div class="paragraph">
<p><a href="http://www.flowable.org/downloads.html"><a href="http://www.flowable.org/downloads.html" class="bare">http://www.flowable.org/downloads.html</a></a></p>
</div>
</div>
<div class="sect2">
<h3 id="sources">1.3. Sources</h3>
<div class="paragraph">
<p>The distribution contains most of the sources as JAR files. The source code of Flowable can be found on <a href="https://github.com/flowable/flowable-engine"><a href="https://github.com/flowable/flowable-engine" class="bare">https://github.com/flowable/flowable-engine</a></a></p>
</div>
</div>
<div class="sect2">
<h3 id="experimental">1.4. Experimental Features</h3>
<div class="paragraph">
<p>Sections marked with <strong>[EXPERIMENTAL]</strong> should not be considered stable.</p>
</div>
<div class="paragraph">
<p>All classes that have <code>.impl.</code> in the package name are internal implementation classes and cannot be considered stable or guaranteed in any way.  However, if the User Guide mentions any classes as configuration values, they are supported and can be considered stable.</p>
</div>
</div>
<div class="sect2">
<h3 id="required.software">1.5. Required software</h3>
<div class="paragraph">
<p>Flowable runs on a JDK higher than or equal to version 8. Go to <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Oracle Java SE downloads</a> and click on button "Download JDK".  There are installation instructions on that page as well. To verify that your installation was successful, run <code>java -version</code> on the command line.  That should print the installed version of your JDK.</p>
</div>
</div>
<div class="sect2">
<h3 id="reporting.problems">1.6. Reporting problems</h3>
<div class="paragraph">
<p>Questions and comments can be discussed on the on <a href="https://forum.flowable.org">the Flowable forum</a>. Issues can be created in <a href="https://github.com/flowable/flowable-engine/issues">our Github issue tracker</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="internal">1.7. Internal implementation classes</h3>
<div class="paragraph">
<p>In the JAR file, all classes in packages that have <code>.impl.</code> in them are implementation classes and should be considered internal. No stability guarantees are given on classes or interfaces that are in implementation classes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration">2. Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="configuration">2.1. Creating a CmmnEngine</h3>
<div class="paragraph">
<p>The Flowable CMMN engine is configured through an XML file called <code>flowable.cmmn.cfg.xml</code>. Note that this is <strong>not</strong> applicable if you&#8217;re using <a href="#springintegration">the Spring style of building a process engine</a>.</p>
</div>
<div class="paragraph">
<p>The easiest way to obtain a <code>CmmnEngine</code> is to use the <code>org.flowable.cmmn.engine.CmmnEngineConfiguration</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneCmmnEngineConfiguration</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will look for a <code>flowable.cmmn.cfg.xml</code> file on the classpath and construct an engine based on the configuration in that file. The following snippet shows an example configuration.  The following sections will give a detailed overview of the configuration properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="tok-na">xmlns:xsi=</span><span class="tok-s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="tok-na">xsi:schemaLocation=</span><span class="tok-s">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.engine.CmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>

    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the configuration XML is in fact a Spring configuration. <strong>This does not mean that Flowable can only be used in a Spring environment!</strong> We are simply leveraging the parsing and dependency injection capabilities of Spring internally for building up the engine.</p>
</div>
<div class="paragraph">
<p>The CmmnEngineConfiguration object can also be created programmatically using the configuration file. It is also possible to use a different bean id (for example, see line 3).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span>
  <span class="tok-nf">createCmmnEngineConfigurationFromResourceDefault</span><span class="tok-o">();</span>
  <span class="tok-n">createCmmnEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">);</span>
  <span class="tok-n">createCmmnEngineConfigurationFromResource</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">resource</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
  <span class="tok-n">createCmmnEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">);</span>
  <span class="tok-n">createCmmnEngineConfigurationFromInputStream</span><span class="tok-o">(</span><span class="tok-n">InputStream</span> <span class="tok-n">inputStream</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">beanName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible not to use a configuration file, and create a configuration based on
defaults (see <a href="#configurationClasses">the different supported classes</a> for more information).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneCmmnEngineConfiguration</span><span class="tok-o">();</span>
<span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemCmmnEngineConfiguration</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>All these <code>CmmnEngineConfiguration.createXXX()</code> methods return a <code>CmmnEngineConfiguration</code> that can be tweaked further if needed. After calling the <code>buildCmmnEngine()</code> operation, a <code>CmmnEngine</code> is created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneInMemCmmnEngineConfiguration</span><span class="tok-o">()</span>
  <span class="tok-o">.</span><span class="tok-na">setDatabaseSchemaUpdate</span><span class="tok-o">(</span><span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">DB_SCHEMA_UPDATE_TRUE</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">setJdbcUrl</span><span class="tok-o">(</span><span class="tok-s">&quot;jdbc:h2:mem:my-own-db;DB_CLOSE_DELAY=1000&quot;</span><span class="tok-o">)</span>
  <span class="tok-o">.</span><span class="tok-na">buildCmmnEngine</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configurationRoot">2.2. CmmnEngineConfiguration bean</h3>
<div class="paragraph">
<p>The <code>flowable.cmmn.cfg.xml</code> must contain a bean that has the id <code>'cmmnEngineConfiguration'</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span> <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.engine.CmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>This bean is then used to construct the <code>CmmnEngine</code>. There are multiple classes available that can be used to define the <code>cmmnEngineConfiguration</code>. These classes represent different environments, and set defaults accordingly. It&#8217;s best practice to select the class that best matches your environment, to minimize the number of properties needed to configure the engine. The following classes are currently available: <a id="configurationClasses"></a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.flowable.cmmn.engine.impl.cfg.StandaloneInMemCmmnEngineConfiguration</strong>: this is a convenience class for unit testing purposes. Flowable will take care of all transactions. An H2 in-memory database is used by default. The database will be created and dropped when the engine boots and shuts down. When using this, no additional configuration is probably needed.</p>
</li>
<li>
<p><strong>org.flowable.cmmn.spring.SpringCmmnEngineConfiguration</strong>: To be used when the CMMN engine is used in a Spring environment.  See <a href="#springintegration">the Spring integration section</a> for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="databaseConfiguration">2.3. Database configuration</h3>
<div class="paragraph">
<p>There are two ways to configure the database that the Flowable CMMN engine will use. The first option is to define the JDBC properties of the database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcUrl</strong>: JDBC URL of the database.</p>
</li>
<li>
<p><strong>jdbcDriver</strong>: implementation of the driver for the specific database type.</p>
</li>
<li>
<p><strong>jdbcUsername</strong>: username to connect to the database.</p>
</li>
<li>
<p><strong>jdbcPassword</strong>: password to connect to the database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The data source that is constructed based on the provided JDBC properties will have the default <a href="http://www.mybatis.org/">MyBatis</a> connection pool settings. The following attributes can optionally be set to tweak that connection pool (taken from the MyBatis documentation):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcMaxActiveConnections</strong>: The number of active connections that the connection pool at maximum at any time can contain. Default is 10.</p>
</li>
<li>
<p><strong>jdbcMaxIdleConnections</strong>: The number of idle connections that the connection pool at maximum at any time can contain.</p>
</li>
<li>
<p><strong>jdbcMaxCheckoutTime</strong>: The amount of time in milliseconds a connection can be <em>checked out</em> from the connection pool before it is forcefully returned. Default is 20000 (20 seconds).</p>
</li>
<li>
<p><strong>jdbcMaxWaitTime</strong>: This is a low level setting that gives the pool a chance to print a log status and re-attempt the acquisition of a connection in the case that it is taking unusually long (to avoid failing silently forever if the pool is misconfigured) Default is 20000 (20 seconds).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Example database configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUrl&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcDriver&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;org.h2.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcUsername&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;sa&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;jdbcPassword&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Our benchmarks have shown that the MyBatis connection pool is not the most efficient or resilient when dealing with a lot of concurrent requests. As such, it is advised to us a <code>javax.sql.DataSource</code> implementation and inject it into the process engine configuration (For example HikariCP, Tomcat JDBC Connection Pool, etc.):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</div></td><td class="code"><span></span><span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;driverClassName&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;url&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;flowable&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;defaultAutoCommit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;false&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.engine.CmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-na">ref=</span><span class="tok-s">&quot;dataSource&quot;</span> <span class="tok-nt">/&gt;</span>
  ...
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that Flowable does not ship with a library that allows you to define such a data source. So you need to make sure that the libraries are on your classpath.</p>
</div>
<div class="paragraph">
<p>The following properties can be set, regardless of whether you are using the JDBC or data source approach:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>databaseType</strong>: it&#8217;s normally not necessary to specify this property, as it is automatically detected from the database connection metadata. Should only be specified when automatic detection fails. Possible values: {h2, mysql, oracle, postgres, mssql, db2}. This setting will determine which create/drop scripts and queries will be used. See <a href="#supporteddatabases">the <em>supported databases</em> section</a> for an overview of which types are supported.</p>
</li>
<li>
<p><strong>databaseSchemaUpdate</strong>: sets the strategy to handle the database schema on process engine boot and shutdown.</p>
<div class="ulist">
<ul>
<li>
<p><code>false</code> (default): Checks the version of the DB schema against the library when the process engine is being created and throws an exception if the versions don&#8217;t match.</p>
</li>
<li>
<p><code>true</code>: Upon building the process engine, a check is performed and an update of the schema is performed if it is necessary. If the schema doesn&#8217;t exist, it is created.</p>
</li>
<li>
<p><code>create-drop</code>: Creates the schema when the process engine is being created and drops the schema when the process engine is being closed.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="jndiDatasourceConfig">2.4. JNDI Datasource Configuration</h3>
<div class="paragraph">
<p>By default, the database configuration for Flowable is contained within the db.properties files in the WEB-INF/classes of each web application. This isn&#8217;t always ideal because it
requires users to either modify the db.properties in the Flowable source and recompile the WAR file, or explode the WAR and modify the db.properties on every deployment.</p>
</div>
<div class="paragraph">
<p>By using JNDI (Java Naming and Directory Interface) to obtain the database connection, the connection is fully managed by the Servlet Container and the configuration can be managed outside the WAR deployment. This also allows more control over the connection parameters than what is provided by the db.properties file.</p>
</div>
<div class="sect3">
<h4 id="jndi_configuration">2.4.1. Configuration</h4>
<div class="paragraph">
<p>Configuration of the JNDI data source will differ depending on what servlet container application you are using. The instructions below will work for Tomcat, but for other container applications, please refer to the documentation for your container app.</p>
</div>
<div class="paragraph">
<p>If using Tomcat, the JNDI resource is configured within $CATALINA_BASE/conf/[enginename]/[hostname]/[warname].xml (for the Flowable UI this will usually be $CATALINA_BASE/conf/Catalina/localhost/flowable-app.xml). The default context is copied from the Flowable WAR file when the application is first deployed, so if it already exists, you will need to replace it. To change the JNDI resource so that the application connects to MySQL instead of H2, for example, change the file to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</div></td><td class="code"><span></span><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
    <span class="tok-nt">&lt;Context</span> <span class="tok-na">antiJARLocking=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-na">path=</span><span class="tok-s">&quot;/flowable-app&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;Resource</span> <span class="tok-na">auth=</span><span class="tok-s">&quot;Container&quot;</span>
            <span class="tok-na">name=</span><span class="tok-s">&quot;jdbc/flowableDB&quot;</span>
            <span class="tok-na">type=</span><span class="tok-s">&quot;javax.sql.DataSource&quot;</span>
            <span class="tok-na">description=</span><span class="tok-s">&quot;JDBC DataSource&quot;</span>
            <span class="tok-na">url=</span><span class="tok-s">&quot;jdbc:mysql://localhost:3306/flowable&quot;</span>
            <span class="tok-na">driverClassName=</span><span class="tok-s">&quot;com.mysql.jdbc.Driver&quot;</span>
            <span class="tok-na">username=</span><span class="tok-s">&quot;sa&quot;</span>
            <span class="tok-na">password=</span><span class="tok-s">&quot;&quot;</span>
            <span class="tok-na">defaultAutoCommit=</span><span class="tok-s">&quot;false&quot;</span>
            <span class="tok-na">initialSize=</span><span class="tok-s">&quot;5&quot;</span>
            <span class="tok-na">maxWait=</span><span class="tok-s">&quot;5000&quot;</span>
            <span class="tok-na">maxActive=</span><span class="tok-s">&quot;120&quot;</span>
            <span class="tok-na">maxIdle=</span><span class="tok-s">&quot;5&quot;</span><span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;/Context&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jndi_properties">2.4.2. JNDI properties</h4>
<div class="paragraph">
<p>To configure a JNDI data source, use following properties in the properties file for the Flowable UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>spring.datasource.jndi-name=: the JNDI name of the data source.</p>
</li>
<li>
<p>datasource.jndi.resourceRef: Set whether the lookup occurs in a J2EE container, for example, the prefix "java:comp/env/" needs to be added if the JNDI name doesn&#8217;t already contain it. Default is "true".</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="supporteddatabases">2.5. Supported databases</h3>
<div class="paragraph">
<p>Listed below are the types (case sensitive!) that Flowable uses to refer to databases.</p>
</div>
<table id="databaseTypes" class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Flowable database type</th>
<th class="tableblock halign-left valign-top">Example JDBC URL</th>
<th class="tableblock halign-left valign-top">Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">h2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:h2:tcp://localhost/flowable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default configured database</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mysql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:mysql://localhost:3306/flowable?autoReconnect=true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested using mysql-connector-java database driver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oracle</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:oracle:thin:@localhost:1521:xe</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">postgres</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:postgresql://localhost:5432/flowable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">db2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:db2://localhost:50000/flowable</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mssql</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jdbc:sqlserver://localhost:1433;databaseName=flowable (jdbc.driver=com.microsoft.sqlserver.jdbc.SQLServerDriver) <em>OR</em> jdbc:jtds:sqlserver://localhost:1433/flowable (jdbc.driver=net.sourceforge.jtds.jdbc.Driver)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tested using Microsoft JDBC Driver 4.0 (sqljdbc4.jar) and JTDS Driver</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="creatingDatabaseTable">2.6. Creating the database tables</h3>
<div class="paragraph">
<p>The easiest way to create the database tables for your database is to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the flowable-cmmn-engine JARs to your classpath</p>
</li>
<li>
<p>Add a suitable database driver</p>
</li>
<li>
<p>Add a Flowable configuration file (<em>flowable.cmmn.cfg.xml</em>) to your classpath, pointing to your database (see <a href="#databaseConfiguration">database configuration section</a>)</p>
</li>
<li>
<p>Execute the main method of the <em>DbSchemaCreate</em> class</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, often only database administrators can execute DDL statements on a database. On a production system, this is also the wisest of choices. The SQL DDL statements can be found on the Flowable downloads page or inside the Flowable distribution folder, in the <code>database</code> subdirectory. The scripts are also in the engine JAR (<em>flowable-cmmn-engine-x.jar</em>), in the package <em>org/flowable/cmmn/db/create</em> . The SQL files are of the form</p>
</div>
<div class="listingblock">
<div class="content">
<pre>flowable.{db}.cmmn.create.sql</pre>
</div>
</div>
<div class="paragraph">
<p>Where <em>db</em> is any of the <a href="#supporteddatabases">supported databases</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="database.tables.explained">2.7. Database table names explained</h3>
<div class="paragraph">
<p>The database names of the Flowable CMMN Engine all start with <strong>ACT_CMMN_</strong>. The second part is a two-character identification of the use case of the table. This use case will also roughly match the service API.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ACT_CMMN_</strong>*: Tables without an additional prefix contain <em>static</em> information such as case definitions and case resources (images, rules, etc.).</p>
</li>
<li>
<p><strong>ACT_CMMN_RU_</strong>*: <em>RU</em> stands for <code>runtime</code>. These are the runtime tables that contain the runtime data of case instances, plan items, and so on. Flowable only stores the runtime data during case instance execution and removes the records when a case instance ends. This keeps the runtime tables small and fast.</p>
</li>
<li>
<p><strong>ACT_CMMN_HI_</strong>*: <em>HI</em> stands for <code>history</code>. These are the tables that contain historic data, such as past case instances, plan items, and so on.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="databaseUpgrade">2.8. Database upgrade</h3>
<div class="paragraph">
<p>Make sure you make a backup of your database (using your database backup capabilities) before you run an upgrade.</p>
</div>
<div class="paragraph">
<p>By default, a version check will be performed each time a process engine is created. This typically happens once at boot time of your application or of the Flowable webapps. If the Flowable library notices a difference between the library version and the version of the Flowable database tables, then an exception is thrown.</p>
</div>
<div class="paragraph">
<p>To upgrade, you have to start by putting the following configuration property in your flowable.cmmn.cfg.xml configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</div></td><td class="code"><span></span><span class="tok-nt">&lt;beans</span> <span class="tok-nt">&gt;</span>

  <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;cmmnEngineConfiguration&quot;</span>
      <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.cmmn.engine.CmmnEngineConfiguration&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
    <span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;databaseSchemaUpdate&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;true&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-c">&lt;!-- ... --&gt;</span>
  <span class="tok-nt">&lt;/bean&gt;</span>

<span class="tok-nt">&lt;/beans&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Also, include a suitable database driver for your database to the classpath.</strong> Upgrade the Flowable libraries in your application. Or start up a new version of Flowable and point it to a database that contains data from an older version.  With <code>databaseSchemaUpdate</code> set to <code>true</code>, Flowable will automatically upgrade the DB schema to the newest version the first time when it notices that libraries and DB schema are out of sync.</p>
</div>
<div class="paragraph">
<p><strong>As an alternative, you can also run the upgrade DDL statements.</strong> It&#8217;s also possible to run the upgrade database scripts available on the Flowable downloads page.</p>
</div>
</div>
<div class="sect2">
<h3 id="historyConfiguration">2.9. History configuration</h3>
<div class="paragraph">
<p>Customizing the configuration of history storage is optional. This allows you to tweak settings that influence the <a href="#history">history capabilities</a> of the engine. See <a href="#historyConfig">history configuration</a> for more details.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;history&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;audit&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="exposingConfigurationBeans">2.10. Exposing configuration beans in expressions and scripts</h3>
<div class="paragraph">
<p>By default, all beans that you specify in the <code>flowable.cmmn.cfg.xml</code> configuration or in your own Spring configuration file are available to expressions and scripts. If you want to limit the visibility of beans in your configuration file, you can configure a property called <code>beans</code> in your process engine configuration. The beans property in <code>CmmnEngineConfiguration</code> is a map. When you specify that property, only beans specified in that map will be visible to expressions and scripts.  The exposed beans will be exposed with the names as you specify in the map.</p>
</div>
</div>
<div class="sect2">
<h3 id="caseDefinitionCacheConfiguration">2.11. Deployment cache configuration</h3>
<div class="paragraph">
<p>All case definitions are cached (after they&#8217;re parsed) to avoid hitting the database every time a case definition is needed and because case definition data doesn&#8217;t change. By default, there is no limit on this cache. To limit the case definition cache, add following property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;caseDefinitionCacheLimit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;10&quot;</span> <span class="tok-nt">/&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting this property will swap the default hashmap cache with a LRU cache that has the provided hard limit. Of course, the <em>best</em> value for this property depends on the total amount of case definitions stored and the number of case definitions actually used at runtime by all the runtime case instances.</p>
</div>
<div class="paragraph">
<p>You can also inject your own cache implementation. This must be a bean that implements the org.flowable.engine.common.impl.persistence.deploy.DeploymentCache interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3</div></td><td class="code"><span></span><span class="tok-nt">&lt;property</span> <span class="tok-na">name=</span><span class="tok-s">&quot;caseDefinitionCache&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;bean</span> <span class="tok-na">class=</span><span class="tok-s">&quot;org.flowable.MyCache&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/property&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="loggingConfiguration">2.12. Logging</h3>
<div class="paragraph">
<p>All logging (flowable, spring, mybatis, &#8230;&#8203;) is routed through SLF4J and allows for selecting the logging-implementation of your choice.</p>
</div>
<div class="paragraph">
<p><strong>By default no SFL4J-binding JAR is present in the flowable-cmmn-engine dependencies, this should be added in your project in order to use the logging framework of your choice.</strong> If no implementation JAR is added, SLF4J will use a NOP-logger, not logging anything at all, other than a warning that nothing will be logged. For more info on these bindings <a href="http://www.slf4j.org/codes.html#StaticLoggerBinder"><a href="http://www.slf4j.org/codes.html#StaticLoggerBinder" class="bare">http://www.slf4j.org/codes.html#StaticLoggerBinder</a></a>.</p>
</div>
<div class="paragraph">
<p>With Maven, add for example a dependency like this (here using log4j), note that you still need to add a version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>slf4j-log4j12<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The flowable-ui and flowable-rest webapps are configured to use Log4j-binding. Log4j is also used when running the tests for all the flowable-* modules.</p>
</div>
<div class="paragraph">
<p><strong>Important note when using a container with commons-logging in the classpath:</strong> In order to route the spring-logging through SLF4J, a bridge is used (see <a href="http://www.slf4j.org/legacy.html#jclOverSLF4J"><a href="http://www.slf4j.org/legacy.html#jclOverSLF4J" class="bare">http://www.slf4j.org/legacy.html#jclOverSLF4J</a></a>). If your container provides a commons-logging implementation, please follow directions on this page: <a href="http://www.slf4j.org/codes.html#release"><a href="http://www.slf4j.org/codes.html#release" class="bare">http://www.slf4j.org/codes.html#release</a></a> to ensure stability.</p>
</div>
<div class="paragraph">
<p>Example when using Maven (version omitted):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
  <span class="tok-nt">&lt;groupId&gt;</span>org.slf4j<span class="tok-nt">&lt;/groupId&gt;</span>
  <span class="tok-nt">&lt;artifactId&gt;</span>jcl-over-slf4j<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chapterApi">3. The Flowable CMMN API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="apiEngine">3.1. The Process CMMN Engine API and services</h3>
<div class="paragraph">
<p>The engine API is the most common way of interacting with Flowable. The main starting point is the <code>CmmnEngine</code>, which can be created in several ways as described in the  <a href="#configuration">configuration section</a>. From the CmmnEngine, you can obtain the various services that contain the case/CMMN methods. CmmnEngine and the services objects are thread safe, so you can keep a reference to one of those for a whole server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6
7</div></td><td class="code"><span></span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">CmmnEngineConfiguration</span><span class="tok-o">.</span><span class="tok-na">createStandaloneCmmnEngineConfiguration</span><span class="tok-o">();</span>

<span class="tok-n">CmmnRuntimeService</span> <span class="tok-n">runtimeService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRuntimeService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnRepositoryService</span> <span class="tok-n">repositoryService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRepositoryService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnTaskService</span> <span class="tok-n">taskService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnTaskService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnManagementService</span> <span class="tok-n">managementService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnManagementService</span><span class="tok-o">();</span>
<span class="tok-n">CmmnHistoryService</span> <span class="tok-n">historyService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnHistoryService</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>CmmnEngineConfiguration.createStandaloneCmmnEngineConfiguration()</code> will initialize and build a CMMN engine and afterwards always return the CMMN engine.</p>
</div>
<div class="paragraph">
<p>The CmmnEngineConfiguration class will scan for all <code>flowable.cmmn.cfg.xml</code> and <code>flowable-cmmn-context.xml</code> files. For all <code>flowable.cmmn.cfg.xml</code> files, the CMMN engine will be built in the typical Flowable way: <code>CmmnEngineConfiguration.createCmmnEngineConfigurationFromInputStream(inputStream).buildCmmnEngine()</code>. For all <code>flowable-cmmn-context.xml</code> files, the CMMN engine will be built in the Spring way: first the Spring application context is created and then the CMMN engine is obtained from that application context.</p>
</div>
<div class="paragraph">
<p>All services are stateless. This means that you can easily run Flowable on multiple nodes in a cluster, each going to the same database, without having to worry about which machine actually executed previous calls. Any call to any service is idempotent regardless of where it is executed.</p>
</div>
<div class="paragraph">
<p>The <strong>CmmnRepositoryService</strong> is probably the first service needed when working with the Flowable CMMN engine. This service offers operations for managing and manipulating <code>deployments</code> and <code>case definitions</code>. Without going into much detail here, a case definition is a Java counterpart of the CMMN 1.1 case. It is a representation of the structure and behavior of each of the steps of a case. A <code>deployment</code> is the unit of packaging within the Flowable CMMN engine. A deployment can contain multiple CMMN 1.1 XML files and any other resource. The choice of what is included in one deployment is up to the developer. It can range from a single process CMMN 1.1 XML file to a whole package of cases and relevant resources (for example, the deployment <em>hr-cases</em> could contain everything related to HR cases). The <code>CmmnRepositoryService</code> can <code>deploy</code> such packages. Deploying a deployment means it is uploaded to the engine, where all cases are inspected and parsed before being stored in the database. From that point on, the deployment is known to the system and any process included in the deployment can now be started.</p>
</div>
<div class="paragraph">
<p>Furthermore, this service allows you to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Query on deployments and case definitions known to the engine.</p>
</li>
<li>
<p>Retrieve various resources, such as files contained within the deployment or case diagrams that were auto-generated by the engine.</p>
</li>
<li>
<p>Retrieve a POJO version of the case definition, which can be used to introspect the case using Java rather than XML.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While the <code>CmmnRepositoryService</code> is mostly about static information (data that doesn&#8217;t change, or at least not a lot), the <strong>CmmnRuntimeService</strong> is quite the opposite. It deals with starting new case instances of case definitions. As said above, a <code>case definition</code> defines the structure and behavior of the different steps in a case. A case instance is one execution of such a case definition. For each case definition there typically are many instances running at the same time. The <code>CmmnRuntimeService</code> also is the service which is used to retrieve and store <code>case variables</code>. This is data that is specific to the given case instance and can be used by various constructs in the case (for example, a plan transition condition often uses process variables to determine which path is chosen to continue the case). The <code>CmmnRuntimeservice</code> also allows you to query on case instances and plan items. Plan items are a representation of the enabled plan items of CMMN 1.1. Lastly, the <code>CmmnRuntimeService</code> is used whenever a case instance is waiting for an external trigger and the case needs to be continued. A case instance can have various <code>wait states</code> and this service contains various operations to <em>signal</em> to the instance that the external trigger is received and the case instance can be continued.</p>
</div>
<div class="paragraph">
<p>Tasks that need to be performed by human users of the system are core to a CMMN engine such as Flowable. Everything around tasks is grouped in the <strong>CmmnTaskService</strong>, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Querying tasks assigned to users or groups</p>
</li>
<li>
<p>Creating new <em>standalone</em> tasks. These are tasks that are not related to a process instances.</p>
</li>
<li>
<p>Manipulating to which user a task is assigned or which users are in some way involved with the task.</p>
</li>
<li>
<p>Claiming and completing a task. Claiming means that someone decided to be the assignee for the task, meaning that this user will complete the task. Completing means <em>doing the work of the tasks</em>. Typically this is filling in a form of sorts.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>CmmnHistoryService</strong> exposes all historical data gathered by the Flowable CMMN engine. When executing cases, a lot of data can be kept by the engine (this is configurable), such as case instance start times, who did which tasks, how long it took to complete the tasks, which path was followed in each case instance, and so on. This service exposes mainly query  capabilities to access this data.</p>
</div>
<div class="paragraph">
<p>The <strong>CmmnManagementService</strong> gives access to low-level information about the database tables, allows to query for the different types of jobs and to execute them.</p>
</div>
<div class="paragraph">
<p>For more detailed information on the service operations and the engine API, see <a href="http://www.flowable.org/docs/javadocs/index.html">the javadocs</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_exception_strategy">3.2. Exception strategy</h3>
<div class="paragraph">
<p>The base exception in Flowable is the <code>org.flowable.engine.common.api.FlowableException</code>, an unchecked exception. This exception can be thrown at all times by the API, but <em>expected</em> exceptions that happen in specific methods are documented in <a href="http://www.flowable.org/docs/javadocs/index.html"> the javadocs</a>. For example, an extract from <code>CmmnTaskService</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4
5
6</div></td><td class="code"><span></span><span class="tok-cm">/**</span>
<span class="tok-cm"> * Called when the task is successfully executed.</span>
<span class="tok-cm"> * @param taskId the id of the task to complete, cannot be null.</span>
<span class="tok-cm"> * @throws FlowableObjectNotFoundException when no task exists with the given id.</span>
<span class="tok-cm"> */</span>
 <span class="tok-kt">void</span> <span class="tok-nf">complete</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">taskId</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, when an id is passed for which no task exists, an exception will be thrown. Also, since the javadoc <strong>explicitly states that taskId cannot be null, an <code>FlowableIllegalArgumentException</code> will be thrown when <code>null</code> is passed</strong>.</p>
</div>
<div class="paragraph">
<p>Even though we want to avoid a big exception hierarchy, the following subclasses are thrown in specific cases. All other errors that occur during process-execution or API-invocation that don&#8217;t fit into the possible exceptions below, are thrown as regular <code>FlowableExceptions</code>s.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FlowableWrongDbException</code>: Thrown when the Flowable engine discovers a mismatch between the database schema version and the engine version.</p>
</li>
<li>
<p><code>FlowableOptimisticLockingException</code>: Thrown when an optimistic locking occurs in the data store caused by concurrent access of the same data entry.</p>
</li>
<li>
<p><code>FlowableClassLoadingException</code>: Thrown when a class requested to load was not found or when an error occurred while loading it (e.g. JavaDelegates, TaskListeners, &#8230;&#8203;).</p>
</li>
<li>
<p><code>FlowableObjectNotFoundException</code>: Thrown when an object that is requested or actioned does not exist.</p>
</li>
<li>
<p><code>FlowableIllegalArgumentException</code>: An exception indicating that an illegal argument has been supplied in a Flowable API-call, an illegal value was configured in the engine&#8217;s configuration or an illegal value has been supplied or an illegal value is used in a process-definition.</p>
</li>
<li>
<p><code>FlowableTaskAlreadyClaimedException</code>: Thrown when a task is already claimed, when the <code>taskService.claim(&#8230;&#8203;)</code> is called.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="queryAPI">3.3. Query API</h3>
<div class="paragraph">
<p>There are two ways of querying data from the engine: the query API and native queries. The Query API allows you to program completely typesafe queries with a fluent API. You can add various conditions to your queries (all of which are applied together as a logical AND) and precisely one ordering. The following code shows an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2
3
4</div></td><td class="code"><span></span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Task</span><span class="tok-o">&gt;</span> <span class="tok-n">tasks</span> <span class="tok-o">=</span> <span class="tok-n">taskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">taskAssignee</span><span class="tok-o">(</span><span class="tok-s">&quot;kermit&quot;</span><span class="tok-o">)</span>
    <span class="tok-o">.</span><span class="tok-na">orderByDueDate</span><span class="tok-o">().</span><span class="tok-na">asc</span><span class="tok-o">()</span>
    <span class="tok-o">.</span><span class="tok-na">list</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiVariables">3.4. Variables</h3>
<div class="paragraph">
<p>Every case instance needs and uses data to execute the steps it&#8217;s made up of. In Flowable, this data is called <em>variables</em>, which are stored in the database. Variables can be used in expressions (for example, in the condition of a sentry), in Java service tasks when calling external services (for example to provide the input or store the result of the service call), and so on.</p>
</div>
<div class="paragraph">
<p>A case instance can have variables (called <em>case variables</em>), but also <em>plan item instances</em> and human tasks can have variables. A case instance can have any number of variables. Each variable is stored in a row in the <em>ACT_RU_VARIABLE</em> database table.</p>
</div>
<div class="paragraph">
<p>The <em>createCaseInstanceBuilder</em> method has optional methods to provide the variables when the case instance is created and started through the <em>CmmnRuntimeService</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">().</span><span class="tok-na">variable</span><span class="tok-o">(</span><span class="tok-s">&quot;var1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test&quot;</span><span class="tok-o">).</span><span class="tok-na">start</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables can be added during case execution. For example, (<em>CmmnRuntimeService</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-kt">void</span> <span class="tok-nf">setVariables</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">caseInstanceId</span><span class="tok-o">,</span> <span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-o">?</span> <span class="tok-kd">extends</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">variables</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables can also be retrieved, as shown below. Note that similar methods exist on the <em>CmmnTaskService</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1
2</div></td><td class="code"><span></span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">,</span> <span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-nf">getVariables</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">caseInstanceId</span><span class="tok-o">);</span>
<span class="tok-n">Object</span> <span class="tok-nf">getVariable</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">caseInstanceId</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">variableName</span><span class="tok-o">);</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Variables are often used in Java service tasks, expressions, scripts, and so on.</p>
</div>
</div>
<div class="sect2">
<h3 id="apiTransientVariables">3.5. Transient variables</h3>
<div class="paragraph">
<p>Transient variables are variables that behave like regular variables, but are not persisted. Typically, transient variables are used for advanced use cases.  When in doubt, use a regular case variable.</p>
</div>
<div class="paragraph">
<p>The following applies for transient variables:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is no history stored at all for transient variables.</p>
</li>
<li>
<p>Like <em>regular</em> variables, transient variables are put on the <em>highest parent</em> when set. This means that when setting a variable on an plan item, the transient variable is actually stored on the case instance execution. Like regular variables, a <em>local</em> variant of the method exists if the variable is set on the specific plan item or task.</p>
</li>
<li>
<p>A transient variable can only be accessed before the next <em>wait state</em> in the case definition. After that, they are gone. Here, the wait state means the point in the case instance where it is persisted to the data store.</p>
</li>
<li>
<p>Transient variables can only be set by the <em>setTransientVariable(name, value)</em>, but transient variables are also returned when calling <em>getVariable(name)</em> (a <em>getTransientVariable(name)</em> also exists, that only checks the transient variables). The reason for this is to make the writing of expressions easy and existing logic using variables works for both types.</p>
</li>
<li>
<p>A transient variable <em>shadows</em> a persistent variable with the same name. This means that when both a persistent and transient variable is set on a case instance and <em>getVariable("someVariable")</em> is called, the transient variable value will be returned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can set and get transient variables in most places where regular variables are exposed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On <em>DelegatePlanItemInstance</em> in <em>PlanItemJavaDelegate</em> implementations</p>
</li>
<li>
<p>When starting a case instance through the runtime service</p>
</li>
<li>
<p>When completing a task</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The methods follow the naming convention of the regular case variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv">1</div></td><td class="code"><span></span><span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">runtimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">().</span><span class="tok-na">transientVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;var1&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;test&quot;</span><span class="tok-o">).</span><span class="tok-na">start</span><span class="tok-o">();</span>
</td></tr></table></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="apiExpressions">3.6. Expressions</h3>
<div class="paragraph">
<p>Flowable uses UEL for expression-resolving. UEL stands for <em>Unified Expression Language</em> and is part of the EE6 specification (see <a href="http://docs.oracle.com/javaee/6/tutorial/doc/gjddd.html"> the EE6 specification</a> for detailed information).</p>
</div>
<div class="paragraph">
<p>Expressions can be used in, for example, Java Service tasks, and plan item transitions. Although there are two types of expressions, value-expression and method-expression, Flowable abstracts this so they can both be used where an <code>expression</code> is expected.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Value expression</strong>: resolves to a value. By default, all case variables are available to use. Also, all spring-beans (if using Spring) are available to use in expressions. Some examples:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${myVar}
${myBean.myProperty}</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Method expression</strong>: invokes a method with or without parameters. <strong>When invoking a method without parameters, be sure to add empty parentheses after the method-name (as this distinguishes the expression from a value expression).</strong> The passed parameters can be literal values or expressions that are resolved themselves. Examples:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>${printer.print()}
${myBean.addNewOrder('orderName')}
${myBean.doSomething(myVar, planItemInstance)}</pre>
</div>
</div>
<div class="paragraph">
<p>Note that these expressions support resolving primitives (including comparing them), beans, lists, arrays and maps.</p>
</div>
<div class="paragraph">
<p>On top of all process variables, there are a few default objects available that can be used in expressions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>caseInstance</code>: The <code>DelegateCaseInstance</code> holds additional information about the ongoing case instance.</p>
</li>
<li>
<p><code>planItemInstance</code>: The <code>DelegatePlanItemInstance</code> holds additional information about the current plan item.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cmmnExpressionsFunctions">3.7. Expression functions</h3>
<div class="paragraph">
<p>[Experimental] Expression functions have been added in version 6.4.0.</p>
</div>
<div class="paragraph">
<p>To make working with case variables easier, a set of out-of-the-box functions is available, under the <em>variables</em> namespace.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>variables:get(varName)</strong>: Retrieves the value of a variable. The main difference with writing the variable name directly in the expression is that using this function won&#8217;t throw an exception when the variable doesn&#8217;t exist. For example <em>${myVariable == "hello"}</em> would throw an exception if <em>myVariable</em> doesn&#8217;t exist, but <em>${var:get(myVariable) == <em>hello</em>}</em> will just work.</p>
</li>
<li>
<p><strong>variables:getOrDefault(varName, defaultValue)</strong>: similar to <em>get</em>, but with the option of providing a default value which is returned when the variable isn&#8217;t set or the value is <em>null</em>.</p>
</li>
<li>
<p><strong>variables:exists(varName)</strong>: Returns <em>true</em> if the variable has a non-null value.</p>
</li>
<li>
<p><strong>variables:isEmpty(varName)</strong> (alias <em>:empty</em>) : Checks if the variable value is not empty. Depending on the variable type, the behavior is the following:</p>
<div class="ulist">
<ul>
<li>
<p>For String variables, the variable is deemed empty if it&#8217;s the empty string.</p>
</li>
<li>
<p>For <code>java.util.Collection</code> variables, <em>true</em> is returned if the collection has no elements.</p>
</li>
<li>
<p>For <code>ArrayNode</code> variables, <em>true</em> is returned if there are no elements</p>
</li>
<li>
<p>In case the variable is <em>null</em>, <em>true</em> is always returned</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>variables:isNotEmpty(varName)</strong> (alias <em>:notEmpty</em>) : the reverse operation of <em>isEmpty</em>.</p>
</li>
<li>
<p><strong>variables:equals(varName, value)</strong> (alias <em>:eq</em>) : checks if a variable is equal to a given value. This is a shorthand function for an expression that would otherwise be written as <em>${execution.getVariable("varName") != null &amp;&amp; execution.getVariable("varName") == value}</em>.</p>
<div class="ulist">
<ul>
<li>
<p>If the variable value is null, false is returned (unless compared to null).</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>variables:notEquals(varName, value)</strong> (alias <em>:ne</em>) : the reverse comparison of <em>equals</em>.</p>
</li>
<li>
<p><strong>variables:contains(varName, value1, value2, &#8230;&#8203;)</strong>: checks if <strong>all</strong> values provided are contained within a variable. Depending on the variable type, the behavior is the following:</p>
<div class="ulist">
<ul>
<li>
<p>For String variables, the passed values are used as substrings that need to be part of the variable</p>
</li>
<li>
<p>For <code>java.util.Collection</code> variables, all the passed values need to be an element of the collection (regular <em>contains</em> semantics).</p>
</li>
<li>
<p>For <code>ArrayNode</code> variables: supports checking if the arraynode contains a JsonNode for the types that are supported as variable type</p>
</li>
<li>
<p>When the variable value is null, false is returned in all cases. When the variale value is not null, and the instance type is not one of the types above, false will be returned.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>variables:containsAny(varName, value1, value2, &#8230;&#8203;)</strong> : similar to the <em>contains</em> function, but <em>true</em> will be returned if <strong>any</strong> (and not all) the passed values is contained in the variable.</p>
</li>
<li>
<p>Comparator functions:</p>
<div class="ulist">
<ul>
<li>
<p><strong>variables:lowerThan(varName, value)</strong> (alias <em>:lessThan</em> or <em>:lt</em>) : shorthand for <em>${execution.getVariable("varName") != null &amp;&amp; execution.getVariable("varName") &lt; value}</em></p>
</li>
<li>
<p><strong>variables:lowerThanOrEquals(varName, value)</strong> (alias <em>:lessThanOrEquals</em> or <em>:lte</em>) : similar, but now for <em>&lt; =</em></p>
</li>
<li>
<p><strong>variables:greaterThan(varName, value)</strong> (alias <em>:gt</em>) : similar, but now for <em>&gt;</em></p>
</li>
<li>
<p><strong>variables:greaterThanOrEquals(varName, value)</strong> (alias <em>:gte</em>) : similar, but now for <em>&gt; =</em></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <em>variables</em> namespace is aliased to <em>vars</em> or <em>var</em>. So <em>variables:get(varName)</em> is equivalent to writing <em>vars:get(varName)</em> or <em>var:get(varName)</em>. Note that it&#8217;s not needed to put quotes around the variable name: <em>var:get(varName)</em> is equivalent to <em>var:get('varName')</em> or <em>var:get("varName")</em>.</p>
</div>
<div class="paragraph">
<p>Also note that in none of the functions above the <em>planItemInstance</em> or <em>caseInstance</em> needs to be passed into the function (as would be needed when not using a function). The engine will inject the appropiate variable scope when invoking the function. This also means that these functions can be used in exactly the same way when writing expression in BPMN process definitions.</p>
</div>
<div class="paragraph">
<p>The use of these variable functions is especially useful in CMMN, for example when it comes to writing the condition of an if-part of sentry. Take the following CMMN case definition:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="images/cmmn.expression-functions.png" alt="cmmn.expression functions">
</div>
</div>
<div class="paragraph">
<p>Assume the sentry has an if-part besides the completion event. Right after a case instance is started, this if-part condition will be evaluated (as the stage becomes available). If the condition is of the form <em>${someVariable == someValue}</em>, this means the variable needs to be available when starting the case instance. In many cases, this is not possible or the variable comes later (e.g. from a form), which leads to a low-level <em>PropertyNotFoundException</em>. Taking the potential nullability in account, the correct expression would have to be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>${planItemInstance.getVariable('someVariable') != null &amp;&amp; planItemInstance.getVariable('someVariable') == someValue}</pre>
</div>
</div>
<div class="paragraph">
<p>Which is quite long. Using the functions above however, this can be simplified to</p>
</div>
<div class="listingblock">
<div class="content">
<pre>${var:eq(someVariable, someValue)}</pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre>${var:get(someVariable) == someValue}</pre>
</div>
</div>
<div class="paragraph">
<p>The function implementations take in account the nullability of the variable (and not throw and exception in case the variable is null) and will handle the equality correctly.</p>
</div>
<div class="paragraph">
<p>Additionally, it&#8217;s possible to register custom functions that can be used in expressions. See the <code>org.flowable.common.engine.api.delegate.FlowableFunctionDelegate</code> interface for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="apiUnitTesting">3.8. Unit testing</h3>
<div class="paragraph">
<p>Cases are an integral part of software projects and they should be tested in the same way normal application logic is tested: with unit tests.
Since Flowable is an embeddable Java engine, writing unit tests for business cases is as simple as writing regular unit tests.</p>
</div>
<div class="paragraph">
<p>Flowable supports JUnit versions 4 and 5 styles of unit testing.</p>
</div>
<div class="paragraph">
<p>In the JUnit 5 style one needs to use the <code>org.flowable.cmmn.engine.test.FlowableCmmnTest</code> annotation or register the <code>org.flowable.cmmn.engine.test.FlowableCmmnExtension</code> manually.
The <code>FlowableCmmnTest</code> annotation is just a meta annotation and the does the registration of the <code>FlowableCmmnExtension</code> (i.e. it does <code>@ExtendWith(FlowableCmmnExtension.class)</code>).
This will make the CmmnEngine and the services available as parameters into the test and lifecycle methods (<code>@BeforeAll</code>, <code>@BeforeEach</code>, <code>@AfterEach</code>, <code>@AfterAll</code>).
Before each test the cmmnEngine will be initialized by default with the <code>flowable.cmmn.cfg.xml</code> resource on the classpath.
In order to specify a different configuration file the <code>org.flowable.cmmn.engine.test.CmmnConfigurationResource</code> annotation needs to be used (see second example).
Cmmn engines are cached statically over multiple unit tests when the configuration resource is the same.</p>
</div>
<div class="paragraph">
<p>By using <code>FlowableCmmnExtension</code>, you can annotate test methods with <code>org.flowable.cmmn.engine.test.CmmnDeployment</code>.
When a test method is annotated with <code>@CmmnDeployment</code>, before each test the cmmn files defined in <code>CmmnDeployment#resources</code> will be deployed.
In case there are no resources defined, a resource file of the form <code>testClassName.testMethod.cmmn</code> in the same package as the test class, will be deployed.
At the end of the test, the deployment will be deleted, including all related case instances, tasks, and so on.
See the <code>CmmnDeployment</code> class for more information.</p>
</div>
<div class="paragraph">
<p>Taking all that in account, a JUnit 5 test looks as follows:</p>
</div>
<div class="listingblock">
<div class="title">Junit 5 test with default resource</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</div></td><td class="code"><span></span><span class="tok-nd">@FlowableCmmnTest</span>
<span class="tok-kd">class</span> <span class="tok-nc">MyTest</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">CmmnRuntimeService</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">CmmnTaskService</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">;</span>

  <span class="tok-nd">@BeforeEach</span>
  <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">(</span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">;</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">cmmnRuntimeService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRuntimeService</span><span class="tok-o">();</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">cmmnTaskService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getTaskRuntimeService</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>

  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@CmmnDeployment</span>
  <span class="tok-kt">void</span> <span class="tok-nf">testSingleHumanTask</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">()</span>
                    <span class="tok-o">.</span><span class="tok-na">caseDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myCase&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
	<span class="tok-n">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">);</span>

    <span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">()).</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Task 1&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;JohnDoe&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getAssignee</span><span class="tok-o">());</span>

    <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>With JUnit 5 you can also inject the id of the deployment (with +org.flowable.cmmn.engine.test.CmmnDeploymentId+_) into your test and lifecycle methods.</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Junit 5 test with custom resource</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><table class="pyhltable"><tr><td class="linenos"><div class="linenodiv"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</div></td><td class="code"><span></span><span class="tok-nd">@FlowableCmmnTest</span>
<span class="tok-nd">@CmmnConfigurationResource</span><span class="tok-o">(</span><span class="tok-s">&quot;flowable.custom.cmmn.cfg.xml&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">class</span> <span class="tok-nc">MyTest</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">CmmnRuntimeService</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">CmmnTaskService</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">;</span>

  <span class="tok-nd">@BeforeEach</span>
  <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">(</span><span class="tok-n">CmmnEngine</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">cmmnEngine</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">;</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">cmmnRuntimeService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getCmmnRuntimeService</span><span class="tok-o">();</span>
    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">cmmnTaskService</span> <span class="tok-o">=</span> <span class="tok-n">cmmnEngine</span><span class="tok-o">.</span><span class="tok-na">getTaskRuntimeService</span><span class="tok-o">();</span>
  <span class="tok-o">}</span>
  <span class="tok-nd">@Test</span>
  <span class="tok-nd">@CmmnDeployment</span>
  <span class="tok-kt">void</span> <span class="tok-nf">testSingleHumanTask</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">CaseInstance</span> <span class="tok-n">caseInstance</span> <span class="tok-o">=</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceBuilder</span><span class="tok-o">()</span>
                    <span class="tok-o">.</span><span class="tok-na">caseDefinitionKey</span><span class="tok-o">(</span><span class="tok-s">&quot;myCase&quot;</span><span class="tok-o">)</span>
                    <span class="tok-o">.</span><span class="tok-na">start</span><span class="tok-o">();</span>
	<span class="tok-n">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">);</span>

    <span class="tok-n">Task</span> <span class="tok-n">task</span> <span class="tok-o">=</span> <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">createTaskQuery</span><span class="tok-o">().</span><span class="tok-na">caseInstanceId</span><span class="tok-o">(</span><span class="tok-n">caseInstance</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">()).</span><span class="tok-na">singleResult</span><span class="tok-o">();</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;Task 1&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;JohnDoe&quot;</span><span class="tok-o">,</span> <span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getAssignee</span><span class="tok-o">());</span>

    <span class="tok-n">cmmnTaskService</span><span class="tok-o">.</span><span class="tok-na">complete</span><span class="tok-o">(</span><span class="tok-n">task</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">());</span>
    <span class="tok-n">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-n">cmmnRuntimeService</span><span class="tok-o">.</span><span class="tok-na">createCaseInstanceQuery</span><span class="tok-o">().</span><span class="tok-na">count</span><span class="tok-o">());</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-n">In</span> <span class="tok-n">the</span> <span class="tok-n">JUnit</span> <span class="tok-mi">4</span> <span class="tok-n">style</span><span class="tok-o">,</span> <span class="tok-n">the</span> <span class="tok-n">_org</span><span class="tok-o">.</span><span class="tok-na">flowable</span><span class="tok-o">.</span><span class="tok-na">cmmn</span><span class="tok-o">.</span><span class="tok-na">engine</span><span class="tok-o">.</span><span class="tok-na">test</span><span class="tok-o">.</span><span class="tok-na">FlowableCmmnTestCase_</span> <span class="tok-n">is</span> <span class="tok-n">available</span> <span class="tok-n">as</span> <span class="tok-n">parent</span> <span class="tok-n">class</span><span class="tok-o">.</span> <span class="tok-n">It</span> <span class="tok-n">uses</span> <span class="tok-n">a</span> <span class="tok-n">configuration</span> <span class="tok-n">file</span> <span class="tok-n">_flowable</span><span class="tok-o">.</span><span class="tok-na">cmmn</span><span class="tok-o">.</span><span class="tok-na">cfg</span><span class="tok-o">.</span><span class="tok-na">xml_</span> <span class="tok-n">by</span> <span class="tok-k">default</span> <span class="tok-n">or</span> <span class="tok-n">uses</span> <span class="tok-n">a</span> <span class="tok-n">standard</span> <span class="tok-n">CmmnEngine</span> <span class="tok-n">using</span> <span class="tok-n">an</span> <span class="tok-n">H2</span> <span class="tok-n">in</span><span class="tok-o">-</span><span class="tok-n">memory</span> <span class="tok-n">database</span> <span class="tok-k">if</span> <span class="tok-n">such</span> <span class="tok-n">file</span> <span class="tok-n">is</span> <span class="tok-n">missing</span><span class="tok-o">.</span>
<span class="tok-n">Behind</span> <span class="tok-n">the</span> <span class="tok-n">scenes</span><span class="tok-o">,</span> <span class="tok-n">a</span> <span class="tok-n">CmmnTestRunner</span> <span class="tok-n">is</span> <span class="tok-n">used</span> <span class="tok-n">to</span> <span class="tok-n">initialise</span> <span class="tok-n">the</span> <span class="tok-n">CMMN</span> <span class="tok-n">engine</span><span class="tok-o">.</span> <span class="tok-n">Note</span> <span class="tok-n">in</span> <span class="tok-n">the</span> <span class="tok-n">example</span> <span class="tok-n">below</span> <span class="tok-n">how</span> <span class="tok-n">the</span> <span class="tok-n">_</span><span class="tok-nd">@CmmnDeployment_</span> <span class="tok-n">annotation</span> <span class="tok-n">is</span> <span class="tok-n">used</span> <span class="tok-n">to</span> <span class="tok-n">automatically</span> <span class="tok-n">deploy</span> <span class="tok-n">the</span> <span class="tok-k">case</span> <span class="tok-nf">definition</span> <span class="tok-o">(</span><span class="tok-n">it</span> <span class="tok-n">will</span> <span class="tok-n">look</span> <span class="tok-k">for</span> <span class="tok-n">a</span> <span class="tok-o">.</span><span class="tok-na">cmmn</span> <span class="tok-n">file</span> <span class="tok-n">in</span> <span class="tok-n">the</span> <span class="tok-n">same</span> <span class="tok-n">folder</span> <span class="tok-n">as</span> <span class="tok-n">the</span> <span class="tok-n">test</span> <span class="tok-kd">class</span> <span class="tok-nc">and</span> <span class="tok-n">expects</span> <span class="tok-n">the</span> <span class="tok-n">file</span> <span class="tok-n">to</span> <span class="tok-n">be</span> <span class="tok-n">named</span> <span class="tok-o">&lt;</span><span class="tok-n">Test</span> <span class="tok-kd">class</span> <span class="tok-nc">name</span><span class="tok-o">&gt;.&lt;</span><span class="tok-n">test</span> <span class="tok-n">method</span> <span class="tok-n">name</span><span class="tok-o">&gt;.</span><span class="tok-na">cmmn</span><span class="tok-o">.</span>

<span class="tok-o">[</span><span class="tok-n">source</span><span class="tok-o">,</span><span class="tok-n">java</span><span class="tok-o">,</span><span class="tok-n">linenums</span><span class="tok-o">]</span>
</td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>public class MyTest extends FlowableCmmnTestCase {</p>
</div>
<div class="literalblock">
<div class="content">
<pre> @Test
 @CmmnDeployment
 public void testSingleHumanTask() {
   CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()
                   .caseDefinitionKey("myCase")
                   .start();
assertNotNull(caseInstance);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Task task = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).singleResult();
assertEquals("Task 1", task.getName());
assertEquals("JohnDoe", task.getAssignee());</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    cmmnTaskService.complete(task.getId());
    assertEquals(0, cmmnRuntimeService.createCaseInstanceQuery().count());
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Alternatively, the _FlowableCmmnRule_ is available and allows to set a custom configuration:

.JUnit 4 test with a Rule
[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>@Rule
public FlowableCmmnRule cmmnRule = new FlowableCmmnRule("org/flowable/custom.cfg.xml")</p>
</div>
<div class="paragraph">
<p>@Test
@CmmnDeployment
public void testSomething() {
    // &#8230;&#8203;
    assertThatString) cmmnRule.getCmmnRuntimeService().getVariable(caseInstance.getId(), "test"), containsString("John";
    // &#8230;&#8203;
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[[springintegration]]

== Spring integration

While you can definitely use Flowable without Spring, we've provided some very nice integration features that are explained in this chapter.

=== CmmnEngineFactoryBean

The +CmmnEngine+ can be configured as a regular Spring bean. The starting point of the integration is the class +org.flowable.cmmn.spring.CmmnEngineFactoryBean+. That bean takes a CMMN engine configuration and creates the CMMN engine.  This means that the creation and configuration of properties for Spring is the same as documented in the &lt;&lt;configuration,configuration section&gt;&gt;. For Spring integration, the configuration and engine beans will look like this:

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="cmmnEngineConfiguration" class="org.flowable.cmmn.spring.SpringCmmnEngineConfiguration"&gt;
    &#8230;&#8203;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="cmmnEngine" class="org.flowable.cmmn.spring.CmmnEngineFactoryBean"&gt;
  &lt;property name="cmmnEngineConfiguration" ref="cmmnEngineConfiguration" /&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Note that the +cmmnEngineConfiguration+ bean now uses the +org.flowable.cmmn.spring.SpringCmmnEngineConfiguration+ class.


=== Default Spring configuration

The section shown below contains the dataSource, transactionManager, cmmnEngine and the Flowable engine services.

When passing the DataSource to the +SpringCmmnEngineConfiguration+ (using property "dataSource"), Flowable uses a +org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy+ internally, which wraps the passed DataSource. This is done to make sure the SQL connections retrieved from the DataSource and the Spring transactions play well together. This implies that it's no longer necessary to proxy the dataSource yourself in Spring configuration, although it's still possible to pass a +TransactionAwareDataSourceProxy+ into the +SpringCmmnEngineConfiguration+. In this case, no additional wrapping will occur.

*Make sure when declaring a +TransactionAwareDataSourceProxy+ in Spring configuration yourself that you don't use it for resources that are already aware of Spring transactions (e.g. DataSourceTransactionManager need the un-proxied dataSource).*

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                             <a href="http://www.springframework.org/schema/beans/spring-beans.xsd" class="bare">http://www.springframework.org/schema/beans/spring-beans.xsd</a>
                           <a href="http://www.springframework.org/schema/context" class="bare">http://www.springframework.org/schema/context</a>
                             <a href="http://www.springframework.org/schema/context/spring-context-2.5.xsd" class="bare">http://www.springframework.org/schema/context/spring-context-2.5.xsd</a>
                           <a href="http://www.springframework.org/schema/tx" class="bare">http://www.springframework.org/schema/tx</a>
                             <a href="http://www.springframework.org/schema/tx/spring-tx-3.0.xsd"&gt" class="bare">http://www.springframework.org/schema/tx/spring-tx-3.0.xsd"&gt</a>;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="dataSource" class="org.springframework.jdbc.datasource.SimpleDriverDataSource"&gt;
  &lt;property name="driverClass" value="org.h2.Driver" /&gt;
  &lt;property name="url" value="jdbc:h2:mem:flowable;DB_CLOSE_DELAY=1000" /&gt;
  &lt;property name="username" value="sa" /&gt;
  &lt;property name="password" value="" /&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"&gt;
  &lt;property name="dataSource" ref="dataSource" /&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="cmmnEngineConfiguration" class="org.flowable.cmmn.spring.SpringCmmnEngineConfiguration"&gt;
  &lt;property name="dataSource" ref="dataSource" /&gt;
  &lt;property name="transactionManager" ref="transactionManager" /&gt;
  &lt;property name="databaseSchemaUpdate" value="true" /&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="cmmnEngine" class="org.flowable.cmmn.spring.CmmnEngineFactoryBean"&gt;
  &lt;property name="cmmnEngineConfiguration" ref="cmmnEngineConfiguration" /&gt;
&lt;/bean&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="cmmnRepositoryService" factory-bean="cmmnEngine" factory-method="getCmmnRepositoryService" /&gt;
&lt;bean id="cmmnRuntimeService" factory-bean="cmmnEngine" factory-method="getCmmnRuntimeService" /&gt;
&lt;bean id="cmmnTaskService" factory-bean="cmmnEngine" factory-method="getCmmnTaskService" /&gt;
&lt;bean id="cmmnHistoryService" factory-bean="cmmnEngine" factory-method="getCmmnHistoryService" /&gt;
&lt;bean id="cmmnManagementService" factory-bean="cmmnEngine" factory-method="getCmmnManagementService" /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>First, the application context is created using any of the ways supported by Spring. In this example, you could use a classpath XML resource to configure our Spring application context:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext(
	"org/flowable/cmmn/examples/spring/SpringIntegrationTest-context.xml");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>or, as it's a test:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>@ContextConfiguration(
  "classpath:org/flowable/cmmn/spring/test/SpringIntegrationTest-context.xml")</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[[springExpressions]]


=== Expressions

When using the CmmnEngineFactoryBean, all expressions in the CMMN processes will also 'see' all the Spring beans, by default. It's possible to limit the beans (even none) you want to expose in expressions using a map that you can configure.  The example below exposes a single bean (printer), available to use under the key "printer".  *To have NO beans exposed at all, just pass an empty list as 'beans' property on the SpringCmmnEngineConfiguration. When no 'beans' property is set, all Spring beans in the context will be available.*

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="cmmnEngineConfiguration" class="org.flowable.cmmn.spring.SpringCmmnEngineConfiguration"&gt;
  &#8230;&#8203;
  &lt;property name="beans"&gt;
    &lt;map&gt;
      &lt;entry key="printer" value-ref="printer" /&gt;
    &lt;/map&gt;
  &lt;/property&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="printer" class="org.flowable.cmmn.examples.spring.Printer" /&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Now the exposed beans can be used in expressions:


[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;
	&lt;case id="myCase"&gt;
        &lt;casePlanModel id="myPlanModel" name="My CasePlanModel"&gt;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;planItem id="planItem1" name="Task One" definitionRef="serviceTask" /&gt;
&lt;planItem id="planItem2" name="The Case" definitionRef="task"&gt;
    &lt;entryCriterion sentryRef="sentry1" /&gt;
&lt;/planItem&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;sentry id="sentry1"&gt;
    &lt;planItemOnPart sourceRef="planItem1"&gt;
        &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
    &lt;/planItemOnPart&gt;
&lt;/sentry&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;task id="serviceTask" flowable:type="java" flowable:expression="${printer.printMessage(var1)}" flowable:resultVariableName="customResponse" /&gt;
&lt;task id="task" name="The Task" isBlocking="true" /&gt;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    &lt;/casePlanModel&gt;
&lt;/case&gt;</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>Where +Printer+ looks like this:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>public class Printer {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  public void printMessage(String var) {
    System.out.println("hello " + var);
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>And the Spring bean configuration (also shown above) looks like this:

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;beans&gt;
  &#8230;&#8203;</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;bean id="printer" class="org.flowable.cmmn.examples.spring.Printer" /&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;/beans&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>=== Automatic resource deployment

Spring integration also has a special feature for deploying resources.  In the CMMN engine configuration, you can specify a set of resources. When the CMMN engine is created, all those resources will be scanned and deployed.  There is filtering in place that prevents duplicate deployments.  Only when the resources have actually changed will new deployments be deployed to the Flowable DB. This makes sense in a lot of use cases, where the Spring container is rebooted frequently (for example, testing).

Here's an example:

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="cmmnEngineConfiguration" class="org.flowable.cmmn.spring.SpringCmmnEngineConfiguration"&gt;
  &#8230;&#8203;
  &lt;property name="deploymentResources"
    value="classpath*:/org/flowable/cmmn/spring/test/autodeployment/autodeploy.*.cmmn" /&gt;
&lt;/bean&gt;</p>
</div>
<div class="paragraph">
<p>&lt;bean id="cmmnEngine" class="org.flowable.cmmn.spring.CmmnEngineFactoryBean"&gt;
  &lt;property name="cmmnEngineConfiguration" ref="cmmnEngineConfiguration" /&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>By default, the configuration above will group all of the resources matching the filter into a single deployment to the Flowable engine. The duplicate filtering to prevent re-deployment of unchanged resources applies to the whole deployment. In some cases, this may not be what you want. For instance, if you deploy a set of process resources this way and only a single case definition in those resources has changed, the deployment as a whole will be considered new and all of the case definitions in that deployment will be re-deployed, resulting in new  versions of each of the case definitions, even though only one was actually changed.

To be able to customize the way deployments are determined, you can specify an additional property in the +SpringCmmnEngineConfiguration+, +deploymentMode+. This property defines the way deployments will be determined from the set of resources that match the filter. There are 3 values that are supported by default for this property:

* ++default++: Group all resources into a single deployment and apply duplicate filtering to that deployment. This is the default value and it will be used if you don't specify a value.
* ++single-resource++: Create a separate deployment for each individual resource and apply duplicate filtering to that deployment. This is the value you would use to have each process definition be deployed separately and only create a new case definition version if it has changed.
* ++resource-parent-folder++: Create a separate deployment for resources that share the same parent folder and apply duplicate filtering to that deployment. This value can be used to create separate deployments for most resources, but still be able to group some by placing them in a shared folder. Here's an example of how to specify the +single-resource+ configuration for ++deploymentMode++:


[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;bean id="cmmnEngineConfiguration"
    class="org.flowable.cmmn.spring.SpringCmmnEngineConfiguration"&gt;
  &#8230;&#8203;
  &lt;property name="deploymentResources" value="classpath*:/flowable/*.cmmn" /&gt;
  &lt;property name="deploymentMode" value="single-resource" /&gt;
&lt;/bean&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>In addition to using the values listed above for +deploymentMode+, you may require customized behavior towards determining deployments. If so, you can create a subclass of +SpringCmmnEngineConfiguration+ and override the +getAutoDeploymentStrategy(String deploymentMode)+ method.  This method determines which deployment strategy is used for a certain value of the +deploymentMode+ configuration.


[[springUnitTest]]


=== Unit testing

When integrating with Spring, business cases can be tested very easily using the standard standard &lt;&lt;apiUnitTesting,Flowable testing facilities&gt;&gt;.
The following examples show how a case definition is tested in typical Spring-based JUnit 4 and 5 test:

.JUnit 5 test
[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>@ExtendWith(FlowableCmmnSpringExtension.class)
@ExtendWith(SpringExtension.class)
@ContextConfiguration(classes = CmmnSpringJunitJupiterTest.TestConfiguration.class)
class MyBusinessCaseTest {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
private CmmnRepositorySerivce cmmnRepositoryService;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Autowired
privae CmmnRuntimeSerivce cmmnRuntimeService;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Test
@CmmnDeployment
public void simpleCaseTest() {
  CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()
  		.caseDefinitionKey("simpleCase")
          .variable("var1", "John Doe")
          .start();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>	Assertions.assertNotNull(caseInstance);
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>.JUnit 4 test
[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>public class MyBusinessCaseTest {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Rule
public FlowableCmmnRule cmmnRule = new FlowableCmmnRule("org/flowable/spring/test/el/SpringBeanTest-context.xml");</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@Test
public void simpleCaseTest() {
  cmmnRule.getCmmnRepositoryService().createDeployment().addClasspathResource("org/flowable/spring/test/el/springExpression.cmmn").deploy();
  CmmnRuntimeService cmmnRuntimeService = cmmnRule.getCmmnRuntimeService();
  CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()
  		.caseDefinitionKey("myCase")
          .variable("var1", "John Doe")
          .start();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>	Assert.assertNotNull(caseInstance);
  }
}</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>[[chDeployment]]

== Deployment

=== External resources

Case definitions live in the Flowable database. These case definitions can reference delegation classes when using Service Tasks or Spring beans from the Flowable configuration file. These classes and the Spring configuration file have to be available to all CMMN engines that may execute the case definitions.

==== Java classes

All custom classes that are used in your case definition (for example, PlanItemJavaDelegates used in Service Tasks) should be present on the engine's classpath when an instance of the case is started.

During deployment of a case definition however, those classes don't have to be present on the classpath. This means that your delegation classes don't have to be on the classpath when deploying a new case definition, for example.

When you are using the demo setup and you want to add your custom classes, you should add a JAR containing your classes to the flowable-task or flowable-rest webapp lib. Don't forget to include the dependencies of your custom classes (if any) as well. Alternatively, you can include your dependencies in the libraries directory of your Tomcat installation, +${tomcat.home}/lib+ (or similar place for other web containers).


==== Using Spring beans from a case instance

When expressions or scripts use Spring beans, those beans have to be available to the engine when executing the case definition. If you are building your own webapp and you configure your CMMN engine in your context as described in &lt;&lt;springintegration,the spring integration section&gt;&gt;, that is straightforward. But bear in mind that you also should update the Flowable task and rest webapps with that context if you use it.

[[versioningOfCaseDefinitions]]


=== Versioning of case definitions

CMMN doesn't have a notion of versioning.  That is actually good, because the executable CMMN file will probably live in a version control system repository (such as Subversion, Git or Mercurial) as part of your development project.  However, versions of case definitions are created in the engine as part of deployment. During deployment, Flowable will assign a version to the +CaseDefinition+ before it is stored in the Flowable DB.

For each case definition in a deployment, the following steps are performed to initialize the properties +key+, +version+, +name+ and ++id++:

* The case definition +id+ attribute in the XML file is used as the case definition +key+ property.
* The case definition +name+ attribute in the XML file is used as the case definition +name+ property. If the name attribute is not specified, then the id attribute is used as the name.
* The first time a case with a particular key is deployed, version 1 is assigned.  For all subsequent deployments of case definitions with the same key, the version will be set 1 higher than the highest currently deployed version. The key property is used to distinguish case definitions.

Take for example the following case

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;definitions id="myDefinitions" &gt;
  &lt;case id="myCase" name="My important case" &gt;
    &#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>When deploying this case definition, the case definition in the database will look like this:

[options="header"]
|===============
|id|key|name|version
|676|myCase|My important case|1

|===============

Suppose we now deploy an updated version of the same case (for example, changing some human tasks), but the ++id++ of the case definition remains the same. The case definition table will now contain the following entries:

[options="header"]
|===============
|id|key|name|version
|676|myCase|My important case|1
|870|myCase|My important case|2

|===============

When the ++runtimeService.createCaseInstanceBuilder().caseDefinitionKey("myCase").start()++ is called, it will now use the case definition with version ++2++, as this is the latest version of the case definition.

Should we create a second case, as defined below and deploy this to Flowable, a third row will be added to the table.

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;definitions id="myNewDefinitions" &gt;
  &lt;case id="myNewCase" name="My important case" &gt;
    &#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The table will look like this:

[options="header"]
|===============
|id|key|name|version
|676|myCase|My important case|1
|870|myCase|My important case|2
|1033|myNewCase|My important case|1

|===============

Note how the key for the new case is different from our first case. Even though the name is the same (we should probably have changed that too), Flowable only considers the +id+ attribute when distinguishing cases. The new case is therefore deployed with version 1.


[[deploymentCategory]]


=== Category

Both deployments and case definitions have user-defined categories.  The case definition category is initialized with the value of the targetNamespace attribute in the CMMN XML: +&lt;definitions ... targetNamespace="yourCategory" ...+

The deployment category can also be specified in the API like this:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>repositoryService
    .createDeployment()
    .category("yourCategory")
    &#8230;&#8203;
    .deploy();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>== CMMN 1.1

=== What is CMMN?

The Case Management Model and Notation (CMMN) is a standard notation and formal specification by the link:$$http://www.omg.org/spec/CMMN/$$[Object Management Group] for representing case models.

Flowable contains:

* A CMMN 1.1 modeler to create CMMN 1.1 case models
* A Java engine that can import and execute CMMN 1.1 case models
* A demonstration UI that executes the case models, allowing users to see and complete human tasks (and their forms)

=== Basic concepts and terminology

The following figure shows a simple CMMN 1.1 diagram:

image::images/cmmn-basic-concepts.png[align="center"]

A *case model* is always visualized as some sort of _folder_ that contains all the case elements. Every case model contains a *plan model* onto which items will be _planned_.

The elements of a plan model are called *plan items*. Each _plan item_ has a *plan item definition* that gives its type and possible configuration options at runtime. For example, in the figure above, there are three *human task* plan items and one *milestone*. Other examples of plan items are _process tasks, case tasks and stages_.

After having deployed a case model to the Flowable CMMN engine, it's possible to start *case instances* based on this case model. The plan items defined in the case model similarly have *plan item instance* runtime representations that are exposed by, and can be queried using, the Flowable API. Plan item instances have a state lifecycle that is defined in the CMMN 1.1 specification and is core to how the engine works. Please check out section 8.4.2 of the CMMN 1.1 specification for all the details.

Plan items can have _sentries_: a plan item is said to have _entry criteria_ when a sentry "guards" its activation. These criteria specify conditions that must be satisfied to _trigger the sentry_. For example, in the figure above, the "Milestone One" plan item is _available_ after a case instance is started, but it is _activated_ (in CMMN 1.1 specification terminology: it moves from the _available_ state to the _active_ state) when both human task A and B are completed. Note that sentries can have complex expression in their _if part_, which are not visualized, allowing for much more complex functionality. Also note that there can be multiple sentries, although only one needs to be satisfied to trigger a state transition.

Plan items and the plan model can also have sentries with _exit criteria_, which specify conditions that trigger an _exit_ from that particular plan item. In the figure above, the whole plan model is exited (as are all the child elements that are active at that moment), when human task C completes.

CMMN 1.1 defines a standard XML format in an XSD that is part of the specification. For information, the example in the figure above is represented in XML as shown below.

Some observations:

* The four plan items above are in the XML and they reference their definition with a _definitionRef_. The actual definitions are at the bottom of the _casePlanModel_ element
* The plan items have criteria (entry or exit) that reference a _sentry_ (not the other way around)
* The XML also contains information on how the diagram is visualized (x and y coordinates, widths and heights, and so on), which are omitted below. These elements are important when exchanging case models with other CMMN 1.1 modeling tools to preserve the correct visual representation

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions xmlns="http://www.omg.org/spec/CMMN/20151109/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:flowable="http://flowable.org/cmmn"
             xmlns:cmmndi="http://www.omg.org/spec/CMMN/20151109/CMMNDI"
             xmlns:dc="http://www.omg.org/spec/CMMN/20151109/DC"
             xmlns:di="http://www.omg.org/spec/CMMN/20151109/DI"
             targetNamespace="http://www.flowable.org/casedef"&gt;
  &lt;case id="simpleExample" name="Simple Example"&gt;
    &lt;casePlanModel id="casePlanModel" name="My Case"&gt;
      &lt;planItem id="planItem1" name="Human task A"
            definitionRef="sid-88199E7C-7655-439C-810B-8849FC52D3EB"&gt;&lt;/planItem&gt;
      &lt;planItem id="planItem2" name="Milestone One"
            definitionRef="sid-8BF8A774-A8A7-4F1A-95CF-1E0D61EE5A47"&gt;
        &lt;entryCriterion id="sid-62CC4A6D-B29B-4129-93EA-460253C45CDF"
            sentryRef="sentry1"&gt;&lt;/entryCriterion&gt;
      &lt;/planItem&gt;
      &lt;planItem id="planItem3" name="Human task B"
            definitionRef="sid-A1FB8733-0DBC-4B38-9830-CBC4D0C4B802"&gt;&lt;/planItem&gt;
      &lt;planItem id="planItem4" name="Human task C"
            definitionRef="sid-D3970AFC-7391-4BA7-95BA-51C64D2F41E9"&gt;&lt;/planItem&gt;
      &lt;sentry id="sentry1"&gt;
        &lt;planItemOnPart id="sentryOnPart1" sourceRef="planItem1"&gt;
          &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
        &lt;/planItemOnPart&gt;
        &lt;planItemOnPart id="sentryOnPart2" sourceRef="planItem3"&gt;
          &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
        &lt;/planItemOnPart&gt;
      &lt;/sentry&gt;
      &lt;sentry id="sentry2"&gt;
        &lt;planItemOnPart id="sentryOnPart3" sourceRef="planItem4"&gt;
          &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
        &lt;/planItemOnPart&gt;
      &lt;/sentry&gt;
      &lt;humanTask id="sid-88199E7C-7655-439C-810B-8849FC52D3EB"
        name="Human task A"&gt;&lt;/humanTask&gt;
      &lt;milestone id="sid-8BF8A774-A8A7-4F1A-95CF-1E0D61EE5A47"
        name="Milestone One"&gt;&lt;/milestone&gt;
      &lt;humanTask id="sid-A1FB8733-0DBC-4B38-9830-CBC4D0C4B802"
        name="Human task B"&gt;&lt;/humanTask&gt;
      &lt;humanTask id="sid-D3970AFC-7391-4BA7-95BA-51C64D2F41E9"
        name="Human task C"&gt;&lt;/humanTask&gt;
      &lt;exitCriterion id="sid-422626DB-9B40-49D8-955E-641AB96A5BFA"
        sentryRef="sentry2"&gt;&lt;/exitCriterion&gt;
    &lt;/casePlanModel&gt;
  &lt;/case&gt;
  &lt;cmmndi:CMMNDI&gt;
    &lt;cmmndi:CMMNDiagram id="CMMNDiagram_simpleExample"&gt;
        &#8230;&#8203;
    &lt;/cmmndi:CMMNDiagram&gt;
  &lt;/cmmndi:CMMNDI&gt;
&lt;/definitions&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>=== Programmatic example

In this section we're going to build a simple case model and execute it programmatically through the Java APIs of the Flowable CMMN engine in a simple command line example.

The case model we'll build is a simplified _employee onboarding_ case with two stages: a phase before and phase after the potential employee has started. In the first stage, someone from the HR department will complete the tasks, while in the second stage it is the employee completing them. Also, at any point in time, the potential employee can reject the job and stop the whole case instance.

Note that only stages and human tasks are used. In a real case model, there will most likely other plan item types too, such as milestones, nested stages, automated tasks, and so on.

image::images/cmmn.programmatic.example.png[align="center"]

The XML for this case model is the following:


[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions xmlns="http://www.omg.org/spec/CMMN/20151109/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:flowable="http://flowable.org/cmmn"
             xmlns:cmmndi="http://www.omg.org/spec/CMMN/20151109/CMMNDI"
             xmlns:dc="http://www.omg.org/spec/CMMN/20151109/DC"
             xmlns:di="http://www.omg.org/spec/CMMN/20151109/DI"
             targetNamespace="http://www.flowable.org/casedef"&gt;
  &lt;case id="employeeOnboarding" name="Simple Example"&gt;
    &lt;casePlanModel id="casePlanModel" name="My Case"&gt;
      &lt;planItem id="planItem5" name="Prior to starting"
            definitionRef="sid-025D29E8-BA9B-403D-A684-8C5B52185642"&gt;&lt;/planItem&gt;
      &lt;planItem id="planItem8" name="After starting"
            definitionRef="sid-8459EF32-4F4C-4E9B-A6E9-87FDC2299044"&gt;
        &lt;entryCriterion id="sid-50B5F12D-FE75-4D05-9148-86574EE6C073"
            sentryRef="sentry2"&gt;&lt;/entryCriterion&gt;
      &lt;/planItem&gt;
      &lt;planItem id="planItem9" name="Reject job"
            definitionRef="sid-134E885A-3D58-417E-81E2-66A3E12334F9"&gt;&lt;/planItem&gt;
      &lt;sentry id="sentry2"&gt;
        &lt;planItemOnPart id="sentryOnPart4" sourceRef="planItem5"&gt;
          &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
        &lt;/planItemOnPart&gt;
      &lt;/sentry&gt;
      &lt;sentry id="sentry3"&gt;
        &lt;planItemOnPart id="sentryOnPart5" sourceRef="planItem9"&gt;
          &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
        &lt;/planItemOnPart&gt;
      &lt;/sentry&gt;
      &lt;stage id="sid-025D29E8-BA9B-403D-A684-8C5B52185642" name="Prior to starting"&gt;
        &lt;planItem id="planItem1" name="Create email address"
                definitionRef="sid-EA434DDD-E1BE-4AC1-8520-B19ACE8782D2"&gt;&lt;/planItem&gt;
        &lt;planItem id="planItem2" name="Allocate office"
                definitionRef="sid-505BA223-131A-4EF0-ABAD-485AEB0F2C96"&gt;&lt;/planItem&gt;
        &lt;planItem id="planItem3" name="Send joining letter to candidate"
                definitionRef="sid-D28DBAD5-0F5F-45F4-8553-3381199AC45F"&gt;
          &lt;entryCriterion id="sid-4D88C79D-8E31-4246-9541-A4F6A5720AC8"
            sentryRef="sentry1"&gt;&lt;/entryCriterion&gt;
        &lt;/planItem&gt;
        &lt;planItem id="planItem4" name="Agree start date"
                definitionRef="sid-97A72C46-C0AD-477F-86DD-85EF643BB97D"&gt;&lt;/planItem&gt;
        &lt;sentry id="sentry1"&gt;
          &lt;planItemOnPart id="sentryOnPart1" sourceRef="planItem1"&gt;
            &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
          &lt;/planItemOnPart&gt;
          &lt;planItemOnPart id="sentryOnPart2" sourceRef="planItem2"&gt;
            &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
          &lt;/planItemOnPart&gt;
          &lt;planItemOnPart id="sentryOnPart3" sourceRef="planItem4"&gt;
            &lt;standardEvent&gt;complete&lt;/standardEvent&gt;
          &lt;/planItemOnPart&gt;
        &lt;/sentry&gt;
        &lt;humanTask id="sid-EA434DDD-E1BE-4AC1-8520-B19ACE8782D2"
            name="Create email address"
            flowable:candidateGroups="hr"&gt;&lt;/humanTask&gt;
        &lt;humanTask id="sid-505BA223-131A-4EF0-ABAD-485AEB0F2C96"
            name="Allocate office"
            flowable:candidateGroups="hr"&gt;&lt;/humanTask&gt;
        &lt;humanTask id="sid-D28DBAD5-0F5F-45F4-8553-3381199AC45F"
            name="Send joining letter to candidate"
            flowable:candidateGroups="hr"&gt;&lt;/humanTask&gt;
        &lt;humanTask id="sid-97A72C46-C0AD-477F-86DD-85EF643BB97D"
            name="Agree start date"
            flowable:candidateGroups="hr"&gt;&lt;/humanTask&gt;
      &lt;/stage&gt;
      &lt;stage id="sid-8459EF32-4F4C-4E9B-A6E9-87FDC2299044"
        name="After starting"&gt;
        &lt;planItem id="planItem6" name="New starter training"
                definitionRef="sid-DF7B9582-11A6-40B4-B7E5-EC7AC6029387"&gt;&lt;/planItem&gt;
        &lt;planItem id="planItem7" name="Fill in paperwork"
                definitionRef="sid-7BF2B421-7FA0-479D-A8BD-C22EBD09F599"&gt;&lt;/planItem&gt;
        &lt;humanTask id="sid-DF7B9582-11A6-40B4-B7E5-EC7AC6029387"
            name="New starter training"
            flowable:assignee="${potentialEmployee}"&gt;&lt;/humanTask&gt;
        &lt;humanTask id="sid-7BF2B421-7FA0-479D-A8BD-C22EBD09F599"
            name="Fill in paperwork"
            flowable:assignee="${potentialEmployee}"&gt;&lt;/humanTask&gt;
      &lt;/stage&gt;
      &lt;humanTask id="sid-134E885A-3D58-417E-81E2-66A3E12334F9" name="Reject job"
        flowable:assignee="${potentialEmployee}"&gt;&lt;/humanTask&gt;
      &lt;exitCriterion id="sid-18277F30-E146-4B3E-B3C9-3F1E187EC7A8"
        sentryRef="sentry3"&gt;&lt;/exitCriterion&gt;
    &lt;/casePlanModel&gt;
  &lt;/case&gt;
&lt;/definitions&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>First of all, create a new project and add the _flowable-cmmn-engine_ dependency (here shown for Maven). The H2 dependency is also added, as H2 will be used as embedded database later on.

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;dependency&gt;
    &lt;groupId&gt;org.flowable&lt;/groupId&gt;
    &lt;artifactId&gt;flowable-cmmn-engine&lt;/artifactId&gt;
    &lt;version&gt;${flowable.version}&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.h2database&lt;/groupId&gt;
    &lt;artifactId&gt;h2&lt;/artifactId&gt;
    &lt;version&gt;${h2.version}&lt;/version&gt;
&lt;/dependency&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The Flowable CMMN API is designed to be consistent with the other Flowable APIs and concepts. As such, people that know the BPMN or DMN APIs will have no problem finding their way around. As with the other engines, the first line of code is creating a CmmnEngine. Here, the default in-memory configuration is used, which uses H2 as the database:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>public class Main {
  public static void main(String[] args) {
    CmmnEngine cmmnEngine
        = new StandaloneInMemCmmnEngineConfiguration().buildCmmnEngine();
  }
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Note that the _CmmnEngineConfiguration_ exposes many configuration options for tweaking various settings of the CMMN engine.

Put the XML from above in a file, for example _my-case.cmmn_ (or .cmmn.xml). For Maven, it should be placed in the _src/main/resources_ folder.

To make the engine aware of the case model, it first needs to be _deployed_. This is done through the _CmmnRepositoryService_:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>CmmnRepositoryService cmmnRepositoryService = cmmnEngine.getCmmnRepositoryService();
CmmnDeployment cmmnDeployment = cmmnRepositoryService.createDeployment()
    .addClasspathResource("my-case.cmmn")
    .deploy();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Deploying the XML will return a *CmmnDeployment*. A deployment can contain many case models and artifacts. The specific case model definition above is stored as a *CaseDefinition*. This can be verified by doing a _CaseDefinitionQuery_:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>List&lt;CaseDefinition&gt; caseDefinitions = cmmnRepositoryService.createCaseDefinitionQuery().list();
System.out.println("Found " + caseDefinitions.size() + " case definitions");</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Having a *CaseDefinition* in the engine, it's now possible to start a *CaseInstance* for this case model definition. Either the result from the query is used and passed into the following snippet of code, or the _key_ of the case definition is used directly (as done below).

Note that we're also passing data, an identifier to the _potentialEmployee_ as a variable when starting the *CaseInstance*. This variable will later be used in the human tasks to assign the task to the correct person (see the _assignee="${potentialEmployee}"_ attribute on _human tasks_).

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>CmmnRuntimeService cmmnRuntimeService = cmmnEngine.getCmmnRuntimeService();
CaseInstance caseInstance = cmmnRuntimeService.createCaseInstanceBuilder()
    .caseDefinitionKey("employeeOnboarding")
    .variable("potentialEmployee", "johnDoe")
    .start();</p>
</div>
<div class="listingblock">
<div class="content">
<pre>After the *CaseInstance* is started, the engine will determine which of the plan items of the model should be activated:

* The first stage has no entry criteria, so it's activated
* The child human tasks of the first stage have no entry criteria, so three of them are expected to be active

The plan items are represented at runtime by *PlanItemInstances* and can be queried through the _CmmnRuntimeService_:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>List&lt;PlanItemInstance&gt; planItemInstances = cmmnRuntimeService.createPlanItemInstanceQuery()
    .caseInstanceId(caseInstance.getId())
    .orderByName().asc()
    .list();</p>
</div>
<div class="paragraph">
<p>for (PlanItemInstance planItemInstance : planItemInstances) {
    System.out.println(planItemInstance.getName());
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>which prints out</pre>
</div>
</div>
<div class="paragraph">
<p>After starting
Agree start date
Allocate office
Create email address
Prior to starting
Reject job
Send joining letter to candidate</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Some things might be unexpected here:

* The stages are _also_ plan items and thus have a representation as *PlanItemInstance*. Note that that child plan item instances will have the stage as parent when calling _.getStageInstanceId()_.
* The _Send joining letter to candidate_ is returned in the result. The reason is that, in accordance with the CMMN 1.1 specification, this plan item instance is in the _available_ state, but not yet in the _active_ state.

Indeed, when the code above is changed to

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>for (PlanItemInstance planItemInstance : planItemInstances) {
    System.out.println(planItemInstance.getName()
        + ", state=" + planItemInstance.getState()
        + ", parent stage=" + planItemInstance.getStageInstanceId());
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The output now becomes:</pre>
</div>
</div>
<div class="paragraph">
<p>After starting, state=available, parent stage=null
Agree start date, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Allocate office, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Create email address, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Prior to starting, state=active, parent stage=null
Reject job, state=active, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122
Send joining letter to candidate, state=available, parent stage=fe37ac97-b016-11e7-b3ad-acde48001122</p>
</div>
<div class="listingblock">
<div class="content">
<pre>To only show the active plan item instances, the query can be adapted by adding _planItemInstanceStateActive()_:

[source,java,linenums]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>List&lt;PlanItemInstance&gt; planItemInstances = cmmnRuntimeService.createPlanItemInstanceQuery()
   .caseInstanceId(caseInstance.getId())
   .planItemInstanceStateActive()
   .orderByName().asc()
   .list();</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre>The output is now</pre>
</div>
</div>
<div class="paragraph">
<p>Agree start date
Allocate office
Create email address
Prior to starting
Reject job</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Of course, the *PlanItemInstance* is the low level representation, but each plan item also has a _plan item definition_ that defines what type it is. In this case, we only have _human tasks_. It is possible to interact with the _CaseInstance_ via its _plan item instances_, for example by triggering them programmatically (for example, _CmmnRuntimeService.triggerPlanItemInstance(String planItemInstanceId)_). However, most likely the interaction will happen through the results of the actual plan item definition: here, the human tasks.

Querying for tasks is done in the exact same way as for the BPMN engine (in fact, the task service is a shared component and tasks created in BPMN or CMMN can be queried through both engines):

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>CmmnTaskService cmmnTaskService = cmmnEngine.getCmmnTaskService();
List&lt;Task&gt; hrTasks = cmmnTaskService.createTaskQuery()
    .taskCandidateGroup("hr")
    .caseInstanceId(caseInstance.getId())
    .orderByTaskName().asc()
    .list();
for (Task task : hrTasks) {
    System.out.println("Task for HR : " + task.getName());
}</p>
</div>
<div class="paragraph">
<p>List&lt;Task&gt; employeeTasks = cmmnTaskService.createTaskQuery()
    .taskAssignee("johndoe")
    .orderByTaskName().asc()
    .list();
for (Task task : employeeTasks) {
    System.out.println("Task for employee: " + task);
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Which outputs:</pre>
</div>
</div>
<div class="paragraph">
<p>Task for HR : Agree start date
Task for HR : Allocate office
Task for HR : Create email address</p>
</div>
<div class="paragraph">
<p>Task for employee: Reject job</p>
</div>
<div class="listingblock">
<div class="content">
<pre>When the three tasks of HR are completed, the 'Send joining letter to candidate' task should be available:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>for (Task task : hrTasks) {
    cmmnTaskService.complete(task.getId());
}</p>
</div>
<div class="paragraph">
<p>hrTasks = cmmnTaskService.createTaskQuery()
    .taskCandidateGroup("hr")
    .caseInstanceId(caseInstance.getId())
    .orderByTaskName().asc()
    .list();</p>
</div>
<div class="paragraph">
<p>for (Task task : hrTasks) {
    System.out.println("Task for HR : " + task.getName());
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>And indeed, the expected task is now created:</pre>
</div>
</div>
<div class="paragraph">
<p>Task for HR : Send joining letter to candidate</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Completing this task will now move the case instance into the second stage, as the sentry for the first stage is satisfied. The 'Reject job' tasks is automatically completed by the system and the two tasks for the employee are created:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>Task for employee: Fill in paperwork
Task for employee: New starter training
Task for employee: Reject job</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Completing all the tasks will end the case instance:</pre>
</div>
</div>
<div class="paragraph">
<p>List&lt;Task&gt; tasks = cmmnTaskService.createTaskQuery().caseInstanceId(caseInstance.getId()).listPage(0, 1);
while (!tasks.isEmpty()) {
    cmmnTaskService.complete(tasks.get(0).getId());
    tasks = cmmnTaskService.createTaskQuery()
        .caseInstanceId(caseInstance.getId())
        .listPage(0, 1);
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>While executing case instances, the engine also stores historic information, which can be queried via a query API:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>CmmnHistoryService cmmnHistoryService = cmmnEngine.getCmmnHistoryService();
HistoricCaseInstance historicCaseInstance = cmmnHistoryService.createHistoricCaseInstanceQuery()
    .caseInstanceId(caseInstance.getId())
    .singleResult();</p>
</div>
<div class="paragraph">
<p>System.out.println("Case instance execution took "
    + (historicCaseInstance.getEndTime().getTime() - historicCaseInstance.getStartTime().getTime()) + " ms");</p>
</div>
<div class="paragraph">
<p>List&lt;HistoricTaskInstance&gt; historicTaskInstances = cmmnHistoryService.createHistoricTaskInstanceQuery()
    .caseInstanceId(caseInstance.getId())
    .orderByTaskCreateTime().asc()
    .list();</p>
</div>
<div class="paragraph">
<p>for (HistoricTaskInstance historicTaskInstance : historicTaskInstances) {
    System.out.println("Task completed: " + historicTaskInstance.getName());
}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Which outputs:</pre>
</div>
</div>
<div class="paragraph">
<p>Case instance execution took 149 ms
Task completed: Reject job
Task completed: Agree start date
Task completed: Allocate office
Task completed: Create email address
Task completed: Send joining letter to candidate
Task completed: New starter training
Task completed: Fill in paperwork</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Historic data related to the case execution is collected for special constructs, such as Tasks (as seen above), milestones, cases, variables and plan items in general.
This data is persisted at the same time as the runtime data, but it is not deleted when case instances end.
Access to the historic data is provided as query APIs by the _CmmnHistoryService_

Of course, this is but a small part of the available APIs and constructs available in the Flowable CMMN Engine. Please check the other sections for more detailed information

=== CMMN 1.1 Constructs

This chapter covers the CMMN 1.1 constructs supported by Flowable, as well as extensions to the CMMN 1.1 standard.

The following constructs, with the exception of sentries and item control, as for the CMMN specification are considered plan items.
Historic data of their instances execution can be queried through the _CmmnHistoryService_ using _org.flowable.cmmn.api.history.HistoricPlanItemInstanceQuery_.

==== Stage

A stage is used to group plan items together. It is typically used to define "phases" in a case instance.

A stage is a plan item itself, and thus can have entry and exit criteria. Plan items contained within a stage are only available when the parent stage moves to the _active_ state. Stages can be nested in other stages.

A stage is visualized as a rectangle with angled corners:

image::images/cmmn.stage.png[align="center"]

==== Task

A "manual" task, meaning the task will happen external to the engine.

Properties:

* *name*: expression that will be resolved at runtime as the name of the manual task
* *blocking*: a boolean value determining whether the task blocks
* *blockingExpression*: an expression that evaluates to a boolean indicating whether the tasks blocks

If a task is non-blocking, the engine will simply complete it automatically when executing it. If a task is blocking, a _PlanItemInstance_ for this task will remain in the _active_ state until it is programmatically triggered by the _CmmnRuntimeService.triggerPlanItemInstance(String planItemInstanceId)_ method.

A task is visualized as a rounded rectangle:

image::images/cmmn.task.png[align="center"]

==== Human task

A human task is used to model work that needs to be done by a human, typically through a form. When the engine arrives at a human task, a new entry is created in the task list of any users or groups assigned to that task.

A human task is a plan item, which means that beyond a human task entry also a _PlanItemInstance_ is created and it can be queried via the _PlanItemInstanceQuery_.

Human tasks can be queried through the _org.flowable.task.api.TaskQuery_ API. Historic task data can be queried through the _org.flowable.task.api.history.HistoricTaskInstanceQuery_.

Properties:

* *name*: expression that will be resolved at runtime as the name of the human task
* *blocking*: a boolean value determining whether the task blocks
* *blockingExpression*: an expression that evaluates to a boolean indicating whether the tasks blocks
* *assignee* : an expression (can be a static text value) that is used to determine to whom the human task is assigned
* *owner* : an expression (can be a static text value) that is used to determine who is the owner of the human task
* *candidateUsers* : an expression (can be a static text value) that resolves to a comma-separated list of Strings that is used to determine which users are candidate for this human task
* *candidateGroups* : an expression (can be a static text value) that resolves to a comma-separated list of Strings that is used to determine to which groups the task is assigned
* *form key*: an expression that determines a key when using forms. Can be retrieved via the API afterwards
* *Due date* an expression that resolves to java.util.Date or a ISO-8601 date string
* *Priority*: an expression that resolves to an integer. Can be used in the TaskQuery API to filter tasks

A human task is visualized as a rounded rectangle with a user icon in the top left corner:

image::images/cmmn.humantask.png[align="center"]

==== Java Service task

A service task is used to execute custom logic.

Custom logic is placed in a class that implements the _org.flowable.cmmn.api.delegate.PlanItemJavaDelegate_ interface.

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>public class MyJavaDelegate implements PlanItemJavaDelegate {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>public void execute(DelegatePlanItemInstance planItemInstance) {
    String value = (String) planItemInstance.getVariable("someVariable");
    ...
}</pre>
</div>
</div>
<div class="paragraph">
<p>}</p>
</div>
<div class="listingblock">
<div class="content">
<pre>For lower-level implementations that cannot be covered by using the _PlanItemJavaDelegate_ approach, the _CmmnActivityBehavior_ can be used (similar to _JavaDelegate_ vs _ActivityBehavior_ in the BPMN engine).


Properties:

* *name*: name of the service task
* *class*: the Java class implementing the custom logic
* *class fields*: parameters to pass when calling the custom logic
* *Delegate expression*: an expression that resolves to a class implementing the _PlanItemJavaDelegate_ interface

A service task is visualized as a rounded rectangle with a cog icon in the top left corner:

image::images/cmmn.servicetask.png[align="center"]

==== Decision task

A _Decision task_ calls out to a DMN decision table and stores the resulting variable in the case instance.

Properties:

* *Decision table reference*: the referenced DMN decision table that needs to be invoked.

It is also possible to throw an error when no rule is hit during the evaluation of the DMN decision table by setting the '_Throw error if no rules were hit_' property.

A decision task is visualized as a _task_ with a table icon in the top left corner:

image::images/cmmn.decisiontask.png[align="center"]

==== Http Task

The Http task is an out-of-the-box implementation of a _service task_. It is used when a REST service needs to be called over HTTP.

The Http task has various options to customize the request and response. See the BPMN http task documentation for details on all the configuration options.

A http task is visualized as a _task_ with a rocket icon in the top left corner:

image::images/cmmn.httptask.png[align="center"]

==== Script Task

A task of type "script", similar to its equivalent in BPMN, the Script Task executes a script when the plan item instance becomes active.

Properties:

* *name*: task attribute to indicate the name of the task
* *type*: task attribute whose value must be "script" to indicate the type of task
* *scriptFormat*: extended attribute that indicate the language of the script (for example, javascript, groovy)
* *script*: the script to execute, defined as a string in a extension field element named "script"
* *autoStoreVariables*: optional task attribute flag (default: false) that indicates whether or not variables defined in the script will be stored in the Plan Item Instance context (see note below)
* *resultVariableName*: optional task attribute that when present will store a variable with the specified name in the Plan Item instance context with the script evaluation result (see note below)

A script task is visualized as a _task_ with a script icon in the top left corner:

image::images/cmmn.scripttask.png[align="center"]

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;planItem id="scriptPlanItem" name="Script Plan Item" definitionRef="myScriptTask" /&gt;
&lt;task name="My Script Task Item" flowable:type="script" flowable:scriptFormat="JavaScript"&gt;
    &lt;documentation&gt;Optional documentation&lt;/documentation&gt;
    &lt;extensionElements&gt;
        &lt;flowable:field name="script"&gt;
            &lt;string&gt;
                sum = 0;
                for ( i in inputArray ) {
                    sum += i;
                }
            &lt;/string&gt;
        &lt;/flowable:field&gt;
    &lt;/extensionElements&gt;
&lt;/taks&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>*Note*: The value of the *scriptFormat* attribute must be a name that is compatible with the link:$$http://jcp.org/en/jsr/detail?id=223$$[JSR-223] (scripting for the Java platform). By default, JavaScript is included in every JDK and as such doesn't need any additional JAR files. If you want to use another (JSR-223 compatible) scripting engine, it is sufficient to add the corresponding JAR to the classpath and use the appropriate name. For example, the Flowable unit tests often use Groovy because the syntax is similar to that of Java.

Do note that the Groovy scripting engine is bundled with the groovy-jsr223 JAR. As such, one must add the following dependency:

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;dependency&gt;
    &lt;groupId&gt;org.codehaus.groovy&lt;/groupId&gt;
    &lt;artifactId&gt;groovy-jsr223&lt;/artifactId&gt;
    &lt;version&gt;2.x.x&lt;version&gt;
&lt;/dependency&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>All case variables that are accessible through the PlanItem instance that arrives in the script task can be used within the script. In the example below, the script variable _'inputArray'_ is in fact a case variable (an array of integers).

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;flowable:field name="script"&gt;
    &lt;string&gt;
    sum = 0
    for ( i in inputArray ) {
      sum += i
    }
    &lt;/string&gt;
&lt;/flowable:field&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>*Note*: It's also possible to set process variables in a script, simply by calling _planItemInstance.setVariable("variableName", variableValue)_. By default, no variables are stored automatically. It's possible to automatically store any variable defined in the script (for example, __sum__ in the example above) by setting the property ++autoStoreVariables++ on the ++scriptTask++ to ++true++. However, *the best practice is not to do this and use an explicit execution.setVariable() call*, as with some recent versions of the JDK, auto storing of variables does not work for some scripting languages. See link:$$http://www.jorambarrez.be/blog/2013/03/25/bug-on-jdk-1-7-0_17-when-using-scripttask-in-activiti/$$[this link] for more details.

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;task name="Script Task" flowable:type="script" flowable:scriptFormat="groovy" flowable:autoStoreVariables="false"&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The default for this parameter is +false+, meaning that if the parameter is omitted from the script task definition, all the declared variables will only exist during the duration of the script.

Here's an example of how to set a variable in a script:

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;flowable:field name="script"&gt;
    &lt;string&gt;
    def scriptVar = "test123"
    planItemInstance.setVariable("myVar", scriptVar)
    &lt;/string&gt;
&lt;/flowable:field&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>The following names are reserved and *cannot be used* as variable names: *out, out:print, lang:import, context, elcontext*.

*Note* The return value of a script task can be assigned to an already existing or new process variable by specifying its name as a literal value for the _'flowable:resultVariable'_ attribute of a script task definition. Any existing value for a specific process variable will be overwritten by the result value of the script execution. When a result variable name is not specified, the script result value gets ignored.

[source,xml,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>&lt;task name="Script Task" flowable:type="script" flowable:scriptFormat="groovy" lowable:resultVariable="myVar"&gt;
    &lt;flowable:field name="script"&gt;
        &lt;string&gt;#{echo}&lt;/string&gt;
    &lt;/flowable:field&gt;
&lt;/task&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>In the above example, the result of the script execution (the value of the resolved expression __'#{echo}'__) is set to the process variable named __'myVar'__ after the script completes.

==== Milestone

A milestone is used to mark arriving at a certain point in the case instance. At runtime, they are represented as *MilestoneInstances* and they can be queried through the *MilestoneInstanceQuery* via the _CmmnRuntimeService_. There is also a historical counterpart via the _CmmnHistoryService_.

A milestone is a plan item, which means that as well as a milestone entry, a _PlanItemInstance_ is created also, which can be queried via the _PlanItemInstanceQuery_.


Properties:

* *name*: an expression or static text that determines the name of the milestone

A milestone is visualized as a rounded rectangle (more rounded than a task):

image::images/cmmn.milestone.png[align="center"]

==== Case task

A case task is used to start a child case within the context of another case. The _CaseInstanceQuery_ has _parent_ options to find these cases.

When the case task is blocking, the _PlanItemInstance_ will be _active_ until the child case has completely finished. If the case task is non-blocking, the child case is started and the plan item instance automatically completes. When the child case instance ends there is no impact on the parent case.

Properties:

* *name*: an expression or static text that determines the name
* *blocking*: a boolean value determining whether the task blocks
* *blockingExpression*: an expression that evaluates to a boolean indicating whether the tasks blocks
* *Case reference*: the key of the case definition that is used to start the child case instance. Can be an expression

A case task is visualized as a rounded rectangle with a case icon in the top left corner:

image::images/cmmn.casetask.png[align="center"]

==== Process task

A process task is used to start a process instance within the context of a case.

When the process task is blocking, the _PlanItemInstance_ will be _active_ until the process instance has completely finished. If the process task is non-blocking, the process instance is started and the plan item instance automatically completes. When the process instance ends there is no impact on the parent case.

Properties:

* *name*: an expression or static text that determines the name
* *blocking*: a boolean value determining whether the task blocks
* *blockingExpression*: an expression that evaluates to a boolean indicating whether the tasks blocks
* *Process reference*: the key of the process definition that is used to start the process instance. Can be an expression

A process task is visualized as a rounded rectangle with an arrow icon in the top left corner:

image::images/cmmn.processtask.png[align="center"]

==== Criteria

===== Entry criterion

Entry criteria form a sentry for a given plan item instance. They consist of two parts:

* One or more parts that depend on other plan items: these define dependencies on state transitions of other plan items. For example, one human task can depend on the state transition 'complete' of three other human tasks to become active itself
* One optional _if part_ or _condition_: this is an expression that allows the definition of a complex condition

A sentry is satisfied when all its criteria are resolved to _true_. When a criterion evaluates to true, this is stored and remembered for future evaluations. Note that entry criteria of all plan item instances in the _available_ state are evaluated whenever something changes in the case instance.

Multiple sentries are possible on a plan item. However, when one is satisfied, the plan item moves from state _available_ to _active_.

An entry criterion is visualized as a diamond shape (white color inside) on the border of a plan item:

image::images/cmmn.entrycriteria.png[align="center"]

===== Exit criterion

Exit criteria form a sentry for a given plan item instance. They consist of two parts:

* One or more parts that depend on other plan items: these define dependencies on state transitions of other plan items. For example, one human task can depend on reaching a certain milestone to be automatically terminated
* One optional _if part_ or _condition_: this is an expression that allows a complex condition to be defined

A sentry is satisfied when all its criteria are resolved to _true_. When a criterion evaluates to true, this is stored and remembered for future evaluations. Note that exit criteria of all plan item instances in the _active_ state are evaluated whenever something changes in the case instance.

Multiple sentries are possible on a plan item. However, when one is satisfied, the plan item moves from state _active_ to _exit_.

An exit criterion is visualized as a diamond shape (white color inside) on the border of a plan item:

image::images/cmmn.exitcriteria.png[align="center"]

==== Event Listeners

===== Timer Event Listener

A timer event listener is used when the passing of time needs to be captured in a case model.

A timer event listener is not a task and has a simpler plan item lifecycle compared to a _task_: the timer will simply move from _available_ to _completed_ when the event (in this case, the time passing) occurs.

Properties:

* *Timer expression*: an expression that defines when the timer should occur. The following options are possible:
** An expression resolving to a java.util.Date or org.joda.time.DateTime instance (for example, _${someBean.calculateNextDate(someCaseInstanceVariable)})
** An ISO8601 date
** An ISO8601 duration String (for example, _PT5H_, indicating the timer should fire in 5 hours from instantiation)
** AN ISO8601 repetition String (for example, R5/PT2H, indicating the timer should fire 5 times, each time waiting 2 hours)
** A String containing a cron expression
* *Start trigger plan item/event*: reference to a plan item in the case model that triggers the start of the timer event listener

Note that setting a _start trigger_ for the timer event listener does not have a visual indicator in the case model, unlike entry/exit criteria on sentries.

A timer event listener is visualized as circle with a clock icon inside:

image::images/cmmn.timereventlistener.png[align="center"]

===== User Event Listener

A user event listener can be used when needing to capture a user interaction that directly influences a case state,
instead of indirectly via impacting variables or information in the case. When the event is captured an Occur transition is triggered on the event listener.
Like timer event listeners, it has a much simpler lifecycle that a _task_.

image::images/cmmn.usereventlistener.png[align="center"]

User event listeners can be queried using the _org.flowable.cmmn.api.runtime.UserEventListenerInstanceQuery_. Such a query can be created by calling the _cmmnRuntimeService.createUserEventListenerInstanceQuery()_ method. Note that a user event listener is also a plan item instance, which means it can also be queried through the _org.flowable.cmmn.api.runtime.PlanItemInstanceQuery_ API.

A user event listener can be completed by calling the _cmmnRuntimeService.completeUserEventListenerInstance(id)_ method.

==== Item control: Repetition Rule

Plan items on the case model can have a _repetition rule_: an expression that can be used to indicate a certain plan item needs to be repeated.
When no expression is set, but the repetition is enabled (for example, the checkbox is checked in the Flowable Modeler) or the expression is empty, a _true_ value is assumed by default.

An optional _repetition counter variable_ can be set, which holds the index (one-based) of the instance. If not set, the default variable name is _repeitionCounter_.

If the plan item does not have any entry criteria, the repetition rule expression is evaluated when the plan item is completed or terminated. If the expression resolved to _true_, a new instance is created. For example, a human task with a repetition rule expression _${repetitionCounter &lt; 3}_, will create three sequential human tasks.

If the plan item has entry criteria, the behavior is different. The repetition rule is not evaluated on completion or termination, but when a sentry of the plan item is satisfied. If both the sentry is satisfied and the repetition rule evaluates to true, a new instance is created.

Take, for example, the following timer event listener followed by a human task. The sentry has one entry criterion for the _occur_ event of the timer event listener. Note that enabling and setting the repetition rule on the task has a visual indicator at the bottom of the rectangle.

image::images/cmmn.repeatingtimereventlistener.png[align="center"]

If the timer event listener is repeating (for example, _R/PT1H_), the _occur_ event will be fired every hour. When the repetition rule expression of the human task evaluates to true, a new human task instance will be created each hour.

==== Item control: Manual Activation Rule

Plan items on the case model can have a _manual activation rule_: an expression that can be used to indicate a certain plan item needs to be _manually activated by an end-user_.
When no expression is set, but the manual activation is enabled (for example, the checkbox is checked in the Flowable Modeler) or the expression is empty, a _true_ value is assumed by default.

Stages and all task types can be marked for manual activation. Visually, the task or stage will get a 'play' icon (small triangle pointing to the right) to indicate an end-user will have to manually activate it:

image::images/cmmn.manual-activation.png[align="center"]

Normally, when a sentry for a plan item is satisfied (or the plan item doesn't have any sentries) the plan item instance is automatically moved to the _ACTIVE_ state. When a manual activation is set though, and it evaluates to true, the plan item instance now becomes _ENABLED_ instead of _ACTIVE_. As the name implies, the idea behind this is that end-users manually have to activate the plan item instance. A typical use case is showing a list of buttons of potential plan item instances that can currently be started by the end user.

To start an enabled plan item instance, the _startPlanItemInstance_ method of the _CmmnRuntimeService_ can be used:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>List&lt;PlanItemInstance&gt; enabledPlanItemInstances = cmmnRuntimeService.createPlanItemInstanceQuery()
    .caseInstanceId(caseInstance.getId())
    .planItemInstanceStateEnabled()
    .list();</p>
</div>
<div class="paragraph">
<p>cmmnRuntimeService.startPlanItemInstance(planItemInstance.getId());</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Note that the behavior of a task is only executed when the plan item instance moves into the _ACTIVE_ state. For example, for a human task, the user task will only be created after calling the _startPlanItemInstance_ method.

Plan item instances that are enabled can be moved into the _DISABLED_ state:

[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>cmmnRuntimeService.disablePlanItemInstance(planItemInstance.getId());</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Disabled plan item instances can be enabled again:
[source,java,linenums]</pre>
</div>
</div>
<div class="paragraph">
<p>cmmnRuntimeService.enablePlanItemInstance(planItemInstance.getId());</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Note that with regards to determining stage or case instance termination, the _DISABLED_ state is seen as a 'terminal' state. This means that the case instance will terminate when only disabled plan item instances would remain.

==== Item control: Required Rule

Plan items on the case model can have a _required rule_: an expression that can be used to indicate a certain plan item is _required by the enclosing stage (or plan model)_. This can be used to indicate which plan items of the case model are required to be executed and which are optional.

When no expression is set, but the required rule is enabled (for example, the checkbox is checked in the Flowable Modeler) or the expression is empty, a _true_ value is assumed by default.

The _required rule_ works in conjunction with the _autoComplete_ attribute on the parent stage:

* If _autoComplete_ resolves to _false_ for the stage, which is also the default when nothing is set, *all* child plan item instances must be in an end state (completed, terminated, and so on) for the stage plan item instance to be completed by the engine
* If _autoComplete_ resolves to _true_ for the stage, all child plan item instances for *which the required rule evaluates to true* need to be in an end state. If there are also no other active child plan item instances, the stage completes automatically

A _stage plan item instance_ has a *completeable* property that can be used to see whether or not the conditions for completion are satisfied.
Take, for example, the following simple stage and assume that the sentry for the _required task_ evaluates to true and the other one to false. This means that the left plan item instance will be active while the right one will be in the _available_ state.

image::images/cmmn.completeable-stage.png[align="center"]

Calling _cmmnRuntimeService.completeStagePlanItemInstance(String stagePlanItemInstanceId)_ will not be possible for the stage (an exception will be thrown) as it has one active child plan item instance. When this user task on the left is completed, the _completeStagePlanItemInstance_ can now be called, as no child plan item instances are currently active. However, by itself, the stage will not automatically complete as the right user task is in the available state.

If the previous stage is changed to be *autoCompleteable* (this is visualised by a black rectangle at the bottom of the stage) and the plan item on the left is changed to be required (this is visualised using an exclamation mark), the behavior will be different:

image::images/cmmn.completeable-stage02.png[align="center"]

* If the left plan item instance is active (sentry is true) and the right is not (sentry is false). In this case, when the left user task is completed, the stage instance will auto complete as it has no active child plan item instances and all required plan item instances are in an end state
* If both the left and right user tasks are active (sentries are true)
** When the left user task is completed, the stage will not autocomplete as there is still a child plan item instance active
** When the right user task is completed, the stage will not autocomplete as the required left child plan item instance is not in an end state
* If the left plan item instance is not active and the right is active. In this case, when the right user task is completed the stage will not autocomplete, as the required left user task is not in an end state. It will need to become active and be completed to complete the stage.

Note that the manual activation rule works independently of the required rule. For example, given the following stage:

image::images/cmmn.completeable-stage03.png[align="center"]

Here, user task D is required and user task B is manually activated.

* If D is completed, the stage will automatically complete, as B is not required and it is not active
* If B would be required too, it would need to be manually started (using _cmmnRuntimeService.startPlanItemInstance(String planItemInstanceId)_) before the stage would automatically complete, even if D would be completed before the manual start of B

==== Item control: Completion Neutral Rule

Plan items on the case model can have a _completion neutral rule_: an expression that can be used to indicate a certain plan item is _neutral with regards to the completion of its parent stage (or plan model)_. This can be used to indicate which plan items of the case model are required to be executed and which are optional, as a more flexible alternative in some use cases to using the _required rule_ and _autoComplete_ .

Note that the _Completion Neutral Rule_ is not a CMMN 1.1 Standard, but a Flowable-specific addition.

Following the specification, a stage with a plan item in state *AVAILABLE* does not complete unless its _autoComplete_ attribute is set _true_ and the plan item is not required. For example, a plan item that has an unsatisfied sentry remains in *AVAILABLE* until the sentry is satisfied. This means that the parent stage would not complete, unless the plan item is marked as _not required_ and the stage is set to _autoComplete_. The downside is that once a stage is marked as to autoComplete, all child plan items need to have a configuration for the _required_ rule, which is in some use cases tedious and lots of work.

The _Completion Neutral Rule_, contrary to the autoComplete-required mechanism, works from "bottom-up": a plan item can be marked individually to be _neutral wrt the completion of its parent_ without having to mark any other plan item.

The _Required Rule_ takes precedence when plan items with both rules both evaluate to _true_.

To summarize:

* a plan item configured to be _"completion neutral"_ will allow a stage to complete automatically if it's in *AVAILABLE* state (e.g. waiting for an entry criterion sentry),meaning that such a plan item is neutral with respect to its parent stage completion evaluation.

* a stage will remain *ACTIVE* on any of these conditions:
    1. It has at least one plan item in *ACTIVE* state
    2. It has at least one plan item with _requiredRule_ in *AVAILABLE* or *ENABLE* state
    3. It is not marked as _autoComplete_ and has at least one plan item in *ENABLED* state (irrespective of its _requiredRule_)
    4. It is not marked as  _autoComplete_ and has at least one plan item in *AVAILABLE* state that is *not* _completionNeutral_

* a stage will *COMPLETE* if:
    1. It contains no plan items or all child plan items are in a _Terminal_ or _Semi-terminal_ state (CLOSED, COMPLETED, DISABLED, FAILED)
    2. It is not marked as _autoComplete_ and all remaining child plan items are in *AVAILABLE* state and are _completionNeutral_ and not _required_
    3. It is _autoComplete_ and all remaining plan items are _not required_ in *ENABLED* or *AVAILABLE* state (regardless of its completion neutrality, as required rule gets precedence)

== Architecture

[[architecture]]

This chapter gives a short introduction to the internals of the CMMN engine from a high-level point of view. Of course, as the CMMN engine code is open source, the actual implementation details can be found by diving into the source code.

The CMMN engine, as shown in the diagram below, is one of the engines that is part of the Flowable engines eco-system and is designed in a similar way as the other engines. The CMMN engine builds upon CMMN specific services and the shared services: the task, variable, identity and job services, which are independent from the engines. On a lower level the entity- and datamanager layer takes care of the low-level persistence, equivalent to the other engines.

image::images/cmmn.architecture.png[align="center"]

By using the shared services, this also means that for example tasks from both the BPMN and the CMMN engine will end up together and can be queried and managed through the same API. Similarly for the async executor: timers and async jobs use the same logic and even can be managed by a central executor.

The shared services architecture has a second benefit. When the engines are used together, as is often the case, the engines will share resources where possible, database transactions will span calls over multiple engines operations, lookup caches are common and persistency is handled independently from the engines itself.

The CMMN engine is designed with the same principles as the other engines of the Flowable project. The diagram below gives a high-level overview of the different components involved when working with the CMMN Engine:

image::images/cmmn.api-call-flow.png[align="center"]

From a high level point of view:

* A *CmmnEngine* instance is created from a *CmmnEngineConfiguration*. The configuration instance can be created from a configuration file or programmatically.
* The _CmmnEngine_ gives access the Flowable CMMN API's in the form of services: *CmmnRepositoryService*, *CmmnRuntimeService*, *CmmnTaskService*, *CmmnHistoryService*, *CmmnManagementService*. The naming of the services and their responsibilities is similar to the other engines.
* Every API method is transformed into a *Command* instance. This _Command_ instance is passed into the *CommandExecutor* which, amongst others, makes it pass a stack of *CommandInterceptors*. These interceptors have various responsibilities, including handling transactions.
* Eventually, the _Command_ typically (unless it's a pure data modification _Command_) plans a *CmmnOperation* on the *CmmnEngineAgenda*.
* Operations will be taken from the _CmmnEngineAgenda_ until no more operations are left. Typically, an operation will plan new operations as part of its logic.
* The logic in the operations will call out to lower-level services and/or entity managers.

A big difference between the BPMN and the CMMN engine is that the BPMN engine is generally 'local': the engine looks at the current state, checks what is ahead in the process and continues (of course this is a simplification, there are plenty of operations where this doesn't apply, but for making a distinction conceptually, it is correct). The CMMN engine works differently: in CMMN, data plays an important role and the change of data can trigger many things in various places in the case definition. For this reason, the *EvaluateCriteriaOperation* is planned and executed often whenever changes happen. The engine does optimize these evaluations when it detects duplicates or useless evaluations.

Core to the working of the CMMN engine is the concept of a *Plan item instance*, a representation of which _plan items_ currently are _live_ in the case and which state they have. Quite different from BPMN, CMMN defines a strict state lifecyle for the plan items. This is represented in the _CmmnRuntimeService_ methods, the query API's and the data fields part of the *PlanItemInstance* object.

The working of the agenda, the operations and how plan item instances are handled can be inspected by setting logging to debug for the agenda package. For example, when using log4j:

```
log4j.logger.org.flowable.cmmn.engine.impl.agenda=DEBUG
```

Which leads to logging like:

```
Planned [Init Plan Model] initializing plan model for case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122
Planned [Change PlanItem state] Task A (id: planItemTaskA), new state: [available] with transition [create]
Planned [Change PlanItem state] PlanItem Milestone One (id: planItemMileStoneOne), new state: [available] with transition [create]
Planned [Change PlanItem state] Task B (id: planItemTaskB), new state: [available] with transition [create]
Planned [Change PlanItem state] PlanItem Milestone Two (id: planItemMileStoneTwo), new state: [available] with transition [create]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'create' having fired for plan item planItemTaskA (Task A)
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'create' having fired for plan item planItemMileStoneOne (PlanItem Milestone One)
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'create' having fired for plan item planItemTaskB (Task B)
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'create' having fired for plan item planItemMileStoneTwo (PlanItem Milestone Two)
Planned [Activate PlanItem] Task A (planItemTaskA)
Planned [Change PlanItem state] Task A (id: planItemTaskA), new state: [active] with transition [start]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'start' having fired for plan item planItemTaskA (Task A)
Planned [Change PlanItem state] Task A (id: planItemTaskA), new state: [completed] with transition [complete]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'complete' having fired for plan item planItemTaskA (Task A)
Planned [Activate PlanItem] PlanItem Milestone One (planItemMileStoneOne)
Planned [Change PlanItem state] PlanItem Milestone One (id: planItemMileStoneOne), new state: [active] with transition [start]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'start' having fired for plan item planItemMileStoneOne (PlanItem Milestone One)
Planned [Change PlanItem state] PlanItem Milestone One (id: planItemMileStoneOne), new state: [completed] with transition [occur]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'occur' having fired for plan item planItemMileStoneOne (PlanItem Milestone One)
Planned [Activate PlanItem] Task B (planItemTaskB)
Planned [Change PlanItem state] Task B (id: planItemTaskB), new state: [active] with transition [start]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'start' having fired for plan item planItemTaskB (Task B)
Planned [Change PlanItem state] Task B (id: planItemTaskB), new state: [completed] with transition [complete]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'complete' having fired for plan item planItemTaskB (Task B)
Planned [Activate PlanItem] PlanItem Milestone Two (planItemMileStoneTwo)
Planned [Change PlanItem state] PlanItem Milestone Two (id: planItemMileStoneTwo), new state: [active] with transition [start]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'start' having fired for plan item planItemMileStoneTwo (PlanItem Milestone Two)
Planned [Change PlanItem state] PlanItem Milestone Two (id: planItemMileStoneTwo), new state: [completed] with transition [occur]
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122 with transition 'occur' having fired for plan item planItemMileStoneTwo (PlanItem Milestone Two)
Planned [Evaluate Criteria] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122
No active plan items found for plan model, completing case instance
Planned [Complete case instance] case instance bfaf0e64-eaf4-11e7-b9d0-acde48001122
```</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>